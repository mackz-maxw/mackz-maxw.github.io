<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.1">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" integrity="sha256-5eIC48iZUHmSlSUz9XtjRyK2mzQkHScZY1WdMaoz74E=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"mackz-maxw.github.io","root":"/","images":"/images","scheme":"Muse","darkmode":false,"version":"8.21.1","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"always","padding":18,"offset":12},"hljswrap":true,"copycode":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"duration":200,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"æœç´¢...","empty":"æ²¡æœ‰æ‰¾åˆ°ä»»ä½•æœç´¢ç»“æœï¼š${query}","hits_time":"æ‰¾åˆ° ${hits} ä¸ªæœç´¢ç»“æœï¼ˆç”¨æ—¶ ${time} æ¯«ç§’ï¼‰","hits":"æ‰¾åˆ° ${hits} ä¸ªæœç´¢ç»“æœ"}}</script><script src="/js/config.js"></script>

    <meta name="description" content="ä¹˜ä¸Šç‡ƒçŠ€èˆ¹ï¼Œè¿˜æœªæ›¾å»è¿‡å€’æ‚¬å±±ã€‚">
<meta property="og:type" content="website">
<meta property="og:title" content="Maxwçš„å°ç«™">
<meta property="og:url" content="https://mackz-maxw.github.io/zh-CN/page/2/index.html">
<meta property="og:site_name" content="Maxwçš„å°ç«™">
<meta property="og:description" content="ä¹˜ä¸Šç‡ƒçŠ€èˆ¹ï¼Œè¿˜æœªæ›¾å»è¿‡å€’æ‚¬å±±ã€‚">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Mackz-Maxw">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://mackz-maxw.github.io/zh-CN/page/2/">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"zh-CN/page/2/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Maxwçš„å°ç«™</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<link rel="alternate" href="/atom.xml" title="Maxwçš„å°ç«™" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="åˆ‡æ¢å¯¼èˆªæ " role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">Maxwçš„å°ç«™</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">Maxwå­¦ä¹ è®°å½•</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="æœç´¢" role="button">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>åˆ†ç±»</a></li>
  </ul>
</nav>




</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          æ–‡ç« ç›®å½•
        </li>
        <li class="sidebar-nav-overview">
          ç«™ç‚¹æ¦‚è§ˆ
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Mackz-Maxw</p>
  <div class="site-description" itemprop="description">ä¹˜ä¸Šç‡ƒçŠ€èˆ¹ï¼Œè¿˜æœªæ›¾å»è¿‡å€’æ‚¬å±±ã€‚</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">83</span>
          <span class="site-state-item-name">æ—¥å¿—</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">8</span>
        <span class="site-state-item-name">åˆ†ç±»</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/mackz-maxw" title="GitHub â†’ https:&#x2F;&#x2F;github.com&#x2F;mackz-maxw" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
  </div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://mackz-maxw.github.io/2025/07/12/kamacode32/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Mackz-Maxw">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Maxwçš„å°ç«™">
      <meta itemprop="description" content="ä¹˜ä¸Šç‡ƒçŠ€èˆ¹ï¼Œè¿˜æœªæ›¾å»è¿‡å€’æ‚¬å±±ã€‚">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Maxwçš„å°ç«™">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/07/12/kamacode32/" class="post-title-link" itemprop="url">ä»£ç éšæƒ³å½• | åˆ·é¢˜-åŠ¨æ€è§„åˆ’5</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2025-07-12 22:51:02" itemprop="dateCreated datePublished" datetime="2025-07-12T22:51:02+08:00">2025-07-12</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2025-07-23 03:54:52" itemprop="dateModified" datetime="2025-07-23T03:54:52+08:00">2025-07-23</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/leetcode/" itemprop="url" rel="index"><span itemprop="name">leetcode</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="é›¶é’±å…‘æ¢-ii">518. é›¶é’±å…‘æ¢ II</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">change</span><span class="params">(<span class="type">int</span> amount, vector&lt;<span class="type">int</span>&gt;&amp; coins)</span> </span>&#123;</span><br><span class="line">        <span class="function">vector&lt;<span class="type">uint64_t</span>&gt; <span class="title">dp</span><span class="params">(amount + <span class="number">1</span>, <span class="number">0</span>)</span></span>; <span class="comment">// é˜²æ­¢ç›¸åŠ æ•°æ®è¶…int</span></span><br><span class="line">        dp[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">        <span class="comment">// ç¬¬ä¸€è½®å¾ªç¯åº”è¯¥å°†æ‰€æœ‰j = coins[i]ç½®1</span></span><br><span class="line">        <span class="comment">// æƒ³æ¸…æ¥šè¿™ä¸€ç‚¹ï¼Œå°±å¯ä»¥æ˜ç¡®ç»„åˆæ•°çš„çŠ¶æ€è½¬ç§»æ–¹ç¨‹å’Œæ’åˆ—æ•°ä¸ä¸€æ ·</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i&lt;coins.<span class="built_in">size</span>(); i++)&#123;</span><br><span class="line">            <span class="type">int</span> coin = coins[i];</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j = coin; j&lt;(amount+<span class="number">1</span>); j++)&#123;</span><br><span class="line">                dp[j] += dp[j - coins[i]];</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// cout&lt;&lt;&quot;coins[i]=&quot;&lt;&lt;coins[i]&lt;&lt;endl;</span></span><br><span class="line">            <span class="comment">// for(int d:dp)cout&lt;&lt;d&lt;&lt;&#x27; &#x27;;</span></span><br><span class="line">            <span class="comment">// cout&lt;&lt;endl;</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> dp[amount];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="ç»„åˆæ€»å’Œ-â…³">377. ç»„åˆæ€»å’Œ â…£</h3>
<p>å¦‚æœæ±‚ç»„åˆæ•°å°±æ˜¯å¤–å±‚forå¾ªç¯éå†ç‰©å“ï¼Œå†…å±‚foréå†èƒŒåŒ…ï¼Œå› ä¸ºç‰©å“å¤„ç†é¡ºåºå›ºå®šã€‚
å¦‚æœæ±‚æ’åˆ—æ•°å°±æ˜¯å¤–å±‚foréå†èƒŒåŒ…ï¼Œå†…å±‚forå¾ªç¯éå†ç‰©å“ï¼Œå› ä¸ºæ¯ä¸ªå®¹é‡ä¸‹éƒ½é‡æ–°æ‰«ææ‰€æœ‰ç‰©å“ã€‚
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">combinationSum4</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; nums, <span class="type">int</span> target)</span> </span>&#123;</span><br><span class="line">        <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">dp</span><span class="params">(target + <span class="number">1</span>, <span class="number">0</span>)</span></span>;</span><br><span class="line">        dp[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">0</span>;j&lt;=target;j++)&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i&lt;nums.<span class="built_in">size</span>();i++)&#123;</span><br><span class="line">                <span class="keyword">if</span>((j - nums[i])&gt;=<span class="number">0</span> &amp;&amp; dp[j] &lt;= INT_MAX - dp[j - nums[i]])&#123;</span><br><span class="line">                    dp[j] += dp[j - nums[i]];</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// for(auto d:dp)cout&lt;&lt;d&lt;&lt;&#x27; &#x27;;</span></span><br><span class="line">            <span class="comment">// cout&lt;&lt;endl;</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dp[target];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<h3 id="çˆ¬æ¥¼æ¢¯-è¿›é˜¶">70. çˆ¬æ¥¼æ¢¯ ï¼ˆè¿›é˜¶ï¼‰</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">climbStairs</span><span class="params">(<span class="type">int</span> n)</span> </span>&#123;</span><br><span class="line">        <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">dp</span><span class="params">(n+<span class="number">1</span>, <span class="number">0</span>)</span></span>;</span><br><span class="line">        dp[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i&lt;=n; i++)&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">1</span>; j&lt;=<span class="number">2</span>; j++)&#123;</span><br><span class="line">                <span class="keyword">if</span>((i-j) &gt;= <span class="number">0</span>)&#123;</span><br><span class="line">                    dp[i] += dp[i - j];</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dp[n];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://mackz-maxw.github.io/2025/07/10/kamacode31/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Mackz-Maxw">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Maxwçš„å°ç«™">
      <meta itemprop="description" content="ä¹˜ä¸Šç‡ƒçŠ€èˆ¹ï¼Œè¿˜æœªæ›¾å»è¿‡å€’æ‚¬å±±ã€‚">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Maxwçš„å°ç«™">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/07/10/kamacode31/" class="post-title-link" itemprop="url">ä»£ç éšæƒ³å½• | åˆ·é¢˜-åŠ¨æ€è§„åˆ’4</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2025-07-10 22:59:08" itemprop="dateCreated datePublished" datetime="2025-07-10T22:59:08+08:00">2025-07-10</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2025-07-13 07:05:11" itemprop="dateModified" datetime="2025-07-13T07:05:11+08:00">2025-07-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/leetcode/" itemprop="url" rel="index"><span itemprop="name">leetcode</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="èƒŒåŒ…é—®é¢˜ä¸­ä¸€ç»´å’ŒäºŒç»´-dp-çš„éå†é¡ºåº">01èƒŒåŒ…é—®é¢˜ä¸­ä¸€ç»´å’ŒäºŒç»´ dp
çš„éå†é¡ºåº</h3>
<h4 id="ä¸€ç»´-dpå€’åºéå†å®¹é‡">ä¸€ç»´ dpï¼š<strong>å€’åºéå†å®¹é‡</strong></h4>
<ul>
<li><strong>åŸå› </strong>ï¼šå€’åºéå†å¯ä»¥ä¿è¯æ¯ä¸ªç‰©å“åªè¢«æ”¾å…¥ä¸€æ¬¡ã€‚</li>
<li><strong>åŸç†</strong>ï¼šæ¯æ¬¡æ›´æ–° <code>dp[j]</code>
æ—¶ï¼Œä½¿ç”¨çš„æ˜¯ä¸Šä¸€è½®ï¼ˆæœªåŠ å…¥å½“å‰ç‰©å“ï¼‰çš„çŠ¶æ€ï¼Œé¿å…é‡å¤åŠ å…¥åŒä¸€ä¸ªç‰©å“ã€‚</li>
<li><strong>ä¸¾ä¾‹</strong>ï¼š
<ul>
<li>ç‰©å“0ï¼Œé‡é‡1ï¼Œä»·å€¼15<br />
</li>
<li>æ­£åºéå†ï¼š<code>dp[2] = dp[1] + 15 = 30</code>ï¼ˆç‰©å“0è¢«åŠ äº†ä¸¤æ¬¡ï¼Œé”™è¯¯ï¼ï¼‰</li>
<li>å€’åºéå†ï¼š<code>dp[2] = dp[1] + 15 = 15</code>ï¼Œ<code>dp[1] = dp[0] + 15 = 15</code>ï¼ˆæ¯ä¸ªå®¹é‡åªåŠ ä¸€æ¬¡ç‰©å“0ï¼‰</li>
</ul></li>
</ul>
<h4 id="äºŒç»´-dpæ­£åºéå†å®¹é‡">äºŒç»´ dpï¼š<strong>æ­£åºéå†å®¹é‡</strong></h4>
<ul>
<li><strong>åŸå› </strong>ï¼šäºŒç»´ dp çš„ <code>dp[i][j]</code>
éƒ½æ˜¯é€šè¿‡ä¸Šä¸€å±‚ <code>dp[i-1][j]</code>
è®¡ç®—çš„ï¼Œæœ¬å±‚ä¸ä¼šè¦†ç›–ä¸Šä¸€å±‚ï¼Œæ‰€ä»¥ä¸ä¼šé‡å¤åŠ å…¥ç‰©å“ã€‚</li>
<li><strong>åŸç†</strong>ï¼šæ¯ä¸€å±‚ä»£è¡¨ä¸€ä¸ªç‰©å“ï¼ŒçŠ¶æ€è½¬ç§»åªä¾èµ–äºä¸Šä¸€å±‚ï¼Œå¤©ç„¶ä¿è¯æ¯ä¸ªç‰©å“åªé€‰ä¸€æ¬¡ã€‚</li>
</ul>
<h3 id="æœ€åä¸€å—çŸ³å¤´çš„é‡é‡-ii">1049. æœ€åä¸€å—çŸ³å¤´çš„é‡é‡ II</h3>
<ul>
<li>ç›®æ ‡ï¼šå°†æ‰€æœ‰çŸ³å¤´åˆ†æˆä¸¤ç»„ï¼Œä½¿ä¸¤ç»„æ€»é‡é‡å°½é‡æ¥è¿‘ï¼Œæœ€åå‰©ä¸‹çš„çŸ³å¤´é‡é‡å°±æ˜¯ä¸¤ç»„é‡é‡å·®çš„ç»å¯¹å€¼ã€‚</li>
<li>è½¬åŒ–ä¸º<strong>01èƒŒåŒ…é—®é¢˜</strong>ï¼šæ¯ä¸ªçŸ³å¤´åªèƒ½é€‰ä¸€æ¬¡ï¼ŒèƒŒåŒ…å®¹é‡ä¸ºæ‰€æœ‰çŸ³å¤´é‡é‡å’Œçš„ä¸€åŠï¼Œå°½é‡è®©ä¸€ç»„çš„é‡é‡æœ€å¤§ä¸”ä¸è¶…è¿‡å®¹é‡ã€‚</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">lastStoneWeightII</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; stones)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> sum = <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> hlf_sum = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> s: stones)&#123;</span><br><span class="line">            sum += s;</span><br><span class="line">        &#125;</span><br><span class="line">        hlf_sum = sum / <span class="number">2</span>; <span class="comment">// æ³¨æ„hlf_sum / 2æ˜¯å‘ä¸‹å–æ•´çš„</span></span><br><span class="line"></span><br><span class="line">        <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">dp</span><span class="params">(<span class="number">1501</span>, <span class="number">0</span>)</span></span>; <span class="comment">// ä¸€å®šè¦ä¿è¯dp[j]æ˜¯å¯ä»¥æ¯”è¾ƒçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬é€‰æ‹©é‡é‡ä¸ºj</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i&lt;stones.<span class="built_in">size</span>();i++)&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j = hlf_sum; j&gt;=stones[i]; j--)&#123;</span><br><span class="line">                dp[j] = <span class="built_in">max</span>(dp[j], dp[j - stones[i]] + stones[i]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> sum - dp[hlf_sum] * <span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="ç›®æ ‡å’Œ">494. ç›®æ ‡å’Œ</h3>
<p>è¯¥é—®é¢˜å¯ä»¥è½¬åŒ–ä¸ºä¸€ä¸ªå­é›†å’Œé—®é¢˜ï¼šåœ¨æ•°ç»„ä¸­æ‰¾åˆ°ä¸€äº›æ•°å­—ï¼Œä½¿å®ƒä»¬çš„å’Œç­‰äº
<code>(target + sum(nums)) / 2</code>ï¼ˆè®°ä¸º
<code>bagSize</code>ï¼‰ï¼Œæ¯ä¸ªæ•°å­—åªèƒ½ä½¿ç”¨ä¸€æ¬¡ã€‚ä»¥ä¸‹æ˜¯è¯¦ç»†æ­¥éª¤ï¼š</p>
<ol type="1">
<li><strong>é—®é¢˜è½¬åŒ–</strong>ï¼š
<ul>
<li>è®¾åŠ æ³•æ€»å’Œä¸º <code>x</code>ï¼Œåˆ™å‡æ³•æ€»å’Œä¸º
<code>sum - x</code>ã€‚</li>
<li>æ ¹æ®æ¡ä»¶ <code>x - (sum - x) = target</code>ï¼Œè§£å¾—
<code>x = (target + sum) / 2</code>ã€‚</li>
<li>é—®é¢˜è½¬åŒ–ä¸ºï¼šåœ¨ <code>nums</code> ä¸­é€‰å–è‹¥å¹²æ•°å­—ï¼Œä½¿å®ƒä»¬çš„å’Œç­‰äº
<code>bagSize</code>ï¼Œæ±‚é€‰å–æ–¹æ¡ˆæ•°ã€‚</li>
</ul></li>
<li><strong>è¾¹ç•Œæ¡ä»¶</strong>ï¼š
<ul>
<li>è‹¥ <code>abs(target) &gt; sum</code>ï¼Œæ— è§£ã€‚</li>
<li>è‹¥ <code>(target + sum)</code> ä¸ºå¥‡æ•°ï¼Œæ— è§£ï¼ˆ<code>bagSize</code>
å¿…é¡»æ˜¯æ•´æ•°ï¼‰ã€‚</li>
</ul></li>
<li><strong>åŠ¨æ€è§„åˆ’</strong>ï¼š
<ul>
<li>ä½¿ç”¨ä¸€ç»´æ•°ç»„ <code>dp[j]</code> è¡¨ç¤ºè£…æ»¡å®¹é‡ <code>j</code>
çš„èƒŒåŒ…çš„æ–¹æ¡ˆæ•°ã€‚</li>
<li>åˆå§‹åŒ– <code>dp[0] = 1</code>ï¼ˆç©ºé›†æ–¹æ¡ˆï¼‰ã€‚</li>
<li>éå†æ¯ä¸ªæ•°å­—ï¼Œé€†åºæ›´æ–° <code>dp</code>
æ•°ç»„ï¼ˆé¿å…é‡å¤ä½¿ç”¨æ•°å­—ï¼‰ã€‚</li>
</ul></li>
</ol>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">findTargetSumWays</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; nums, <span class="type">int</span> target)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// å›æº¯æ³•å®¹æ˜“è¶…æ—¶</span></span><br><span class="line">        <span class="type">int</span> sum = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> n:nums)&#123;</span><br><span class="line">            sum += n;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> sz = (target + sum) / <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">if</span>((target + sum) % <span class="number">2</span> == <span class="number">1</span>)<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">abs</span>(target) &gt; sum)<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">dp</span><span class="params">(sz+<span class="number">1</span>, <span class="number">0</span>)</span></span>;</span><br><span class="line">        dp[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i&lt;nums.<span class="built_in">size</span>();i++)&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j = sz; j &gt;= nums[i]; j--)&#123;</span><br><span class="line">                dp[j] += dp[j-nums[i]];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dp[sz];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h4 id="ä»£ç è§£é‡Š">ä»£ç è§£é‡Š</h4>
<ol type="1">
<li><strong>åˆå§‹åŒ–</strong>ï¼š
<ul>
<li><code>dp[0] = 1</code>ï¼šè¡¨ç¤ºå®¹é‡ä¸º0çš„èƒŒåŒ…æœ‰1ç§æ–¹æ¡ˆï¼ˆä¸é€‰ä»»ä½•æ•°å­—ï¼‰ã€‚</li>
<li>å…¶ä»–ä½ç½®åˆå§‹åŒ–ä¸º0ã€‚</li>
</ul></li>
<li><strong>éå†æ›´æ–°</strong>ï¼š
<ul>
<li>å¯¹æ¯ä¸ªæ•°å­— <code>num</code>ï¼Œä» <code>bagSize</code> åˆ°
<code>num</code> é€†åºéå†ã€‚</li>
<li>æ›´æ–°å…¬å¼ï¼š<code>dp[j] += dp[j - num]</code>ï¼Œè¡¨ç¤ºï¼š
<ul>
<li><strong>ä¸é€‰ <code>num</code>è¾¾æˆj</strong>ï¼šæ–¹æ¡ˆæ•°ä¿æŒ
<code>dp[j]</code>ã€‚</li>
<li><strong>é€‰ <code>num</code>è¾¾æˆj</strong>ï¼šæ–¹æ¡ˆæ•°åŠ ä¸Š
<code>dp[j - num]</code>ï¼ˆå‰©ä½™å®¹é‡ <code>j - num</code>
çš„æ–¹æ¡ˆæ•°ï¼‰ã€‚</li>
</ul></li>
</ul></li>
<li><strong>ç¤ºä¾‹</strong>ï¼š
<ul>
<li><code>nums = [1, 1, 1, 1, 1]</code>, <code>target = 3</code>ï¼š
<ul>
<li><code>total = 5</code>,
<code>bagSize = (3 + 5) / 2 = 4</code>ã€‚</li>
<li><code>dp</code> æ•°ç»„åˆå§‹ä¸º <code>[1, 0, 0, 0, 0]</code>ã€‚</li>
<li>éå†æ¯ä¸ª <code>1</code>
åï¼Œ<code>dp[4] = 5</code>ï¼ˆ5ç§ç»„åˆæ–¹å¼ï¼‰ã€‚</li>
</ul></li>
</ul></li>
</ol>
<h4 id="å¤æ‚åº¦">å¤æ‚åº¦</h4>
<ul>
<li><strong>æ—¶é—´å¤æ‚åº¦</strong>ï¼šO(n Ã— bagSize)ï¼Œå…¶ä¸­ <code>n</code>
ä¸ºæ•°ç»„é•¿åº¦ã€‚</li>
<li><strong>ç©ºé—´å¤æ‚åº¦</strong>ï¼šO(bagSize)ã€‚</li>
</ul>
<h3 id="ä¸€å’Œé›¶">474.ä¸€å’Œé›¶</h3>
<p>æœ¬é¢˜å®¹æ˜“è¢«çœ‹æˆå¤šé‡èƒŒåŒ…é—®é¢˜ï¼Œè¯†åˆ«æ¸…æ¥šé—®é¢˜æœ¬è´¨å°±å®¹æ˜“åšäº†
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">count</span><span class="params">(string s)</span></span>&#123;</span><br><span class="line">        vector&lt;<span class="type">int</span>&gt; cnt;</span><br><span class="line">        <span class="type">int</span> zeroes = <span class="number">0</span>, ones = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">char</span> c:s)&#123;</span><br><span class="line">            <span class="keyword">if</span>(c == <span class="string">&#x27;0&#x27;</span>)zeroes++;</span><br><span class="line">            <span class="keyword">if</span>(c == <span class="string">&#x27;1&#x27;</span>)ones++;</span><br><span class="line">        &#125;</span><br><span class="line">        cnt.<span class="built_in">push_back</span>(zeroes);</span><br><span class="line">        cnt.<span class="built_in">push_back</span>(ones);</span><br><span class="line">        <span class="keyword">return</span> cnt;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">findMaxForm</span><span class="params">(vector&lt;string&gt;&amp; strs, <span class="type">int</span> m, <span class="type">int</span> n)</span> </span>&#123;</span><br><span class="line">        vector&lt;vector&lt;<span class="type">int</span>&gt;&gt; <span class="built_in">dp</span>(m+<span class="number">1</span>, <span class="built_in">vector</span>&lt;<span class="type">int</span>&gt;(n+<span class="number">1</span>, <span class="number">0</span>));</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i&lt;strs.<span class="built_in">size</span>();i++)&#123;</span><br><span class="line">            vector&lt;<span class="type">int</span>&gt; cnt = <span class="built_in">count</span>(strs[i]);</span><br><span class="line">            <span class="keyword">if</span>(cnt[<span class="number">0</span>] &gt; m || cnt[<span class="number">1</span>] &gt; n)&#123;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> a = m; a &gt;= cnt[<span class="number">0</span>]; a--)&#123;</span><br><span class="line">                <span class="keyword">for</span>(<span class="type">int</span> b = n; b &gt;= cnt[<span class="number">1</span>]; b--)&#123;</span><br><span class="line">                    dp[a][b] = <span class="built_in">max</span>(dp[a][b], dp[a-cnt[<span class="number">0</span>]][b-cnt[<span class="number">1</span>]] + <span class="number">1</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dp[m][n];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://mackz-maxw.github.io/2025/07/04/oper_sys13/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Mackz-Maxw">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Maxwçš„å°ç«™">
      <meta itemprop="description" content="ä¹˜ä¸Šç‡ƒçŠ€èˆ¹ï¼Œè¿˜æœªæ›¾å»è¿‡å€’æ‚¬å±±ã€‚">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Maxwçš„å°ç«™">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/07/04/oper_sys13/" class="post-title-link" itemprop="url">æ“ä½œç³»ç»ŸåŸºç¡€ | ä¿¡å·é‡å’Œæ¡ä»¶å˜é‡</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2025-07-05 05:06:20" itemprop="dateCreated datePublished" datetime="2025-07-05T05:06:20+08:00">2025-07-05</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2025-07-08 04:36:44" itemprop="dateModified" datetime="2025-07-08T04:36:44+08:00">2025-07-08</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/os-basic/" itemprop="url" rel="index"><span itemprop="name">os basic</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="ä¿¡å·é‡-semaphore---åœè½¦åœºæ¨¡å‹">ğŸš¦ <strong>ä¿¡å·é‡ (Semaphore) -
åœè½¦åœºæ¨¡å‹</strong></h3>
<p><strong>å£è¯€</strong>ï¼š<strong>â€œè®¡æ•°èµ„æºï¼Œè¿›å‡ºåŠ å‡â€</strong><br />
- åƒä¸€ä¸ªåœè½¦åœºç®¡ç†å‘˜ï¼š - <code>wait()</code> =
æŠ¬èµ·æ†å­æ”¾è½¦è¿›ï¼ˆ<strong>èµ„æº-1</strong>ï¼‰ - <code>post()</code> =
è½ä¸‹æ†å­æ”¾è½¦å‡ºï¼ˆ<strong>èµ„æº+1</strong>ï¼‰ -
<strong>æ ¸å¿ƒ</strong>ï¼šç®¡<strong>æ•°é‡</strong>ï¼ˆå‰©ä½™è½¦ä½ï¼‰</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è¶…ç®€ç‰ˆä¿¡å·é‡å®ç°ï¼ˆC++20æ ‡å‡†ï¼‰</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;semaphore&gt;</span></span></span><br><span class="line"><span class="function">std::counting_semaphore&lt;5&gt; <span class="title">parking</span><span class="params">(<span class="number">5</span>)</span></span>; <span class="comment">// 5ä¸ªè½¦ä½</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">car</span><span class="params">(<span class="type">int</span> id)</span> </span>&#123;</span><br><span class="line">    parking.<span class="built_in">acquire</span>();      <span class="comment">// ç­‰è½¦ä½ï¼ˆæ†å­æŠ¬èµ·ï¼‰</span></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Car &quot;</span> &lt;&lt; id &lt;&lt; <span class="string">&quot; parked\n&quot;</span>;</span><br><span class="line">    parking.<span class="built_in">release</span>();      <span class="comment">// å¼€èµ°ï¼ˆæ†å­è½ä¸‹ï¼‰</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr />
<h3 id="æ¡ä»¶å˜é‡-condition-variable---å¥¶èŒ¶åº—æ¨¡å‹">ğŸš¥ <strong>æ¡ä»¶å˜é‡
(Condition Variable) - å¥¶èŒ¶åº—æ¨¡å‹</strong></h3>
<p><strong>å£è¯€</strong>ï¼š<strong>â€œæ¡ä»¶ä¸æ»¡è¶³ï¼Œè§£é”ç­‰é€šçŸ¥â€</strong><br />
- åƒå¥¶èŒ¶åº—å–é¤ï¼š - <code>wait()</code> =
æ²¡å¥¶èŒ¶æ—¶<strong>æ”¾ä¸‹å·ç ç‰Œç¡è§‰</strong> - <code>notify()</code> =
å¥¶èŒ¶åšå¥½å<strong>å«å·å”¤é†’é¡¾å®¢</strong> -
<strong>æ ¸å¿ƒ</strong>ï¼šç®¡<strong>æ¡ä»¶</strong>ï¼ˆå¥¶èŒ¶æ˜¯å¦åšå¥½ï¼‰</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ¡ä»¶å˜é‡åŸºæœ¬ç»“æ„</span></span><br><span class="line">std::mutex mtx;</span><br><span class="line">std::condition_variable cv;</span><br><span class="line"><span class="type">bool</span> milktea_ready = <span class="literal">false</span>; <span class="comment">// å…³é”®æ¡ä»¶</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// é¡¾å®¢çº¿ç¨‹</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">customer</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="function">std::unique_lock <span class="title">lock</span><span class="params">(mtx)</span></span>;</span><br><span class="line">    cv.<span class="built_in">wait</span>(lock, []&#123; <span class="keyword">return</span> milktea_ready; &#125;); <span class="comment">// æ²¡å¥¶èŒ¶å°±ç¡</span></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Got milktea!\n&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åº—å‘˜çº¿ç¨‹</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">staff</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function">std::lock_guard <span class="title">lock</span><span class="params">(mtx)</span></span>;</span><br><span class="line">        milktea_ready = <span class="literal">true</span>; <span class="comment">// å¥¶èŒ¶åšå¥½</span></span><br><span class="line">    &#125;</span><br><span class="line">    cv.<span class="built_in">notify_all</span>(); <span class="comment">// å¤§å–Šï¼šå¥¶èŒ¶å¥½äº†ï¼</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr />
<h3 id="å¯¹æ¯”è®°å¿†è¡¨">ğŸ”‘ <strong>å¯¹æ¯”è®°å¿†è¡¨</strong></h3>
<table>
<colgroup>
<col style="width: 20%" />
<col style="width: 41%" />
<col style="width: 38%" />
</colgroup>
<thead>
<tr>
<th><strong>ç‰¹å¾</strong></th>
<th>ä¿¡å·é‡</th>
<th>æ¡ä»¶å˜é‡</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>æ ¸å¿ƒæ€æƒ³</strong></td>
<td>èµ„æºè®¡æ•°å™¨ï¼ˆè¿˜å‰©å‡ ä¸ªï¼Ÿï¼‰</td>
<td>æ¡ä»¶æ£€æŸ¥ï¼ˆäº‹æƒ…å‘ç”Ÿäº†å—ï¼Ÿï¼‰</td>
</tr>
<tr>
<td><strong>æ“ä½œ</strong></td>
<td><code>wait()</code>å‡èµ„æºï¼Œ<code>post()</code>åŠ èµ„æº</td>
<td><code>wait()</code>ä¼‘çœ ï¼Œ<code>notify()</code>å”¤é†’</td>
</tr>
<tr>
<td><strong>é”ä¾èµ–</strong></td>
<td>è‡ªå¸¦é”æœºåˆ¶</td>
<td><strong>å¿…é¡»æ­é…mutexä½¿ç”¨</strong></td>
</tr>
<tr>
<td><strong>é€‚ç”¨åœºæ™¯</strong></td>
<td>è¿æ¥æ± /é™æµ</td>
<td>ä»»åŠ¡åè°ƒ/äº‹ä»¶ç­‰å¾…</td>
</tr>
<tr>
<td><strong>ç”Ÿæ´»æ¯”å–»</strong></td>
<td>åœè½¦åœºè¿›å‡ºç³»ç»Ÿ</td>
<td>å¥¶èŒ¶åº—å«å·ç³»ç»Ÿ</td>
</tr>
</tbody>
</table>
<hr />
<h3 id="è®°å¿†æŠ€å·§">ğŸ§  <strong>è®°å¿†æŠ€å·§</strong></h3>
<ol type="1">
<li><strong>ä¿¡å·é‡è®°æ•°å­—</strong>ï¼š
<ul>
<li>çœ‹åˆ°â€œå…è®¸Nä¸ªçº¿ç¨‹è®¿é—®â€ â†’ é€‰ä¿¡å·é‡</li>
<li>ä»£ç çœ‹åˆ°<code>.acquire()/.release()</code> â†’ ä¿¡å·é‡</li>
</ul></li>
<li><strong>æ¡ä»¶å˜é‡æŸ¥çŠ¶æ€</strong>ï¼š
<ul>
<li>çœ‹åˆ°â€œå½“XXå‘ç”Ÿæ—¶å”¤é†’â€ â†’ é€‰æ¡ä»¶å˜é‡</li>
<li>ä»£ç çœ‹åˆ°<code>cv.wait(é”, lambdaæ¡ä»¶)</code> â†’ æ¡ä»¶å˜é‡</li>
</ul></li>
<li><strong>å¿…èƒŒä¸¤å¥è¯</strong>ï¼š
<ul>
<li>ä¿¡å·é‡ï¼š<strong>â€œèµ„æºä¸å¤Ÿå°±é˜»å¡ï¼Œé‡Šæ”¾èµ„æºå°±åŠ ä¸€â€</strong></li>
<li>æ¡ä»¶å˜é‡ï¼š<strong>â€œæ¡ä»¶ä¸æ»¡è¶³æ—¶è§£é”ç­‰å¾…ï¼Œæ»¡è¶³æ—¶åŠ é”æ‰§è¡Œâ€</strong></li>
</ul></li>
</ol>
<hr />
<h3 id="åˆ†é’Ÿå®æˆ˜åœºæ™¯">ğŸŒ° 1åˆ†é’Ÿå®æˆ˜åœºæ™¯</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åœºæ™¯ï¼šä»…å…è®¸3ä¸ªçº¿ç¨‹åŒæ—¶ä¸‹è½½</span></span><br><span class="line"><span class="function">std::counting_semaphore <span class="title">down_sem</span><span class="params">(<span class="number">3</span>)</span></span>; </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">download</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    down_sem.<span class="built_in">acquire</span>();    <span class="comment">// å ä½</span></span><br><span class="line">    <span class="comment">// ...ä¸‹è½½æ“ä½œ...</span></span><br><span class="line">    down_sem.<span class="built_in">release</span>();    <span class="comment">// é‡Šæ”¾</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åœºæ™¯ï¼šçº¿ç¨‹ç­‰å¾…æœåŠ¡å™¨å¯åŠ¨</span></span><br><span class="line">std::condition_variable cv;</span><br><span class="line"><span class="type">bool</span> server_ready = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">client</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="function">std::unique_lock <span class="title">lk</span><span class="params">(mtx)</span></span>;</span><br><span class="line">    cv.<span class="built_in">wait</span>(lk, []&#123; <span class="keyword">return</span> server_ready; &#125;); <span class="comment">// ç­‰å°±ç»ª</span></span><br><span class="line">    <span class="comment">// ...è¿æ¥æœåŠ¡å™¨...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">server</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// ...å¯åŠ¨æœåŠ¡...</span></span><br><span class="line">    server_ready = <span class="literal">true</span>;</span><br><span class="line">    cv.<span class="built_in">notify_all</span>(); <span class="comment">// é€šçŸ¥æ‰€æœ‰å®¢æˆ·ç«¯</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="ç”¨æ¡ä»¶å˜é‡å®ç°ä¿¡å·é‡">ç”¨æ¡ä»¶å˜é‡å®ç°ä¿¡å·é‡</h3>
<p>å³ç”¨æ¡ä»¶å˜é‡ï¼ˆcondition variableï¼‰å’Œäº’æ–¥é”ï¼ˆmutexï¼‰æ¥æ¨¡æ‹Ÿä¿¡å·é‡çš„ P/V
æ“ä½œã€‚</p>
<p>å¦‚æœå¤šä¸ªèµ„æºåœºæ™¯ï¼Œ<strong>å„çº¿ç¨‹å¯¹èµ„æºçš„è¦æ±‚æ¡ä»¶å¤æ‚ï¼Œå®¹æ˜“å‘ç”Ÿæ­»é”</strong>çš„è¯ï¼Œå»ºè®®ä½¿ç”¨æ¡ä»¶å˜é‡çš„å®ç°</p>
<p>ä¾‹å¦‚å“²å­¦å®¶åƒé¥­é—®é¢˜ï¼Œæ¯ä¸ªå“²å­¦å®¶éƒ½å…ˆæ‹¿èµ·è‡ªå·±å³æ‰‹è¾¹çš„å‰å­ï¼Œå°±ä¼šäº§ç”Ÿæ­»é”ï¼Œæ²¡æœ‰å“²å­¦å®¶å†èƒ½æ‹¿èµ·å·¦æ‰‹è¾¹çš„å‰å­å¹¶åƒé¥­ã€‚</p>
<ul>
<li><strong>P æ“ä½œï¼ˆç­‰å¾…/è·å–èµ„æºï¼‰</strong><br />
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">P</span><span class="params">(<span class="type">sem_t</span> *sem)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">hold</span>(&amp;sem-&gt;mutex) &#123;</span><br><span class="line">        <span class="keyword">while</span> (!COND)</span><br><span class="line">            <span class="built_in">cond_wait</span>(&amp;sem-&gt;cv, &amp;sem-&gt;mutex);</span><br><span class="line">        sem-&gt;count--;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>å…ˆåŠ é”ï¼ˆhold mutexï¼‰ï¼Œä¿è¯å¯¹ä¿¡å·é‡çš„æ“ä½œæ˜¯åŸå­çš„ã€‚</li>
<li>å¦‚æœæ¡ä»¶ä¸æ»¡è¶³ï¼ˆå¦‚ count &lt;=
0ï¼‰ï¼Œå°±ç”¨æ¡ä»¶å˜é‡ç­‰å¾…ï¼ˆcond_waitï¼‰ï¼Œå¹¶è‡ªåŠ¨é‡Šæ”¾ mutexï¼Œç›´åˆ°è¢«å”¤é†’ã€‚</li>
<li>è¢«å”¤é†’åå†æ¬¡åŠ é”ï¼Œæ£€æŸ¥æ¡ä»¶ï¼Œæ»¡è¶³åˆ™ count--ï¼Œè¡¨ç¤ºè·å–ä¸€ä¸ªèµ„æºã€‚</li>
</ul></li>
<li><strong>V æ“ä½œï¼ˆé‡Šæ”¾/å½’è¿˜èµ„æºï¼‰</strong><br />
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">V</span><span class="params">(<span class="type">sem_t</span> *sem)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">hold</span>(&amp;sem-&gt;mutex) &#123;</span><br><span class="line">        sem-&gt;count++;</span><br><span class="line">        <span class="built_in">cond_broadcast</span>(&amp;sem-&gt;cv);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>åŠ é”ï¼Œcount++ï¼Œè¡¨ç¤ºé‡Šæ”¾ä¸€ä¸ªèµ„æºã€‚</li>
<li>ç”¨æ¡ä»¶å˜é‡å”¤é†’æ‰€æœ‰ç­‰å¾…çº¿ç¨‹ï¼ˆcond_broadcastï¼‰ã€‚</li>
</ul></li>
</ul>
<h3 id="ç”¨ä¿¡å·é‡å®ç°æ¡ä»¶å˜é‡">ç”¨ä¿¡å·é‡å®ç°æ¡ä»¶å˜é‡</h3>
<p>ç”¨ä¿¡å·é‡å®ç°æ¡ä»¶å˜é‡çš„ wait/broadcast æ“ä½œï¼š</p>
<p><strong>1. <code>wait</code> å‡½æ•°</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">wait</span><span class="params">(<span class="keyword">struct</span> condvar *cv, <span class="type">mutex_t</span> *mutex)</span> &#123;</span><br><span class="line">    mutex_lock(&amp;cv-&gt;lock);</span><br><span class="line">    cv-&gt;nwait++;</span><br><span class="line">    mutex_unlock(&amp;cv-&gt;lock);</span><br><span class="line"></span><br><span class="line">    mutex_unlock(mutex);</span><br><span class="line">    P(&amp;cv-&gt;sleep);</span><br><span class="line">    mutex_lock(mutex);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><code>cv-&gt;nwait++</code>ï¼šè®°å½•å½“å‰æœ‰å¤šå°‘çº¿ç¨‹åœ¨ç­‰å¾…æ¡ä»¶å˜é‡ï¼ˆè¿›å…¥ç­‰å¾…é˜Ÿåˆ—ï¼‰ã€‚</li>
<li><code>mutex_unlock(mutex)</code>ï¼šé‡Šæ”¾ä¸»äº’æ–¥é”ï¼Œå…è®¸å…¶ä»–çº¿ç¨‹è¿›å…¥ä¸´ç•ŒåŒºä¿®æ”¹æ¡ä»¶ã€‚</li>
<li><code>P(&amp;cv-&gt;sleep)</code>ï¼šåœ¨ä¿¡å·é‡ sleep
ä¸Šç­‰å¾…ï¼ˆé˜»å¡ï¼‰ï¼Œç›´åˆ°è¢«å”¤é†’ã€‚</li>
<li><code>mutex_lock(mutex)</code>ï¼šè¢«å”¤é†’åï¼Œé‡æ–°è·å¾—ä¸»äº’æ–¥é”ï¼Œç»§ç»­æ‰§è¡Œã€‚</li>
</ul>
<p><strong>2. <code>broadcast</code> å‡½æ•°</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">broadcast</span><span class="params">(<span class="keyword">struct</span> condvar *cv)</span> &#123;</span><br><span class="line">    mutex_lock(&amp;cv-&gt;lock);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; cv-&gt;nwait; i++) &#123;</span><br><span class="line">        V(&amp;cv-&gt;sleep);</span><br><span class="line">    &#125;</span><br><span class="line">    cv-&gt;nwait = <span class="number">0</span>;</span><br><span class="line">    mutex_unlock(&amp;cv-&gt;lock);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><code>mutex_lock(&amp;cv-&gt;lock)</code>ï¼šä¿æŠ¤ nwait
å˜é‡ï¼Œé˜²æ­¢å¹¶å‘ä¿®æ”¹ã€‚</li>
<li><code>for (int i = 0; i &lt; cv-&gt;nwait; i++) V(&amp;cv-&gt;sleep);</code>ï¼šå”¤é†’æ‰€æœ‰ç­‰å¾…çš„çº¿ç¨‹ï¼ˆæ¯ä¸ªçº¿ç¨‹å¯¹åº”ä¸€æ¬¡
V æ“ä½œï¼‰ã€‚</li>
<li><code>cv-&gt;nwait = 0;</code>ï¼šé‡ç½®ç­‰å¾…è®¡æ•°ã€‚</li>
<li><code>mutex_unlock(&amp;cv-&gt;lock)</code>ï¼šé‡Šæ”¾é”ã€‚</li>
</ul>
<h4 id="ä¿¡å·é‡å®ç°æ¡ä»¶å˜é‡å‡ºç°çš„é—®é¢˜">ä¿¡å·é‡å®ç°æ¡ä»¶å˜é‡å‡ºç°çš„é—®é¢˜</h4>
<ul>
<li>çº¿ç¨‹T2è°ƒç”¨wait()ï¼Œæ­¤æ—¶å·²ç»æŠŠè‡ªå·±æ ‡è®°ä¸ºç­‰å¾…ï¼ˆnwait++ï¼‰ï¼Œä½†è¿˜æ²¡çœŸæ­£é˜»å¡ï¼ˆè¿˜æ²¡æ‰§è¡ŒPï¼‰ã€‚</li>
<li>è¿™æ—¶ï¼Œå› ä¸ºå…¶å®ƒçº¿ç¨‹çš„æ“ä½œï¼Œå¦ä¸€ä¸ªçº¿ç¨‹T1è°ƒç”¨broadcast()ï¼Œå”¤é†’äº†æ‰€æœ‰ç­‰å¾…çº¿ç¨‹ï¼ˆVæ“ä½œï¼‰ï¼Œå¹¶ç»§ç»­æ‰§è¡Œã€‚</li>
<li>æ­¤æ—¶nwaitå·²ç»å½’é›¶ï¼ŒT2å°±ä¼šç¡æ­»</li>
</ul>
<p>ä»ç†è®ºä¸Šæ¥è¯´ï¼Œæˆ‘ä»¬å¸Œæœ›<code>nwait++</code>,
<code>mutex_unlock</code>å’ŒPæ“ä½œæ˜¯åŸå­æ€§çš„ï¼Œå¹¶ä¸”<code>mutex_unlock</code>å’ŒPæ“ä½œä¸å¯ä»¥äº’æ¢ä½ç½®ï¼ˆä¼šåœ¨ç¡æ—¶ä¸€ç›´æŒæœ‰é”ï¼Œæ­»é”äº†ï¼‰ï¼Œä½†æ˜¯å®é™…ä¸Šæˆ‘ä»¬éœ€è¦æ“ä½œç³»ç»Ÿç”¨ç±»ä¼¼æ¡ä»¶å˜é‡çš„æœºåˆ¶å¸®æˆ‘ä»¬å®ç°waitå’Œreleaseçš„åŸå­æ€§ï¼Œè¿™æ ·å°±å¥—å¨ƒäº†</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://mackz-maxw.github.io/2025/07/03/kamabagu4/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Mackz-Maxw">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Maxwçš„å°ç«™">
      <meta itemprop="description" content="ä¹˜ä¸Šç‡ƒçŠ€èˆ¹ï¼Œè¿˜æœªæ›¾å»è¿‡å€’æ‚¬å±±ã€‚">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Maxwçš„å°ç«™">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/07/03/kamabagu4/" class="post-title-link" itemprop="url">ä»£ç éšæƒ³å½• | å…«è‚¡-HTTPç‰ˆæœ¬</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2025-07-04 08:06:11" itemprop="dateCreated datePublished" datetime="2025-07-04T08:06:11+08:00">2025-07-04</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2025-07-27 04:18:53" itemprop="dateModified" datetime="2025-07-27T04:18:53+08:00">2025-07-27</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/comp-basic/" itemprop="url" rel="index"><span itemprop="name">comp basic</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="http1.0å’Œhttp1.1çš„åŒºåˆ«">HTTP1.0å’ŒHTTP1.1çš„åŒºåˆ«</h3>
<p><strong>ğŸš— è¿æ¥æ–¹å¼ï¼šä»â€œä¸€æ¬¡ä¸€è¯·â€åˆ°â€œå¤šæ¬¡å¤ç”¨â€</strong> * <strong>HTTP
1.0ï¼š</strong>
<strong>é»˜è®¤çŸ­è¿æ¥</strong>ã€‚æµè§ˆå™¨æ¯è¯·æ±‚ä¸€ä¸ªèµ„æºï¼ˆå›¾ç‰‡ã€CSSã€JSç­‰ï¼‰ï¼Œéƒ½è¦å’ŒæœåŠ¡å™¨<strong>å»ºç«‹ä¸€æ¬¡æ–°çš„TCPè¿æ¥</strong>ï¼Œç”¨å®Œåç«‹å³å…³é—­ã€‚
* <strong>HTTP 1.1ï¼š</strong>
<strong>é»˜è®¤æŒä¹…è¿æ¥</strong>ã€‚æµè§ˆå™¨å’ŒæœåŠ¡å™¨å»ºç«‹ä¸€ä¸ªTCPè¿æ¥åï¼Œå¯ä»¥åœ¨è¿™ä¸ªè¿æ¥ä¸Š<strong>è¿ç»­å‘é€å¤šä¸ªè¯·æ±‚å’Œæ¥æ”¶å¤šä¸ªå“åº”</strong>é€šè¿‡Connection:
keep-aliveå¤´æ¥å®ç°æŒä¹…è¿æ¥ã€‚</p>
<p><strong>ğŸ  Hostå¤´ï¼šä»â€œå•é—´å¹³æˆ¿â€åˆ°â€œå…±äº«å…¬å¯“â€</strong> * <strong>HTTP
1.0ï¼š</strong>
è¯·æ±‚ä¸­<strong>æ²¡æœ‰<code>Host</code>è¯·æ±‚å¤´</strong>ã€‚æœåŠ¡å™¨è®¤ä¸ºä¸€ä¸ªIPåœ°å€å°±å¯¹åº”ä¸€ä¸ªç½‘ç«™ï¼ˆä¸€ä¸ªâ€œä¸»æœºâ€ï¼‰ã€‚æƒ³è±¡æˆï¼šä¸€ä¸ªé—¨ç‰Œå·åªä½ä¸€æˆ·äººå®¶ã€‚
* <strong>HTTP 1.1ï¼š</strong>
<strong>è¯·æ±‚ä¸­å¿…é¡»åŒ…å«<code>Host</code>è¯·æ±‚å¤´</strong>ã€‚æŒ‡æ˜è¯·æ±‚è¦è®¿é—®çš„æ˜¯æœåŠ¡å™¨ä¸Šçš„å“ªä¸ª<strong>è™šæ‹Ÿä¸»æœº/åŸŸå</strong>ã€‚è¿™ä½¿<strong>è™šæ‹Ÿä¸»æœºæ‰˜ç®¡</strong>æˆä¸ºå¯èƒ½ï¼ˆä¸€å°æœåŠ¡å™¨æ‰˜ç®¡å¤šä¸ªä¸åŒåŸŸåçš„ç½‘ç«™ï¼‰ã€‚è±¡æˆï¼šä¸€ä¸ªé—¨ç‰Œå·ï¼ˆæœåŠ¡å™¨IPï¼‰é‡Œä½äº†å¥½å‡ æˆ·äººå®¶ï¼ˆä¸åŒç½‘ç«™ï¼‰ï¼Œé€å¿«é€’å¿…é¡»å†™æ˜æ”¶ä»¶äººå§“åï¼ˆ<code>Host</code>å¤´ï¼‰æ‰çŸ¥é“é€åˆ°å“ªæˆ·ã€‚</p>
<p><strong>ğŸš€ è¯·æ±‚å¤„ç†ï¼šä»â€œæ’é˜Ÿç­‰â€åˆ°â€œè¿ç»­å‘â€ï¼ˆç†è®ºä¸Šï¼‰</strong> *
<strong>HTTP 1.0ï¼š</strong>
å®¢æˆ·ç«¯å¿…é¡»<strong>ç­‰å‰ä¸€ä¸ªè¯·æ±‚çš„å“åº”å®Œå…¨è¿”å›åï¼Œæ‰èƒ½å‘é€ä¸‹ä¸€ä¸ªè¯·æ±‚</strong>ã€‚æƒ³è±¡æˆï¼šæ”¶è´¹ç«™ï¼Œå‰ä¸€è¾†è½¦å®Œå…¨é€šè¿‡æ æ†è½ä¸‹å†æŠ¬èµ·ï¼Œåä¸€è¾†è½¦æ‰èƒ½è¿›ã€‚
* <strong>HTTP 1.1ï¼š</strong>
æ”¯æŒ<strong>ç®¡é“åŒ–</strong>ã€‚å®¢æˆ·ç«¯å¯ä»¥<strong>åœ¨ä¸€ä¸ªè¿æ¥ä¸Šè¿ç»­å‘é€å¤šä¸ªè¯·æ±‚ï¼Œè€Œä¸ç”¨ç­‰å¾…æ¯ä¸ªå“åº”</strong>ã€‚æœåŠ¡å™¨å¿…é¡»æŒ‰ç…§æ”¶åˆ°è¯·æ±‚çš„é¡ºåºè¿”å›å“åº”ã€‚æƒ³è±¡æˆï¼šæ”¶è´¹ç«™å…è®¸è¿ç»­è¿›å¤šè¾†è½¦ï¼Œå‡ºæ¥çš„é¡ºåºå¿…é¡»å’Œè¿›å»çš„é¡ºåºä¸€è‡´ã€‚<strong>ï¼ˆç†è®ºä¸Šæå‡é€Ÿåº¦ï¼Œä½†å®è·µä¸­é—®é¢˜å¤šï¼Œè¾ƒå°‘ç”¨ï¼‰</strong></p>
<p><strong>ğŸ§Š ç¼“å­˜æ§åˆ¶ï¼šä»â€œç®€å•æŒ‡ç¤ºâ€åˆ°â€œç²¾ç»†ç®¡ç†â€</strong> * <strong>HTTP
1.0ï¼š</strong>
ä¸»è¦ç”¨<code>If-Modified-Since/Expires</code>ï¼ˆç»å¯¹è¿‡æœŸæ—¶é—´ï¼‰å’Œ<code>Pragma: no-cache</code>ï¼ˆç®€å•ä¸ç¼“å­˜ï¼‰æ§åˆ¶ç¼“å­˜ã€‚åŠŸèƒ½ç®€å•ï¼Œä¸å¤Ÿçµæ´»ã€‚
* <strong>HTTP 1.1ï¼š</strong>
å¼•å…¥äº†æ›´å¼ºå¤§ã€æ›´ç²¾ç»†çš„<strong><code>Cache-Control</code>å¤´</strong>ã€‚å¯ä»¥æŒ‡å®š<code>max-age</code>ï¼ˆç›¸å¯¹è¿‡æœŸæ—¶é—´ï¼‰ã€<code>no-cache</code>ï¼ˆéœ€é‡æ–°éªŒè¯ï¼‰ã€<code>no-store</code>ï¼ˆç¦æ­¢å­˜å‚¨ï¼‰ã€<code>public``private</code>ç­‰ä¼—å¤šæŒ‡ä»¤ã€‚<strong>ï¼ˆç¼“å­˜æ§åˆ¶èƒ½åŠ›å¤§å¤§å¢å¼ºï¼ï¼‰</strong>ä¹Ÿå¯ä½¿ç”¨<code>If-None-Match/Etag</code></p>
<p><strong>â³ å¸¦å®½ä¼˜åŒ–ï¼šä»â€œå…¨æœ‰å…¨æ— â€åˆ°â€œæŒ‰éœ€å–ä»¶â€</strong> * <strong>HTTP
1.0ï¼š</strong>
å¦‚æœä¸‹è½½å¤§æ–‡ä»¶ä¸­æ–­ï¼Œ<strong>å¿…é¡»ä»å¤´å¼€å§‹é‡æ–°ä¸‹è½½</strong>ã€‚ *
<strong>HTTP 1.1ï¼š</strong>
æ”¯æŒ<strong>æ–­ç‚¹ç»­ä¼ </strong>ã€‚ä½¿ç”¨<code>Range</code>è¯·æ±‚å¤´å¯ä»¥æŒ‡å®šåªè¯·æ±‚èµ„æºçš„ä¸€éƒ¨åˆ†ï¼ˆå¦‚ä»ç¬¬1000ä¸ªå­—èŠ‚å¼€å§‹ï¼‰ï¼ŒæœåŠ¡å™¨ç”¨<code>206 Partial Content</code>çŠ¶æ€ç å’Œ<code>Content-Range</code>å“åº”å¤´å›éƒ¨åˆ†å†…å®¹ã€‚æƒ³è±¡æˆï¼šä¸‹è½½ç”µå½±æ–­ç½‘äº†ï¼Œç»­æ’­æ—¶å¯ä»¥ä»ä¸Šæ¬¡æ–­å¼€çš„åœ°æ–¹ç»§ç»­ä¸‹è½½ï¼Œä¸ç”¨é‡å¤´çœ‹ã€‚</p>
<p><strong>ğŸ“¦ åˆ†å—ä¼ è¾“ï¼šä»â€œç­‰èœé½â€åˆ°â€œè¾¹åšè¾¹ä¸Šâ€</strong> * <strong>HTTP
1.0ï¼š</strong>
æœåŠ¡å™¨å¿…é¡»åœ¨çŸ¥é“èµ„æºçš„<strong>å®Œæ•´é•¿åº¦</strong>ï¼ˆ<code>Content-Length</code>ï¼‰åæ‰èƒ½å¼€å§‹å‘é€å“åº”ã€‚å¯¹äºåŠ¨æ€ç”Ÿæˆçš„å†…å®¹ï¼Œéœ€è¦ç­‰å…¨éƒ¨ç”Ÿæˆå®Œæ‰èƒ½å‘é€ã€‚
* <strong>HTTP 1.1ï¼š</strong>
å¼•å…¥äº†<strong>åˆ†å—ä¼ è¾“ç¼–ç </strong>ã€‚æœåŠ¡å™¨å¯ä»¥å°†å“åº”åˆ†æˆå¤šä¸ªâ€œå—â€å‘é€ï¼Œå¹¶åœ¨æœ€åä¸€ä¸ªå—å‘é€å®Œæ¯•åæ ‡è®°ç»“æŸã€‚ä½¿ç”¨<code>Transfer-Encoding: chunked</code>å“åº”å¤´ã€‚æƒ³è±¡æˆï¼šå¨æˆ¿è¾¹èœè¾¹ç«¯ä¸Šæ¡Œï¼Œä¸ç”¨ç­‰æ‰€æœ‰èœéƒ½åšå¥½ã€‚<strong>ï¼ˆæå‡åŠ¨æ€å†…å®¹å“åº”é€Ÿåº¦ï¼Œå‡å°‘å»¶è¿Ÿï¼‰</strong></p>
<p><strong>ğŸ“ é”™è¯¯å¤„ç†ï¼šä»â€œæ¨¡ç³Šâ€åˆ°â€œæ›´æ˜ç¡®â€</strong> * <strong>HTTP
1.1ï¼š</strong> æ–°å¢äº†ä¸€äº›çŠ¶æ€ç ï¼Œæä¾›æ›´ç²¾ç¡®çš„é”™è¯¯ä¿¡æ¯ï¼š *
<code>409 Conflict</code>ï¼šè¯·æ±‚ä¸æœåŠ¡å™¨å½“å‰çŠ¶æ€å†²çªã€‚ *
<code>410 Gone</code>ï¼šèµ„æºè¢«æ°¸ä¹…åˆ é™¤ï¼ˆæ¯”<code>404 Not Found</code>æ›´æ˜ç¡®ï¼‰ã€‚
*
<code>100 Continue</code>ï¼šå®¢æˆ·ç«¯å‘é€å¤§è¯·æ±‚ä½“å‰ï¼Œå…ˆè¯¢é—®æœåŠ¡å™¨æ˜¯å¦æ„¿æ„æ¥æ”¶ï¼ŒæœåŠ¡å™¨åŒæ„ï¼ˆ<code>100 Continue</code>ï¼‰åå†å‘å®Œæ•´è¯·æ±‚ã€‚é¿å…å¸¦å®½æµªè´¹ã€‚
* <strong>å“åº”æ ¼å¼ï¼š</strong> HTTP 1.1
è¦æ±‚å“åº”è¡Œä¸­å¿…é¡»åŒ…å«<strong>åŸå› çŸ­è¯­</strong>ï¼ˆå¦‚
<code>HTTP/1.1 200 OK</code>ï¼‰ï¼Œè€Œ 1.0
åªè¦æ±‚çŠ¶æ€ç æ˜¯å¯é€‰çš„ï¼ˆè™½ç„¶å®è·µä¸­é€šå¸¸éƒ½æœ‰ï¼‰ã€‚</p>
<h3 id="http2.0ä¸http1.1çš„åŒºåˆ«">HTTP2.0ä¸HTTP1.1çš„åŒºåˆ«ï¼Ÿ</h3>
<blockquote>
<p><strong>ä¸€å¥è¯è®°å¿†ï¼šHTTP/2 = æ›´å¿«ã€æ›´æ™ºèƒ½ã€æ›´çœèµ„æºï¼</strong></p>
</blockquote>
<h4 id="ä¼ è¾“æ–¹å¼ä»æ–‡æœ¬æ’é˜Ÿåˆ°äºŒè¿›åˆ¶åˆ†å¸§">1ï¸âƒ£
<strong>ä¼ è¾“æ–¹å¼ï¼šä»â€œæ–‡æœ¬æ’é˜Ÿâ€åˆ°â€œäºŒè¿›åˆ¶åˆ†å¸§â€</strong></h4>
<ul>
<li><strong>HTTP/1.1ï¼š</strong>
<ul>
<li>ç”¨<strong>çº¯æ–‡æœ¬æ ¼å¼</strong>å‘é€è¯·æ±‚å’Œå“åº”ï¼ˆæ¯”å¦‚
<code>GET /index.html HTTP/1.1</code>ï¼‰ã€‚<br />
</li>
<li>å¤šä¸ªè¯·æ±‚å¿…é¡»<strong>æ’é˜Ÿä¸²è¡Œå¤„ç†</strong>ï¼ˆå³ä½¿å¼€äº†ç®¡é“åŒ–ä¹Ÿæœ‰é˜Ÿå¤´é˜»å¡é—®é¢˜ï¼‰ã€‚<br />
</li>
<li><strong>æƒ³è±¡ï¼š</strong>
é‚®å±€ç”¨æ˜ä¿¡ç‰‡å¯„ä¿¡ï¼Œä¸€æ¬¡åªèƒ½å¯„ä¸€å¼ ï¼Œå¿…é¡»ç­‰å›ä¿¡æ‰èƒ½å¯„ä¸‹ä¸€å¼ ï¼Œæ•ˆç‡ä½ã€‚âœ‰ï¸â¡ï¸âœ‰ï¸â¡ï¸âœ‰ï¸</li>
</ul></li>
<li><strong>HTTP/2ï¼š</strong>
<ul>
<li>å°†æ•°æ®æ‹†åˆ†æˆæ›´å°çš„<strong>äºŒè¿›åˆ¶å¸§ï¼ˆFrameï¼‰</strong>ï¼ˆå¤´éƒ¨å¸§ HEADERS
+ æ•°æ®å¸§ DATAï¼‰ã€‚<br />
</li>
<li>åŒä¸€ä¸ªè¿æ¥ä¸Šï¼Œ<strong>å¤šä¸ªè¯·æ±‚/å“åº”çš„å¸§å¯ä»¥æ··åˆå‘é€ã€å¹¶è¡Œä¼ è¾“</strong>ï¼Œäº’ä¸é˜»å¡ï¼<br />
</li>
<li><strong>æƒ³è±¡ï¼š</strong>
å¿«é€’å…¬å¸æŠŠåŒ…è£¹æ‹†æˆå°ä»¶ï¼Œæ‰“ä¸Šæ ‡ç­¾ï¼Œé€šè¿‡ç«‹ä½“åˆ†æ‹£é€šé“åŒæ—¶è¿è¾“ï¼Œåˆ°ç›®çš„åœ°å†ç»„è£…ã€‚ğŸ“¦ğŸ“¦ğŸ“¦
â†’ ğŸššğŸ’¨</li>
</ul></li>
</ul>
<p>ğŸ‘‰
<strong>æ ¸å¿ƒä»·å€¼ï¼šå½»åº•è§£å†³é˜Ÿå¤´é˜»å¡ï¼Œå¤§å¹…æå‡å¹¶å‘æ•ˆç‡ï¼</strong></p>
<h4 id="è¿æ¥æ–¹å¼ä»å¤šè·¯æ’é˜Ÿåˆ°çœŸå¤šè·¯å¤ç”¨">2ï¸âƒ£
<strong>è¿æ¥æ–¹å¼ï¼šä»â€œå¤šè·¯æ’é˜Ÿâ€åˆ°â€œçœŸÂ·å¤šè·¯å¤ç”¨â€</strong></h4>
<ul>
<li><strong>HTTP/1.1ï¼š</strong>
<ul>
<li>è™½ç„¶æ”¯æŒæŒä¹…è¿æ¥ï¼ˆä¸€ä¸ªTCPè¿å¤šä¸ªè¯·æ±‚ï¼‰ï¼Œä½†<strong>å“åº”å¿…é¡»æŒ‰é¡ºåºè¿”å›</strong>ï¼ˆé˜Ÿå¤´é˜»å¡ï¼‰ã€‚<br />
</li>
<li>æµè§ˆå™¨é€šå¸¸å¼€ <strong>6~8ä¸ªTCPè¿æ¥</strong>
å¹¶è¡Œè¯·æ±‚èµ„æºï¼ˆä½†å ç”¨èµ„æºå¤šï¼‰ã€‚</li>
</ul></li>
<li><strong>HTTP/2ï¼š</strong>
<ul>
<li><strong>ä¸€ä¸ªTCPè¿æ¥</strong> ä¸Šå³å¯å®ç°
<strong>æˆç™¾ä¸Šåƒä¸ªæµçš„å¹¶è¡Œä¼ è¾“</strong>ï¼ˆæ¯ä¸ªæµæ˜¯ä¸€ä¸ªè¯·æ±‚/å“åº”ï¼‰ã€‚<br />
</li>
<li>å¸§è‡ªå¸¦æµIDæ ‡è¯†ï¼Œæ¥æ”¶æ–¹èƒ½æŒ‰IDé‡ç»„æ•°æ®ï¼Œæ— éœ€æ’é˜Ÿç­‰å¾…ï¼<br />
</li>
<li><strong>æƒ³è±¡ï¼š</strong> ä»å¤šæ¡ä¹¡é—´å°è·¯ â†’
å‡çº§æˆä¸€æ¡åŒå‘åè½¦é“é«˜é€Ÿè·¯ï¼Œæ‰€æœ‰è½¦è¾†ï¼ˆè¯·æ±‚ï¼‰ç•…é€šæ— é˜»ã€‚ğŸ›£ï¸ğŸš—ğŸš™ğŸš•</li>
</ul></li>
</ul>
<p>ğŸ‘‰
<strong>æ ¸å¿ƒä»·å€¼ï¼šä¸€ä¸ªè¿æ¥è§£å†³æ‰€æœ‰è¯·æ±‚ï¼Œçœèµ„æºã€ä½å»¶è¿Ÿï¼</strong></p>
<h4 id="å¤´éƒ¨ä¿¡æ¯ä»é‡å¤è‡ƒè‚¿åˆ°é«˜æ•ˆå‹ç¼©">3ï¸âƒ£
<strong>å¤´éƒ¨ä¿¡æ¯ï¼šä»â€œé‡å¤è‡ƒè‚¿â€åˆ°â€œé«˜æ•ˆå‹ç¼©â€</strong></h4>
<ul>
<li><strong>HTTP/1.1ï¼š</strong>
<ul>
<li>æ¯æ¬¡è¯·æ±‚éƒ½æºå¸¦å¤§é‡<strong>é‡å¤çš„æ–‡æœ¬å¤´éƒ¨</strong>ï¼ˆå¦‚Cookieã€User-Agentï¼‰ï¼Œä¸å‹ç¼©ã€‚<br />
</li>
<li><strong>æµªè´¹å¸¦å®½</strong>ï¼ˆå°¤å…¶å°æ–‡ä»¶è¯·æ±‚æ—¶ï¼Œå¤´éƒ¨å¯èƒ½æ¯”æ•°æ®è¿˜å¤§ï¼‰ã€‚</li>
</ul></li>
<li><strong>HTTP/2ï¼š</strong>
<ul>
<li>ä½¿ç”¨ <strong>HPACK ç®—æ³•å‹ç¼©å¤´éƒ¨</strong>ï¼š
<ul>
<li>å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ç»´æŠ¤<strong>â€œå¤´éƒ¨å­—å…¸â€</strong>ï¼Œç›¸åŒå¤´éƒ¨åªä¼ ç´¢å¼•ï¼›<br />
</li>
<li>ç”¨éœå¤«æ›¼ç¼–ç å‹ç¼©æ–‡æœ¬ã€‚<br />
</li>
</ul></li>
<li><strong>å¤´éƒ¨å¤§å°å‡å°‘ 30%~90%</strong>ï¼<br />
</li>
<li><strong>æƒ³è±¡ï¼š</strong> ä»æ¯æ¬¡å¯„ä¿¡éƒ½æ‰‹å†™å®Œæ•´åœ°å€ â†’
æ”¹ç”¨ç”µå­äºŒç»´ç æ‰«ç å¯„ä»¶ï¼Œåœ°å€åº“è‡ªåŠ¨åŒ¹é…ã€‚ğŸ“®â†’ğŸ“²</li>
</ul></li>
</ul>
<p>ğŸ‘‰ <strong>æ ¸å¿ƒä»·å€¼ï¼šå¤§å¹…èŠ‚çœå¸¦å®½ï¼ŒåŠ å¿«å°èµ„æºåŠ è½½ï¼</strong></p>
<h4 id="æœåŠ¡å™¨ä¸»åŠ¨æ¨é€ä»è¢«åŠ¨å“åº”åˆ°ä¸»åŠ¨é€è´§">4ï¸âƒ£
<strong>æœåŠ¡å™¨ä¸»åŠ¨æ¨é€ï¼šä»â€œè¢«åŠ¨å“åº”â€åˆ°â€œä¸»åŠ¨é€è´§â€</strong></h4>
<ul>
<li><strong>HTTP/1.1ï¼š</strong>
<ul>
<li>æœåŠ¡å™¨<strong>åªèƒ½è¢«åŠ¨å“åº”</strong>å®¢æˆ·ç«¯è¯·æ±‚ã€‚<br />
</li>
<li>æµè§ˆå™¨éœ€è§£æHTMLåï¼Œå†è¯·æ±‚CSS/JS/å›¾ç‰‡ç­‰ä¾èµ–èµ„æºã€‚</li>
</ul></li>
<li><strong>HTTP/2ï¼š</strong>
<ul>
<li>æœåŠ¡å™¨å¯<strong>ä¸»åŠ¨æ¨é€</strong>å®¢æˆ·ç«¯å¯èƒ½éœ€è¦çš„èµ„æºï¼ˆå¦‚CSS/JSï¼‰ï¼<br />
</li>
<li>å®¢æˆ·ç«¯å¯ç¼“å­˜æ¨é€å†…å®¹ï¼Œä¸‹æ¬¡ç›´æ¥ä½¿ç”¨ã€‚<br />
</li>
<li><strong>æƒ³è±¡ï¼š</strong>
ç‚¹å¤–å–æ—¶ï¼Œå•†å®¶ä¸ä»…é€ç±³é¥­ï¼Œè¿˜ä¸»åŠ¨é™„èµ äº†ç­·å­å’Œçº¸å·¾ï¼ˆä½ çŸ¥é“ä½ ä¸€å®šä¼šéœ€è¦ï¼‰ã€‚ğŸš+ğŸ¥¢+ğŸ§»</li>
</ul></li>
</ul>
<p>ğŸ‘‰ <strong>æ ¸å¿ƒä»·å€¼ï¼šå‡å°‘è¯·æ±‚å¾€è¿”æ¬¡æ•°ï¼ŒåŠ é€Ÿé¡µé¢æ¸²æŸ“ï¼</strong></p>
<h4 id="ä¼˜å…ˆçº§ä¸æµé‡æ§åˆ¶æ›´æ™ºèƒ½çš„èµ„æºè°ƒåº¦">5ï¸âƒ£
<strong>ä¼˜å…ˆçº§ä¸æµé‡æ§åˆ¶ï¼šæ›´æ™ºèƒ½çš„èµ„æºè°ƒåº¦</strong></h4>
<ul>
<li><strong>HTTP/2ï¼š</strong>
<ul>
<li>å®¢æˆ·ç«¯å¯ä¸ºè¯·æ±‚æ ‡è®°<strong>ä¼˜å…ˆçº§</strong>ï¼ˆå¦‚CSS &gt;
å›¾ç‰‡ï¼‰ï¼ŒæœåŠ¡å™¨ä¼˜å…ˆå¤„ç†é«˜ä¼˜å…ˆçº§æµã€‚<br />
</li>
<li>æ”¯æŒç²¾ç»†çš„<strong>æµé‡æ§åˆ¶</strong>ï¼ˆåŸºäºæ¯ä¸ªæµæ§åˆ¶ä¼ è¾“é€Ÿç‡ï¼‰ã€‚<br />
</li>
</ul></li>
<li><strong>HTTP/1.1ï¼š</strong>
æ— æ³•çœŸæ­£å®ç°ä¼˜å…ˆçº§è°ƒåº¦ï¼ˆä¾èµ–æµè§ˆå™¨å¯å‘å¼ç­–ç•¥ï¼‰ã€‚</li>
</ul>
<h4 id="æ³¨æ„">âš ï¸ æ³¨æ„ï¼š</h4>
<ol type="1">
<li>HTTP/2 <strong>æœªåŠ å¯†</strong>ï¼Œä½†æ‰€æœ‰ä¸»æµæµè§ˆå™¨åªæ”¯æŒ
<strong>HTTP/2 Over TLS</strong>ï¼ˆå³ HTTPSï¼‰ã€‚<br />
</li>
<li>HTTP/2 è§£å†³äº†åº”ç”¨å±‚é˜Ÿå¤´é˜»å¡ï¼Œä½† <strong>TCP
å±‚ä»æœ‰é˜Ÿå¤´é˜»å¡</strong>ï¼ˆä¸¢åŒ…ä¼šé˜»å¡æ‰€æœ‰æµï¼‰ã€‚<br />
</li>
<li>è¿™æ˜¯ HTTP/3ï¼ˆåŸºäºQUIC/UDPï¼‰è¦è§£å†³çš„ä¸‹ä¸€ä»£é—®é¢˜ï¼</li>
</ol>
<h3 id="http3.0æœ‰äº†è§£è¿‡å—">HTTP3.0æœ‰äº†è§£è¿‡å—ï¼Ÿ</h3>
<p>ğŸš€ <strong>æ ¸å¿ƒä¸€å¥è¯ï¼šHTTP/3 = æŠ›å¼ƒTCPï¼æ‹¥æŠ±QUICï¼</strong> &gt;
<strong>è§£å†³ HTTP/2 çš„ç»ˆæç—›ç‚¹ï¼šTCP çš„é˜Ÿå¤´é˜»å¡ï¼</strong></p>
<h4 id="åº•å±‚åè®®é©å‘½ä»-tcp-åˆ°-quicåŸºäºudp">1ï¸âƒ£ <strong>åº•å±‚åè®®é©å‘½ï¼šä»
TCP åˆ° QUICï¼ˆåŸºäºUDPï¼‰</strong></h4>
<ul>
<li><strong>HTTP/1.1 &amp; HTTP/2ï¼š</strong> éƒ½è·‘åœ¨ <strong>TCP</strong>
åè®®ä¹‹ä¸Šã€‚
<ul>
<li><strong>TCP é—®é¢˜ï¼š</strong>
å¦‚æœä¼ è¾“ä¸­<strong>ä¸¢äº†ä¸€ä¸ªåŒ…</strong>ï¼Œåç»­æ‰€æœ‰åŒ…éƒ½è¦ç­‰å¾…é‡ä¼ ï¼ˆå³ä½¿å®ƒä»¬å±äºä¸åŒè¯·æ±‚ï¼‰ï¼Œè¿™å°±æ˜¯
<strong>TCP é˜Ÿå¤´é˜»å¡</strong>ã€‚<br />
</li>
<li><strong>æƒ³è±¡ï¼š</strong>
å¿«é€’è½¦é˜Ÿèµ°ä¸€æ¡å•è¡Œé“ï¼Œå‰ä¸€è¾†è½¦æŠ›é”šï¼Œåé¢æ‰€æœ‰è½¦éƒ½å¾—å µç€ç­‰ï¼ˆæ— è®ºæ˜¯ä¸æ˜¯åŒä¸€æ‰¹è´§ç‰©ï¼‰ã€‚ğŸššâŒğŸš›ğŸš—ğŸš<br />
</li>
</ul></li>
<li><strong>HTTP/3ï¼š</strong> å½»åº•æŠ›å¼ƒ TCPï¼Œæ”¹ç”¨å…¨æ–°åè®®
<strong>QUICï¼ˆQuick UDP Internet Connectionsï¼‰</strong>ï¼Œè¿è¡Œåœ¨
<strong>UDP</strong> ä¹‹ä¸Šã€‚
<ul>
<li><strong>QUIC ä¼˜åŠ¿ï¼š</strong>
æ¯ä¸ªè¯·æ±‚/å“åº”æµæ˜¯<strong>ç‹¬ç«‹ä¼ è¾“çš„</strong>ï¼Œä¸¢åŒ…åªå½±å“å½“å‰æµï¼Œå…¶ä»–æµç•…é€šæ— é˜»ï¼<br />
</li>
<li><strong>æƒ³è±¡ï¼š</strong>
å¿«é€’æ”¹ç”¨æ— äººæœºé…é€ï¼Œæ¯ä»¶åŒ…è£¹ç‹¬ç«‹é£è¡Œè·¯çº¿ï¼Œä¸€ä¸ªåŒ…è£¹å‡ºé—®é¢˜ï¼Œå…¶ä»–åŒ…è£¹ç…§å¸¸é€è¾¾ã€‚âœˆï¸ğŸ“¦â¡ï¸ğŸ 
| âœˆï¸ğŸ“¦â¡ï¸ğŸ  | ğŸ’¥ğŸ“¦âŒ | âœˆï¸ğŸ“¦â¡ï¸ğŸ <br />
ğŸ‘‰
<strong>æ ¸å¿ƒä»·å€¼ï¼šå½»åº•æ¶ˆç­ä¼ è¾“å±‚é˜Ÿå¤´é˜»å¡ï¼Œç½‘ç»œæ³¢åŠ¨æ—¶æ€§èƒ½å¤§å¹…æå‡ï¼</strong></li>
</ul></li>
</ul>
<h4 id="å»ºè¿é€Ÿåº¦é£è·ƒ0-rtt-ä¸-1-rtt-æ¡æ‰‹">2ï¸âƒ£ <strong>å»ºè¿é€Ÿåº¦é£è·ƒï¼š0-RTT
ä¸ 1-RTT æ¡æ‰‹</strong></h4>
<ul>
<li><strong>HTTP/1.1 &amp; HTTP/2ï¼ˆTCP+TLSï¼‰ï¼š</strong>
<ul>
<li>é¦–æ¬¡è¿æ¥éœ€ <strong>TCP ä¸‰æ¬¡æ¡æ‰‹ï¼ˆ1.5 RTTï¼‰ + TLS æ¡æ‰‹ï¼ˆ1~2 RTTï¼‰ =
æ€»è®¡ 2~3.5 RTT</strong> å»¶è¿Ÿæ‰èƒ½å‘é€æ•°æ®ã€‚<br />
</li>
</ul></li>
<li><strong>HTTP/3ï¼ˆQUICï¼‰ï¼š</strong>
<ul>
<li><strong>é¦–æ¬¡è¿æ¥ï¼š1-RTT æ¡æ‰‹</strong>ï¼ˆQUIC
å°†ä¼ è¾“å’ŒåŠ å¯†æ¡æ‰‹åˆå¹¶ï¼‰ã€‚<br />
</li>
<li><strong>é‡è¿ç”¨æˆ·ï¼š0-RTT
æ¡æ‰‹</strong>ï¼å®¢æˆ·ç«¯ç¼“å­˜äº†æœåŠ¡å™¨å¯†é’¥ï¼Œé¦–æ¬¡è¯·æ±‚å¯ç›´æ¥å¸¦ä¸ŠåŠ å¯†æ•°æ®ã€‚<br />
</li>
<li><strong>æƒ³è±¡ï¼š</strong>
è¿›åœ°é“ç«™â€”â€”æ—§æ–¹å¼ï¼šå…ˆæ’é˜Ÿä¹°ç¥¨ï¼ˆTCPæ¡æ‰‹ï¼‰ï¼Œå†å®‰æ£€ï¼ˆTLSæ¡æ‰‹ï¼‰ï¼›æ–°æ–¹å¼ï¼šåˆ·è„¸ç›´æ¥è¿›ï¼ˆ0-RTTï¼‰ï¼ğŸ«â†’ğŸ›‚â†’ğŸš‡
â†’ ğŸ˜ƒğŸ”œğŸš‡<br />
ğŸ‘‰ <strong>æ ¸å¿ƒä»·å€¼ï¼šé¦–æ¬¡è®¿é—®æ›´å¿«ï¼Œé‡å¤è®¿é—®â€œé—ªç”µå¯åŠ¨â€ï¼</strong></li>
</ul></li>
</ul>
<h4 id="è¿æ¥è¿ç§»ç½‘ç»œåˆ‡æ¢ä¸æ–­çº¿">3ï¸âƒ£
<strong>è¿æ¥è¿ç§»ï¼šç½‘ç»œåˆ‡æ¢ä¸æ–­çº¿</strong></h4>
<ul>
<li><strong>HTTP/1.1 &amp; HTTP/2ï¼š</strong>
<ul>
<li>è¿æ¥ç»‘å®š <strong>IP + ç«¯å£ +
TCPåè®®</strong>ã€‚åˆ‡æ¢ç½‘ç»œï¼ˆå¦‚WiFiâ†’4Gï¼‰ä¼šå¯¼è‡´IPå˜åŒ–ï¼Œè¿æ¥å¿…é¡»é‡å»ºï¼<br />
</li>
</ul></li>
<li><strong>HTTP/3ï¼ˆQUICï¼‰ï¼š</strong>
<ul>
<li>ä½¿ç”¨ <strong>è¿æ¥IDï¼ˆConnection IDï¼‰</strong> å”¯ä¸€æ ‡è¯†è¿æ¥ã€‚<br />
</li>
<li>åˆ‡æ¢ç½‘ç»œæ—¶ï¼Œåªè¦å®¢æˆ·ç«¯èƒ½é€šä¿¡ï¼Œè¿æ¥IDä¸å˜ï¼Œä¼šè¯æ— ç¼å»¶ç»­ï¼<br />
</li>
<li><strong>æƒ³è±¡ï¼š</strong>
æ—§æ‰‹æœºå¡æ¢æ‰‹æœºè¦é‡æ–°æ’å¡æ¿€æ´»ï¼›eSIMå¡æ¢æ‰‹æœºè‡ªåŠ¨è”ç½‘ï¼Œå·ç ä¸å˜ã€‚ğŸ“±â¡ï¸ğŸ“± =
âŒ vs ğŸ“±â¡ï¸ğŸ“± = âœ…<br />
ğŸ‘‰
<strong>æ ¸å¿ƒä»·å€¼ï¼šç§»åŠ¨ç«¯ç¦éŸ³ï¼åœ°é“è¿›éš§é“ã€WiFiåˆ‡5Gï¼Œè§†é¢‘ä¼šè®®ä¸ä¸­æ–­ï¼</strong></li>
</ul></li>
</ul>
<h4 id="å†…åµŒåŠ å¯†å®‰å…¨æ˜¯å¼ºåˆ¶è¦æ±‚">4ï¸âƒ£
<strong>å†…åµŒåŠ å¯†ï¼šå®‰å…¨æ˜¯å¼ºåˆ¶è¦æ±‚</strong></h4>
<ul>
<li><strong>QUIC åè®®è®¾è®¡ä¹‹åˆå°±å¼ºåˆ¶åŠ å¯†</strong>ï¼ˆä½¿ç”¨ TLS 1.3ï¼‰ã€‚<br />
</li>
<li><strong>æ²¡æœ‰æ˜æ–‡çš„ QUICï¼</strong> æ‰€æœ‰å¤´éƒ¨å’Œè½½è·é»˜è®¤åŠ å¯†ã€‚<br />
</li>
<li><strong>å¯¹æ¯”ï¼š</strong> HTTP/2
çš„åŠ å¯†ï¼ˆHTTPSï¼‰æ˜¯å¯é€‰ä½†äº‹å®å¼ºåˆ¶ï¼ŒHTTP/3 ç›´æ¥å†…åµŒåˆ°åè®®å±‚ã€‚<br />
ğŸ‘‰
<strong>æ ¸å¿ƒä»·å€¼ï¼šæå‡å®‰å…¨æ€§ï¼Œé˜²æ­¢è¿è¥å•†åŠ«æŒã€é™ä½ä¸­é—´è®¾å¤‡å¹²æ‰°ã€‚</strong></li>
</ul>
<h4 id="æ”¹è¿›çš„å¤šè·¯å¤ç”¨-å¤´éƒ¨å‹ç¼©">5ï¸âƒ£ <strong>æ”¹è¿›çš„å¤šè·¯å¤ç”¨ &amp;
å¤´éƒ¨å‹ç¼©</strong></h4>
<ul>
<li><strong>å¤šè·¯å¤ç”¨ï¼š</strong> ç»§æ‰¿ HTTP/2
çš„æµå¤šè·¯å¤ç”¨ï¼ˆä¸€ä¸ªè¿æ¥å¹¶å‘å¤šä¸ªæµï¼‰ï¼Œä¸”ç”±äºåŸºäº
QUICï¼Œ<strong>æ— é˜Ÿå¤´é˜»å¡</strong>ã€‚<br />
</li>
<li><strong>å¤´éƒ¨å‹ç¼©ï¼š</strong> å‡çº§ä¸º <strong>QPACK</strong> ç®—æ³•ï¼ˆç±»ä¼¼
HTTP/2 çš„ HPACKï¼Œä½†é€‚åº” QUIC ä¹±åºç‰¹æ€§ï¼‰ã€‚<br />
ğŸ‘‰ <strong>æ ¸å¿ƒä»·å€¼ï¼šåœ¨ HTTP/2 é«˜æ•ˆåŸºç¡€ä¸Šï¼Œæ›´ç¨³å®šï¼</strong></li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://mackz-maxw.github.io/2025/06/29/kamacode30/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Mackz-Maxw">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Maxwçš„å°ç«™">
      <meta itemprop="description" content="ä¹˜ä¸Šç‡ƒçŠ€èˆ¹ï¼Œè¿˜æœªæ›¾å»è¿‡å€’æ‚¬å±±ã€‚">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Maxwçš„å°ç«™">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/06/29/kamacode30/" class="post-title-link" itemprop="url">ä»£ç éšæƒ³å½• | åˆ·é¢˜-åŠ¨æ€è§„åˆ’3</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2025-06-30 06:25:40" itemprop="dateCreated datePublished" datetime="2025-06-30T06:25:40+08:00">2025-06-30</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2025-07-02 09:08:29" itemprop="dateModified" datetime="2025-07-02T09:08:29+08:00">2025-07-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/leetcode/" itemprop="url" rel="index"><span itemprop="name">leetcode</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="åˆ†å‰²ç­‰å’Œå­é›†">416. åˆ†å‰²ç­‰å’Œå­é›†</h3>
<p><strong>åŠ¨æ€è§„åˆ’çš„æ­£ç¡®æ€§</strong>ï¼š -
æ¯æ¬¡è¿­ä»£è€ƒè™‘ä¸€ä¸ªæ–°ç‰©å“çš„æ‰€æœ‰å¯èƒ½ç»„åˆ -
åœ¨ä½¿ç”¨ä¸€ç»´dpæ•°ç»„æ—¶ï¼Œå€’åºéå†ä¿è¯çŠ¶æ€è½¬ç§»åªä¾èµ–<strong>ä¸Šä¸€è½®</strong>ç»“æœ</p>
<p>åŸå§‹æ€è·¯ä¸»è¦é—®é¢˜ï¼š <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¼ªä»£ç </span></span><br><span class="line"><span class="type">int</span> cnt = target;</span><br><span class="line"><span class="keyword">for</span> (éå†æ¯ä¸ªæ•°å­—) &#123;</span><br><span class="line">    <span class="keyword">if</span> (cnt &gt;= å½“å‰æ•°å­—) cnt -= å½“å‰æ•°å­—; <span class="comment">// å¼ºåˆ¶é€‰æ‹©</span></span><br><span class="line">    <span class="keyword">if</span> (dp[cnt]) ... <span class="comment">// ä½†dpä»æœªæ›´æ–°ï¼</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<strong>è´ªå¿ƒé€‰æ‹©é”™è¯¯</strong>ï¼šå¼ºåˆ¶æŒ‰é¡ºåºé€‰æ‹©æ•°å­—ï¼Œä¸èƒ½å¤„ç†éè¿ç»­é€‰æ‹©
ä¹Ÿå¯ä»¥ä½¿ç”¨å¸ƒå°”å€¼åˆ¤æ–­ï¼š <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">canPartition</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; nums)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> eq = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> n : nums)&#123;</span><br><span class="line">            eq += n;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(eq % <span class="number">2</span> == <span class="number">1</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            eq = eq / <span class="number">2</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function">vector&lt;<span class="type">bool</span>&gt; <span class="title">dp</span><span class="params">(eq+<span class="number">1</span>, <span class="literal">false</span>)</span></span>;</span><br><span class="line">        dp[<span class="number">0</span>] = <span class="literal">true</span>;</span><br><span class="line">        <span class="type">int</span> cnt = eq;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> n : nums)&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> e = eq; e&gt;=n; e--)&#123;</span><br><span class="line">                <span class="keyword">if</span>(dp[e - n])&#123;</span><br><span class="line">                    dp[e] = <span class="literal">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span>(dp[eq])<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://mackz-maxw.github.io/2025/06/28/oper_sys12/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Mackz-Maxw">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Maxwçš„å°ç«™">
      <meta itemprop="description" content="ä¹˜ä¸Šç‡ƒçŠ€èˆ¹ï¼Œè¿˜æœªæ›¾å»è¿‡å€’æ‚¬å±±ã€‚">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Maxwçš„å°ç«™">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/06/28/oper_sys12/" class="post-title-link" itemprop="url">æ“ä½œç³»ç»ŸåŸºç¡€ | 3.3 ç³»ç»Ÿè°ƒç”¨å®ç°</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>
      

      <time title="åˆ›å»ºæ—¶é—´ï¼š2025-06-29 04:36:58 / ä¿®æ”¹æ—¶é—´ï¼š23:54:21" itemprop="dateCreated datePublished" datetime="2025-06-29T04:36:58+08:00">2025-06-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/os-basic/" itemprop="url" rel="index"><span itemprop="name">os basic</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="uapi-æ–‡ä»¶ä½ç½®">UAPI æ–‡ä»¶ä½ç½®</h3>
<p><strong>é—®é¢˜èƒŒæ™¯ï¼š</strong><br />
å†…æ ¸å¤´æ–‡ä»¶ä¸­ï¼Œå†…è”å‡½æ•°å¾€å¾€éœ€è¦å¼•ç”¨å…¶ä»–å¤´æ–‡ä»¶çš„ç»“æ„ä½“æˆ–å¸¸é‡ï¼Œä½†è¿™äº›å¤´æ–‡ä»¶ä¹‹é—´åˆå­˜åœ¨ç›¸äº’ä¾èµ–ï¼Œå¯¼è‡´æ— æ³•ç›´æ¥å¼•ç”¨ï¼Œåªèƒ½ç”¨
#define ä»£æ›¿ï¼Œé™ä½äº†ä»£ç è´¨é‡ã€‚</p>
<p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong><br />
David æå‡ºå°†å†…æ ¸å¤´æ–‡ä»¶ä¸­çš„ç”¨æˆ·ç©ºé—´ API
å†…å®¹ï¼ˆå³ç”¨æˆ·ç©ºé—´å¯è§çš„å®šä¹‰ï¼‰æ‹†åˆ†åˆ°æ–°çš„ uapi/
å­ç›®å½•ä¸‹çš„å¯¹åº”å¤´æ–‡ä»¶ä¸­ã€‚è¿™æ ·åšæœ‰ä»¥ä¸‹å¥½å¤„ï¼š</p>
<ul>
<li>ç®€åŒ–å†…æ ¸ä¸“ç”¨å¤´æ–‡ä»¶ï¼Œå‡å°‘ä½“ç§¯ã€‚</li>
<li>æ˜ç¡®åŒºåˆ†ç”¨æˆ·ç©ºé—´ä¸å†…æ ¸ç©ºé—´çš„ APIï¼Œå‡å°‘å¤´æ–‡ä»¶é—´å¤æ‚çš„ç›¸äº’ä¾èµ–ã€‚</li>
<li>ä¾¿äºè¿½è¸ªç”¨æˆ·ç©ºé—´ API çš„å˜æ›´ï¼Œæ–¹ä¾¿ C
åº“ç»´æŠ¤è€…ã€è„šæœ¬è¯­è¨€ç»‘å®šã€æµ‹è¯•ã€æ–‡æ¡£ç­‰ç›¸å…³é¡¹ç›®ã€‚</li>
</ul>
<p><strong>æ‹†åˆ†æ–¹æ³•ï¼š</strong><br />
ä¸€èˆ¬å¤´æ–‡ä»¶ç»“æ„å¦‚ä¸‹ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* å¤´éƒ¨æ³¨é‡Š */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">ifndef</span> _XXXXXX_H</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> _XXXXXX_H</span></span><br><span class="line"></span><br><span class="line">[ç”¨æˆ·ç©ºé—´å®šä¹‰]</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> __KERNEL__</span></span><br><span class="line"></span><br><span class="line">[å†…æ ¸ç©ºé—´å®šä¹‰]</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span> <span class="comment">/* __KERNEL__ */</span></span></span><br><span class="line"></span><br><span class="line">[ç”¨æˆ·ç©ºé—´å®šä¹‰]</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span> <span class="comment">/* _XXXXXX_H */</span></span></span><br></pre></td></tr></table></figure>
<ul>
<li>æ‰€æœ‰æœªè¢« <code>#ifdef __KERNEL__</code> åŒ…è£¹çš„å†…å®¹ï¼Œç§»åŠ¨åˆ° uapi/
ç›®å½•ä¸‹çš„æ–°å¤´æ–‡ä»¶ã€‚</li>
<li><code>#ifdef __KERNEL__</code> å†…çš„å†…å®¹ä¿ç•™åœ¨åŸå¤´æ–‡ä»¶ï¼Œä½†ç§»é™¤
<code>#ifdef</code> å’Œ <code>#endif</code>ã€‚</li>
<li>å¤´éƒ¨æ³¨é‡Šä¿ç•™å¹¶å¤åˆ¶åˆ°æ–°æ–‡ä»¶ã€‚</li>
<li>åŸå¤´æ–‡ä»¶éœ€æ·»åŠ 
<code>#include &lt;include/uapi/path/to/header.h&gt;</code>ï¼Œæ”¾åœ¨å·²æœ‰
<code>#include</code> ä¹‹åã€‚</li>
<li>è‹¥åŸæ–‡ä»¶æ²¡æœ‰ <code>#ifdef __KERNEL__</code>ï¼Œåˆ™ç›´æ¥é‡å‘½åä¸º uapi/
æ–‡ä»¶ã€‚</li>
</ul>
<h4 id="æŠ€æœ¯å®ç°è¦ç‚¹">æŠ€æœ¯å®ç°è¦ç‚¹</h4>
<ul>
<li><strong>å¤´æ–‡ä»¶ç»“æ„è°ƒæ•´</strong>ï¼šå°†æ‰€æœ‰æœªè¢«
<code>#ifdef __KERNEL__</code> åŒ…è£¹çš„å†…å®¹è¿ç§»åˆ° <code>uapi/</code>
ç›®å½•ä¸‹çš„æ–°å¤´æ–‡ä»¶ï¼ŒåŸæ–‡ä»¶åªä¿ç•™å†…æ ¸ä¸“ç”¨éƒ¨åˆ†ï¼Œå¹¶é€šè¿‡ <code>#include</code>
å¼•ç”¨æ–°çš„ uapi å¤´æ–‡ä»¶ã€‚</li>
<li><strong>è‡ªåŠ¨åŒ–è„šæœ¬è¾…åŠ©</strong>ï¼šç”±äºå¤´æ–‡ä»¶é£æ ¼å¤šæ ·ï¼ŒDavid Howell
ç¼–å†™äº†å¤§é‡ shell/Perl
è„šæœ¬è‡ªåŠ¨å®Œæˆæ‹†åˆ†ï¼Œå¹¶å¯¹ç‰¹æ®Šæƒ…å†µé€šè¿‡é¢„å¤„ç†æ ‡è®°è¿›è¡Œâ€œè¾…å¯¼â€ã€‚</li>
<li><strong>å…¼å®¹æ€§ä¸æ„å»ºä¿è¯</strong>ï¼šæ‹†åˆ†åï¼Œå†…æ ¸å’Œç”¨æˆ·ç©ºé—´çš„æ„å»ºæµç¨‹ä¿æŒå…¼å®¹ï¼Œç¡®ä¿åŒ…å«å…³ç³»å’ŒåŠŸèƒ½ä¸å˜ã€‚</li>
</ul>
<h4 id="ç¤¾åŒºè®¨è®ºä¸æŒ‘æˆ˜">ç¤¾åŒºè®¨è®ºä¸æŒ‘æˆ˜</h4>
<ul>
<li><strong>å¤§è§„æ¨¡å˜æ›´çš„å®¡æŸ¥éš¾é¢˜</strong>ï¼šä¸€æ¬¡æ€§ä¿®æ”¹æ•°åƒæ–‡ä»¶ã€æ•°åä¸‡è¡Œä»£ç ï¼Œéš¾ä»¥äººå·¥é€è¡Œå®¡æŸ¥ã€‚ç¤¾åŒºå»ºè®®ä¸»è¦å®¡æŸ¥æ€è·¯å’Œè„šæœ¬å®ç°ï¼Œå¹¶é€šè¿‡è‡ªåŠ¨åŒ–æ„å»ºå’Œå¯¹æ¯”äºŒè¿›åˆ¶äº§ç‰©æ¥éªŒè¯æ­£ç¡®æ€§ã€‚</li>
<li><strong>å¤´æ–‡ä»¶åŒ…å«è·¯å¾„çš„äº‰è®®</strong>ï¼šæœ‰å¼€å‘è€…è´¨ç–‘ uapi
å¤´æ–‡ä»¶æ˜¯å¦åº”åŒ…å«å†…æ ¸å¤´æ–‡ä»¶ï¼Œå®é™…å®ç°ä¸­ä¸ºå…¼å®¹æ€§å’Œæ„å»ºéœ€è¦ï¼Œuapi
å¤´æ–‡ä»¶åœ¨å†…æ ¸æ„å»ºæ—¶ä¼šåŒ…å«å†…æ ¸å¤´æ–‡ä»¶ï¼Œä½†ç”¨æˆ·ç©ºé—´åªè§åˆ° uapi å¤´æ–‡ä»¶ã€‚</li>
<li><strong>éšå¼ä¾èµ–ä¸ç¼–è¯‘ä¼˜åŒ–</strong>ï¼šæœ‰å»ºè®®å€Ÿæ­¤æœºä¼šæ¸…ç†éšå¼åŒ…å«ã€ä¼˜åŒ–ç¼–è¯‘é€Ÿåº¦ï¼Œä½†è¿™å±äºæ›´å¤§èŒƒå›´çš„é‡æ„ï¼Œè¶…å‡ºäº†æœ¬æ¬¡æ‹†åˆ†çš„ç›®æ ‡ã€‚</li>
<li><strong>è‡ªåŠ¨åŒ–å·¥å…·çš„å±€é™</strong>ï¼šä¸ Java ç­‰è¯­è¨€ä¸åŒï¼ŒC
è¯­è¨€çš„é¢„å¤„ç†å™¨å’Œå¤´æ–‡ä»¶æœºåˆ¶æ›´ä¸ºå¤æ‚ï¼Œè‡ªåŠ¨åŒ–è„šæœ¬éš¾ä»¥è¦†ç›–æ‰€æœ‰è¾¹ç•Œæƒ…å†µï¼Œä»éœ€äººå·¥å¹²é¢„å’Œåç»­ç»´æŠ¤ã€‚</li>
</ul>
<h3 id="ç³»ç»Ÿè°ƒç”¨æºç æŒ‡å¼•ä»¥-arm-æ¶æ„ä¸ºä¾‹">ç³»ç»Ÿè°ƒç”¨æºç æŒ‡å¼•ï¼ˆä»¥ ARM
æ¶æ„ä¸ºä¾‹ï¼‰</h3>
<p>ç³»ç»Ÿè°ƒç”¨çš„å®ç°é«˜åº¦ä¾èµ–äºå…·ä½“æ¶æ„ï¼ŒåŒ…æ‹¬è°ƒç”¨æ–¹å¼å’Œå¯ç”¨çš„ç³»ç»Ÿè°ƒç”¨ç§ç±»ã€‚ä»¥ä¸‹æ˜¯
ARM æ¶æ„ä¸‹ä¸ç³»ç»Ÿè°ƒç”¨å¯†åˆ‡ç›¸å…³çš„æ ¸å¿ƒæºç æ–‡ä»¶ï¼š</p>
<ul>
<li><p><strong>include/linux/syscalls.h</strong><br />
æä¾›æ‰€æœ‰å†…æ ¸ç³»ç»Ÿè°ƒç”¨çš„æ¶æ„æ— å…³çš„å‰å‘å£°æ˜ã€‚è¯¥æ–‡ä»¶å®šä¹‰äº†å†…æ ¸å†…éƒ¨è°ƒç”¨ç³»ç»Ÿè°ƒç”¨å‡½æ•°çš„æ¥å£ã€‚</p></li>
<li><p><strong>arch/arm/include/uapi/asm/unistd.h</strong><br />
å®šä¹‰äº† ARM æ¶æ„ä¸‹ç³»ç»Ÿè°ƒç”¨å·çš„ç›¸å…³å†…å®¹ã€‚</p></li>
<li><p><strong>arch/arm/kernel/entry-common.S</strong><br />
æä¾› ARM æ¶æ„ä¸‹ç³»ç»Ÿè°ƒç”¨çš„å…¥å£æ±‡ç¼–å®ç°ã€‚</p></li>
<li><p><strong>arch/arm/tools/syscall.tbl</strong><br />
è´Ÿè´£å°†ç³»ç»Ÿè°ƒç”¨å·åŠå…¶å¯¹åº”çš„å‡½æ•°åœ°å€æ³¨å†Œåˆ° ARM
ç¡¬ä»¶çš„ç³»ç»Ÿè°ƒç”¨è¡¨ä¸­ã€‚</p></li>
</ul>
<p>æ­¤å¤–ï¼Œä»¥ä¸‹æ–‡ä»¶è™½ç„¶ä¸ç³»ç»Ÿè°ƒç”¨æ— å…³ï¼Œä½†æ¶‰åŠç³»ç»Ÿå¯åŠ¨ï¼ˆè¿™æ˜¯å†…æ ¸æ‰§è¡Œçš„å¦ä¸€ç§æ–¹å¼ï¼‰ï¼š</p>
<ul>
<li><p><strong>init ç›®å½•</strong><br />
åŒ…å«å†…æ ¸åˆå§‹åŒ–ç›¸å…³ä»£ç ã€‚</p></li>
<li><p><strong>init/main.c</strong><br />
æä¾›äº† <code>start_kernel</code> å‡½æ•°ï¼Œè¿™æ˜¯ Linux å†…æ ¸å¯åŠ¨åæ‰§è¡Œçš„ç¬¬ä¸€ä¸ª
C
è¯­è¨€å‡½æ•°ï¼Œä¸”ä¸€æ—¦è°ƒç”¨æ°¸ä¸è¿”å›ã€‚åœ¨æ­¤ä¹‹å‰ï¼Œå†…æ ¸ä»…é€šè¿‡æ¶æ„ç›¸å…³çš„æ±‡ç¼–ä»£ç å’Œå›ºä»¶è¿è¡Œã€‚<br />
ï¼ˆå‚è€ƒï¼šã€ŠLinux è®¾å¤‡é©±åŠ¨ã€‹ç¬¬16ç« å¯¹ main.c å’Œ start_kernel
çš„ä»‹ç»ï¼‰</p></li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://mackz-maxw.github.io/2025/06/27/oper_sys11/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Mackz-Maxw">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Maxwçš„å°ç«™">
      <meta itemprop="description" content="ä¹˜ä¸Šç‡ƒçŠ€èˆ¹ï¼Œè¿˜æœªæ›¾å»è¿‡å€’æ‚¬å±±ã€‚">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Maxwçš„å°ç«™">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/06/27/oper_sys11/" class="post-title-link" itemprop="url">æ“ä½œç³»ç»ŸåŸºç¡€ | 3.2 ç³»ç»Ÿè°ƒç”¨å®ç°</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>
      

      <time title="åˆ›å»ºæ—¶é—´ï¼š2025-06-28 07:22:48 / ä¿®æ”¹æ—¶é—´ï¼š07:39:30" itemprop="dateCreated datePublished" datetime="2025-06-28T07:22:48+08:00">2025-06-28</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/os-basic/" itemprop="url" rel="index"><span itemprop="name">os basic</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="ç³»ç»Ÿè°ƒç”¨çš„å®ç°">ç³»ç»Ÿè°ƒç”¨çš„å®ç°</h2>
<p>åœ¨ Linux ä¸­ï¼Œå®é™…å®ç°ä¸€ä¸ªç³»ç»Ÿè°ƒç”¨æ—¶ï¼Œä¸éœ€è¦å…³å¿ƒç³»ç»Ÿè°ƒç”¨å¤„ç†å™¨ï¼ˆsystem
call handlerï¼‰çš„å…·ä½“è¡Œä¸ºã€‚å› æ­¤ï¼Œå‘ Linux
æ·»åŠ ä¸€ä¸ªæ–°çš„ç³»ç»Ÿè°ƒç”¨ç›¸å¯¹å®¹æ˜“ã€‚éš¾ç‚¹åœ¨äºè®¾è®¡å’Œå®ç°ç³»ç»Ÿè°ƒç”¨æœ¬èº«ï¼Œè€Œå°†å…¶æ³¨å†Œåˆ°å†…æ ¸åˆ™å¾ˆç®€å•ã€‚ä¸‹é¢æ˜¯ç¼–å†™æ–°ç³»ç»Ÿè°ƒç”¨çš„ä¸»è¦æ­¥éª¤ã€‚</p>
<h3 id="å®ç°ç³»ç»Ÿè°ƒç”¨çš„æ­¥éª¤">å®ç°ç³»ç»Ÿè°ƒç”¨çš„æ­¥éª¤</h3>
<ol type="1">
<li><p><strong>æ˜ç¡®ç›®çš„</strong><br />
é¦–å…ˆè¦å®šä¹‰ç³»ç»Ÿè°ƒç”¨çš„ç”¨é€”ã€‚ç³»ç»Ÿè°ƒç”¨åº”è¯¥åªåšä¸€ä»¶äº‹ã€‚Linux
ä¸é¼“åŠ±â€œå¤šè·¯å¤ç”¨â€ç³»ç»Ÿè°ƒç”¨ï¼ˆå³é€šè¿‡ä¸€ä¸ªå‚æ•°è®©åŒä¸€ä¸ªç³»ç»Ÿè°ƒç”¨åšå®Œå…¨ä¸åŒçš„äº‹æƒ…ï¼‰ï¼Œå¦‚
ioctl() å°±æ˜¯åé¢æ•™æã€‚</p></li>
<li><p><strong>å‚æ•°ã€è¿”å›å€¼å’Œé”™è¯¯ç è®¾è®¡</strong><br />
ç³»ç»Ÿè°ƒç”¨åº”æœ‰ç®€æ´ã€æ¸…æ™°çš„æ¥å£ï¼Œå‚æ•°æ•°é‡åº”å°½é‡å°‘ã€‚å…¶è¯­ä¹‰å’Œè¡Œä¸ºå¿…é¡»ç¨³å®šï¼Œä¸èƒ½éšæ„æ›´æ”¹ï¼Œå› ä¸ºå·²æœ‰åº”ç”¨ä¼šä¾èµ–è¿™äº›è¡Œä¸ºã€‚è¦æœ‰å‰ç»æ€§ï¼Œè€ƒè™‘æœªæ¥æ˜¯å¦éœ€è¦æ‰©å±•åŠŸèƒ½ï¼Œæ˜¯å¦èƒ½åœ¨ä¸ç ´åå…¼å®¹æ€§çš„å‰æä¸‹ä¿®å¤
bugã€‚å¾ˆå¤šç³»ç»Ÿè°ƒç”¨ä¼šè®¾è®¡ä¸€ä¸ª flag
å‚æ•°ï¼Œç”¨äºå°†æ¥æ‰©å±•åŠŸèƒ½ï¼ˆä¸æ˜¯ç”¨æ¥å¤šè·¯å¤ç”¨è¡Œä¸ºï¼Œè€Œæ˜¯ä¸ºäº†å…¼å®¹æ€§å’Œå¯æ‰©å±•æ€§ï¼‰ã€‚</p></li>
<li><p><strong>æ¥å£è®¾è®¡è¦é€šç”¨ã€å¯ç§»æ¤</strong><br />
ä¸è¦è®©æ¥å£è¿‡äºå±€é™å½“å‰ç”¨é€”ã€‚ç³»ç»Ÿè°ƒç”¨çš„ç”¨é€”å¯èƒ½ä¼šå˜åŒ–ï¼Œä½†å…¶æœ¬è´¨ç›®çš„åº”ä¿æŒä¸å˜ã€‚è¦è€ƒè™‘å¯ç§»æ¤æ€§ï¼Œä¸è¦å‡è®¾ç‰¹å®šæ¶æ„çš„å­—é•¿æˆ–å­—èŠ‚åºã€‚Unix
çš„è®¾è®¡å“²å­¦æ˜¯â€œæä¾›æœºåˆ¶ï¼Œä¸è§„å®šç­–ç•¥â€ã€‚</p></li>
<li><p><strong>å…³æ³¨å¯ç§»æ¤æ€§å’Œå¥å£®æ€§</strong><br />
ç¼–å†™ç³»ç»Ÿè°ƒç”¨æ—¶è¦è€ƒè™‘æœªæ¥çš„å¯ç§»æ¤æ€§å’Œå¥å£®æ€§ã€‚Unix
çš„åŸºæœ¬ç³»ç»Ÿè°ƒç”¨ç»å—ä½äº†æ—¶é—´è€ƒéªŒï¼Œå‡ åå¹´åä¾ç„¶é€‚ç”¨ã€‚</p></li>
</ol>
<hr />
<h3 id="å‚æ•°æ ¡éªŒ">å‚æ•°æ ¡éªŒ</h3>
<p>ç³»ç»Ÿè°ƒç”¨å¿…é¡»<strong>ä¸¥æ ¼æ ¡éªŒæ‰€æœ‰å‚æ•°</strong>ï¼Œç¡®ä¿å…¶æœ‰æ•ˆå’Œåˆæ³•ã€‚ç³»ç»Ÿè°ƒç”¨åœ¨å†…æ ¸ç©ºé—´è¿è¡Œï¼Œå¦‚æœç”¨æˆ·èƒ½éšæ„ä¼ é€’æ— æ•ˆå‚æ•°ï¼Œç³»ç»Ÿçš„å®‰å…¨å’Œç¨³å®šæ€§ä¼šå—åˆ°å¨èƒã€‚</p>
<ul>
<li><p>ä¾‹å¦‚ï¼Œæ–‡ä»¶ I/O
ç³»ç»Ÿè°ƒç”¨è¦æ£€æŸ¥æ–‡ä»¶æè¿°ç¬¦æ˜¯å¦æœ‰æ•ˆï¼›è¿›ç¨‹ç›¸å…³å‡½æ•°è¦æ£€æŸ¥ PID
æ˜¯å¦æœ‰æ•ˆã€‚æ¯ä¸ªå‚æ•°éƒ½è¦éªŒè¯å…¶æ­£ç¡®æ€§ï¼Œé˜²æ­¢è¿›ç¨‹è¯·æ±‚è®¿é—®å…¶æ— æƒè®¿é—®çš„èµ„æºã€‚</p></li>
<li><p><strong>æŒ‡é’ˆå‚æ•°çš„æ ¡éªŒå°¤ä¸ºé‡è¦</strong>ã€‚å¦‚æœè¿›ç¨‹èƒ½ä¼ é€’ä»»æ„æŒ‡é’ˆç»™å†…æ ¸ï¼Œå¯èƒ½ä¼šè®©å†…æ ¸è®¿é—®æœ¬ä¸è¯¥è®¿é—®çš„æ•°æ®ï¼ˆå¦‚å…¶ä»–è¿›ç¨‹çš„æ•°æ®æˆ–å†…æ ¸ç©ºé—´æ•°æ®ï¼‰ã€‚å› æ­¤ï¼Œåœ¨å†…æ ¸è·Ÿéšç”¨æˆ·ç©ºé—´æŒ‡é’ˆå‰ï¼Œå¿…é¡»ç¡®ä¿ï¼š</p>
<ol type="1">
<li>æŒ‡é’ˆæŒ‡å‘ç”¨æˆ·ç©ºé—´å†…å­˜ï¼Œä¸èƒ½è®©è¿›ç¨‹è®©å†…æ ¸è®¿é—®å†…æ ¸ç©ºé—´ã€‚</li>
<li>æŒ‡é’ˆæŒ‡å‘çš„æ˜¯æœ¬è¿›ç¨‹çš„åœ°å€ç©ºé—´ï¼Œä¸èƒ½è®¿é—®å…¶ä»–è¿›ç¨‹çš„æ•°æ®ã€‚</li>
<li>è¯»æ“ä½œæ—¶å†…å­˜å¿…é¡»å¯è¯»ï¼Œå†™æ“ä½œæ—¶å¿…é¡»å¯å†™ï¼Œæ‰§è¡Œæ“ä½œæ—¶å¿…é¡»å¯æ‰§è¡Œï¼Œä¸èƒ½ç»•è¿‡å†…å­˜è®¿é—®æƒé™ã€‚</li>
</ol></li>
<li><p>å†…æ ¸æä¾›äº†ä¸¤ç§æ–¹æ³•æ¥è¿›è¡Œè¿™äº›æ£€æŸ¥å’Œæ•°æ®æ‹·è´ï¼Œ<strong>å†…æ ¸ä»£ç ç»ä¸èƒ½ç›´æ¥è·Ÿéšç”¨æˆ·ç©ºé—´æŒ‡é’ˆ</strong>ï¼Œå¿…é¡»ä½¿ç”¨ä»¥ä¸‹ä¸¤ç§æ–¹æ³•ä¹‹ä¸€ï¼š</p>
<ul>
<li><code>copy_to_user()</code>ï¼šç”¨äºå°†æ•°æ®ä»å†…æ ¸ç©ºé—´å†™å…¥ç”¨æˆ·ç©ºé—´ã€‚å‚æ•°åˆ†åˆ«ä¸ºç”¨æˆ·ç©ºé—´ç›®æ ‡åœ°å€ã€å†…æ ¸ç©ºé—´æºåœ°å€ã€æ‹·è´å­—èŠ‚æ•°ã€‚</li>
<li><code>copy_from_user()</code>ï¼šç”¨äºä»ç”¨æˆ·ç©ºé—´è¯»å–æ•°æ®åˆ°å†…æ ¸ç©ºé—´ã€‚å‚æ•°åˆ†åˆ«ä¸ºå†…æ ¸ç©ºé—´ç›®æ ‡åœ°å€ã€ç”¨æˆ·ç©ºé—´æºåœ°å€ã€æ‹·è´å­—èŠ‚æ•°ã€‚</li>
</ul></li>
<li><p>è¿™ä¸¤ä¸ªå‡½æ•°åœ¨å‡ºé”™æ—¶è¿”å›æœªæ‹·è´çš„å­—èŠ‚æ•°ï¼ŒæˆåŠŸæ—¶è¿”å›
0ã€‚ç³»ç»Ÿè°ƒç”¨é‡åˆ°è¿™ç§é”™è¯¯æ—¶ï¼Œé€šå¸¸è¿”å› <code>-EFAULT</code>ã€‚</p></li>
</ul>
<p>ä¸‹é¢ä»¥ä¸€ä¸ªç®€å•çš„ç³»ç»Ÿè°ƒç”¨ <code>silly_copy()</code>
ä¸ºä¾‹ï¼Œè¯´æ˜å¦‚ä½•åœ¨å†…æ ¸ä¸­å®‰å…¨åœ°ä»ç”¨æˆ·ç©ºé—´è¯»å–å’Œå†™å…¥æ•°æ®ã€‚è¿™ä¸ªç³»ç»Ÿè°ƒç”¨çš„åŠŸèƒ½æ˜¯ï¼šå°†ç”¨æˆ·ç©ºé—´
<code>src</code> æŒ‡å‘çš„æ•°æ®æ‹·è´åˆ°
<code>dst</code>ï¼Œä¸­é—´é€šè¿‡å†…æ ¸ç¼“å†²åŒºä½œä¸ºä¸­è½¬ã€‚è™½ç„¶å®é™…ç”¨é€”ä¸å¤§ï¼Œä½†æœ‰åŠ©äºç†è§£
<code>copy_from_user()</code> å’Œ <code>copy_to_user()</code>
çš„ç”¨æ³•ã€‚</p>
<p><strong>æ ¸å¿ƒä»£ç ç‰‡æ®µï¼š</strong> <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">SYSCALL_DEFINE3(silly_copy,</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">long</span> *, src, </span><br><span class="line">    <span class="type">unsigned</span> <span class="type">long</span> *, dst, </span><br><span class="line">    <span class="type">unsigned</span> <span class="type">long</span> len)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">long</span> buf;</span><br><span class="line">    <span class="comment">// ä»ç”¨æˆ·ç©ºé—´ src æ‹·è´ len å­—èŠ‚åˆ°å†…æ ¸ç¼“å†²åŒº buf</span></span><br><span class="line">    <span class="keyword">if</span> (copy_from_user(&amp;buf, src, len))</span><br><span class="line">        <span class="keyword">return</span> -EFAULT;</span><br><span class="line">    <span class="comment">// ä»å†…æ ¸ç¼“å†²åŒº buf æ‹·è´ len å­—èŠ‚åˆ°ç”¨æˆ·ç©ºé—´ dst</span></span><br><span class="line">    <span class="keyword">if</span> (copy_to_user(dst, &amp;buf, len))</span><br><span class="line">        <span class="keyword">return</span> -EFAULT;</span><br><span class="line">    <span class="comment">// è¿”å›æ‹·è´çš„å­—èŠ‚æ•°</span></span><br><span class="line">    <span class="keyword">return</span> len;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure> -
<code>copy_from_user()</code>ï¼šå°†ç”¨æˆ·ç©ºé—´æ•°æ®æ‹·è´åˆ°å†…æ ¸ç©ºé—´ï¼Œå¤±è´¥æ—¶è¿”å›æœªæ‹·è´çš„å­—èŠ‚æ•°ï¼ŒæˆåŠŸè¿”å›0ã€‚
-
<code>copy_to_user()</code>ï¼šå°†å†…æ ¸ç©ºé—´æ•°æ®æ‹·è´åˆ°ç”¨æˆ·ç©ºé—´ï¼Œå¤±è´¥æ—¶è¿”å›æœªæ‹·è´çš„å­—èŠ‚æ•°ï¼ŒæˆåŠŸè¿”å›0ã€‚
- å¦‚æœæ‹·è´å¤±è´¥ï¼Œç³»ç»Ÿè°ƒç”¨è¿”å› <code>-EFAULT</code>ã€‚</p>
<p><strong>æ³¨æ„ï¼š</strong><br />
è¿™ä¸¤ä¸ªå‡½æ•°åœ¨æ•°æ®é¡µä¸åœ¨ç‰©ç†å†…å­˜æ—¶å¯èƒ½ä¼šé˜»å¡ï¼ˆå¦‚æ•°æ®è¢«æ¢å‡ºåˆ°ç£ç›˜ï¼‰ï¼Œæ­¤æ—¶è¿›ç¨‹ä¼šä¼‘çœ ç›´åˆ°é¡µé¢è¢«è°ƒå…¥å†…å­˜ã€‚</p>
<h3 id="æƒé™æ£€æŸ¥ä¸èƒ½åŠ›æœºåˆ¶">æƒé™æ£€æŸ¥ä¸èƒ½åŠ›æœºåˆ¶</h3>
<p>åœ¨æ—©æœŸ Linux ç‰ˆæœ¬ä¸­ï¼Œç³»ç»Ÿè°ƒç”¨å¦‚æœéœ€è¦è¶…çº§ç”¨æˆ·æƒé™ï¼Œä¼šç”¨
<code>suser()</code> æ£€æŸ¥æ˜¯å¦ä¸º rootã€‚ç°åœ¨ï¼ŒLinux
ä½¿ç”¨æ›´ç»†ç²’åº¦çš„â€œèƒ½åŠ›ï¼ˆcapabilitiesï¼‰â€æœºåˆ¶ã€‚é€šè¿‡ <code>capable()</code>
å‡½æ•°æ£€æŸ¥è°ƒç”¨è¿›ç¨‹æ˜¯å¦æ‹¥æœ‰æŸé¡¹èƒ½åŠ›ã€‚ä¾‹å¦‚ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (!capable(CAP_SYS_BOOT))</span><br><span class="line">    <span class="keyword">return</span> -EPERM;</span><br></pre></td></tr></table></figure>
<ul>
<li><code>capable(CAP_SYS_BOOT)</code>
æ£€æŸ¥è°ƒç”¨è€…æ˜¯å¦æœ‰é‡å¯ç³»ç»Ÿçš„æƒé™ï¼ˆCAP_SYS_BOOTï¼‰ã€‚</li>
<li>è¶…çº§ç”¨æˆ·ï¼ˆrootï¼‰é»˜è®¤æ‹¥æœ‰æ‰€æœ‰èƒ½åŠ›ï¼Œæ™®é€šç”¨æˆ·é»˜è®¤æ²¡æœ‰ã€‚</li>
</ul>
<p><strong>reboot() ç³»ç»Ÿè°ƒç”¨éƒ¨åˆ†å®ç°ï¼š</strong> <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">SYSCALL_DEFINE4(reboot, <span class="type">int</span> magic1, <span class="type">int</span> magic2, <span class="type">unsigned</span> <span class="type">int</span> cmd, <span class="type">void</span> __user *, arg)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">char</span> buffer[<span class="number">256</span>];</span><br><span class="line">    <span class="comment">// åªå…è®¸è¶…çº§ç”¨æˆ·é‡å¯ç³»ç»Ÿ</span></span><br><span class="line">    <span class="keyword">if</span> (!capable(CAP_SYS_BOOT))</span><br><span class="line">        <span class="keyword">return</span> -EPERM;</span><br><span class="line">    <span class="comment">// æ£€æŸ¥ magic å‚æ•°ï¼Œé˜²æ­¢è¯¯æ“ä½œ</span></span><br><span class="line">    <span class="keyword">if</span> (magic1 != LINUX_REBOOT_MAGIC1 ||</span><br><span class="line">        (magic2 != LINUX_REBOOT_MAGIC2 &amp;&amp;</span><br><span class="line">         magic2 != LINUX_REBOOT_MAGIC2A &amp;&amp;</span><br><span class="line">         magic2 != LINUX_REBOOT_MAGIC2B &amp;&amp;</span><br><span class="line">         magic2 != LINUX_REBOOT_MAGIC2C))</span><br><span class="line">        <span class="keyword">return</span> -EINVAL;</span><br><span class="line">    <span class="comment">// ... çœç•¥åç»­å‘½ä»¤å¤„ç† ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure> -
é¦–å…ˆæ£€æŸ¥æƒé™ï¼Œåªæœ‰æ‹¥æœ‰ CAP_SYS_BOOT èƒ½åŠ›çš„è¿›ç¨‹æ‰èƒ½é‡å¯ç³»ç»Ÿã€‚ - ç„¶åæ£€æŸ¥
magic å‚æ•°ï¼Œåªæœ‰ä¼ å…¥ç‰¹å®šçš„â€œé­”æ•°â€æ‰å…è®¸æ‰§è¡Œï¼Œé˜²æ­¢è¯¯æ“ä½œã€‚</p>
<p><strong>èƒ½åŠ›åˆ—è¡¨</strong>å¯å‚è€ƒ
<code>&lt;linux/capability.h&gt;</code>ï¼Œæ¯ç§èƒ½åŠ›å¯¹åº”ä¸åŒçš„ç³»ç»Ÿèµ„æºè®¿é—®æƒé™ã€‚</p>
<h3 id="ç³»ç»Ÿè°ƒç”¨ä¸Šä¸‹æ–‡system-call-context">ç³»ç»Ÿè°ƒç”¨ä¸Šä¸‹æ–‡ï¼ˆSystem Call
Contextï¼‰</h3>
<p>å¦‚ç¬¬3ç« æ‰€è¿°ï¼Œ<strong>åœ¨æ‰§è¡Œç³»ç»Ÿè°ƒç”¨æœŸé—´ï¼Œå†…æ ¸å¤„äºè¿›ç¨‹ä¸Šä¸‹æ–‡ï¼ˆprocess
contextï¼‰</strong>ã€‚æ­¤æ—¶ï¼Œ<code>current</code>
æŒ‡é’ˆæŒ‡å‘å½“å‰ä»»åŠ¡ï¼ˆå³å‘èµ·ç³»ç»Ÿè°ƒç”¨çš„è¿›ç¨‹ï¼‰ã€‚</p>
<ul>
<li>åœ¨è¿›ç¨‹ä¸Šä¸‹æ–‡ä¸­ï¼Œå†…æ ¸<strong>å¯ä»¥ä¼‘çœ </strong>ï¼ˆæ¯”å¦‚ç³»ç»Ÿè°ƒç”¨é˜»å¡æˆ–æ˜¾å¼è°ƒç”¨
<code>schedule()</code>ï¼‰ï¼Œå¹¶ä¸”æ˜¯<strong>å®Œå…¨å¯æŠ¢å çš„</strong>ã€‚
<ul>
<li>èƒ½å¤Ÿä¼‘çœ æ„å‘³ç€ç³»ç»Ÿè°ƒç”¨å¯ä»¥ä½¿ç”¨å¤§éƒ¨åˆ†å†…æ ¸åŠŸèƒ½ï¼Œè¿™æå¤§ç®€åŒ–äº†å†…æ ¸ç¼–ç¨‹ï¼ˆç›¸æ¯”ä¸­æ–­å¤„ç†ç¨‹åºï¼Œä¸­æ–­å¤„ç†ç¨‹åºä¸èƒ½ä¼‘çœ ï¼ŒåŠŸèƒ½å—é™ï¼‰ã€‚</li>
<li>å¯æŠ¢å æ„å‘³ç€å½“å‰ä»»åŠ¡å¯èƒ½è¢«å…¶ä»–ä»»åŠ¡æŠ¢å ï¼Œæ–°çš„ä»»åŠ¡å¯èƒ½ä¼šæ‰§è¡ŒåŒä¸€ä¸ªç³»ç»Ÿè°ƒç”¨ï¼Œå› æ­¤ç³»ç»Ÿè°ƒç”¨å®ç°å¿…é¡»<strong>å¯é‡å…¥</strong>ï¼Œè¿™å’Œå¤šæ ¸å¹¶å‘ä¸‹çš„åŒæ­¥é—®é¢˜ç±»ä¼¼ã€‚</li>
</ul></li>
</ul>
<p>å½“ç³»ç»Ÿè°ƒç”¨è¿”å›æ—¶ï¼Œæ§åˆ¶æƒå›åˆ°
<code>system_call()</code>ï¼Œæœ€ç»ˆåˆ‡æ¢å›ç”¨æˆ·ç©ºé—´ï¼Œç»§ç»­æ‰§è¡Œç”¨æˆ·è¿›ç¨‹ã€‚</p>
<h3 id="ç³»ç»Ÿè°ƒç”¨æ³¨å†Œçš„æœ€åæ­¥éª¤">ç³»ç»Ÿè°ƒç”¨æ³¨å†Œçš„æœ€åæ­¥éª¤</h3>
<p>ç³»ç»Ÿè°ƒç”¨ä»£ç å†™å¥½åï¼Œå°†å…¶æ³¨å†Œä¸ºæ­£å¼ç³»ç»Ÿè°ƒç”¨çš„è¿‡ç¨‹å¾ˆç®€å•ï¼š</p>
<ol type="1">
<li><strong>åœ¨ç³»ç»Ÿè°ƒç”¨è¡¨ä¸­æ·»åŠ æ¡ç›®</strong>
<ul>
<li>å¯¹äºæ¯ä¸ªæ”¯æŒè¯¥ç³»ç»Ÿè°ƒç”¨çš„æ¶æ„ï¼Œéƒ½è¦åœ¨ç³»ç»Ÿè°ƒç”¨è¡¨ï¼ˆå¦‚
entry.Sï¼‰æœ«å°¾æ·»åŠ ä¸€é¡¹ã€‚è¡¨ä¸­æ¯ä¸€é¡¹çš„ä½ç½®ï¼ˆä»0å¼€å§‹ï¼‰å°±æ˜¯ç³»ç»Ÿè°ƒç”¨å·ã€‚ä¾‹å¦‚ï¼Œç¬¬10é¡¹çš„ç³»ç»Ÿè°ƒç”¨å·æ˜¯9ã€‚</li>
<li>è¡¨ç¤ºä¾‹ï¼ˆéƒ¨åˆ†ï¼‰ï¼š <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">ENTRY(sys_call_table)</span><br><span class="line">.long sys_restart_syscall    /* 0 */</span><br><span class="line">.long sys_exit</span><br><span class="line">.long sys_fork</span><br><span class="line">.long sys_read</span><br><span class="line">.long sys_write</span><br><span class="line">.long sys_open              /* 5 */</span><br><span class="line">...</span><br><span class="line">.long sys_foo               /* æ–°å¢çš„ç³»ç»Ÿè°ƒç”¨ */</span><br></pre></td></tr></table></figure></li>
<li>æ–°ç³»ç»Ÿè°ƒç”¨è‡ªåŠ¨è·å¾—ä¸‹ä¸€ä¸ªå¯ç”¨çš„ç³»ç»Ÿè°ƒç”¨å·ï¼ˆå¦‚338ï¼‰ã€‚</li>
</ul></li>
<li><strong>åœ¨ &lt;asm/unistd.h&gt; ä¸­å®šä¹‰ç³»ç»Ÿè°ƒç”¨å·</strong>
<ul>
<li>æ¯ä¸ªæ¶æ„éƒ½è¦åœ¨å¯¹åº”çš„ <code>&lt;asm/unistd.h&gt;</code>
æ–‡ä»¶ä¸­æ·»åŠ å®å®šä¹‰ã€‚ä¾‹å¦‚ï¼š <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> __NR_foo 338</span></span><br></pre></td></tr></table></figure></li>
</ul></li>
<li><strong>å°†ç³»ç»Ÿè°ƒç”¨ç¼–è¯‘è¿›å†…æ ¸é•œåƒ</strong>
<ul>
<li>ç³»ç»Ÿè°ƒç”¨å¿…é¡»ç¼–è¯‘è¿›æ ¸å¿ƒå†…æ ¸é•œåƒï¼ˆä¸èƒ½ä½œä¸ºæ¨¡å—ï¼‰ã€‚é€šå¸¸æŠŠå®ç°ä»£ç æ”¾åœ¨
kernel/ ç›®å½•ä¸‹ç›¸å…³çš„æ–‡ä»¶ä¸­ï¼Œæ¯”å¦‚ sys.cã€‚å¦‚æœå’Œè°ƒåº¦ç›¸å…³ï¼Œå¯ä»¥æ”¾åœ¨
kernel/sched.cã€‚</li>
</ul></li>
</ol>
<p><strong>ç¤ºä¾‹ï¼šå®ç° foo() ç³»ç»Ÿè°ƒç”¨</strong></p>
<ul>
<li>åœ¨ kernel/sys.c ä¸­å®ç°ï¼š <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;asm/page.h&gt;</span></span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * sys_foo â€“ è¿”å›æ¯ä¸ªè¿›ç¨‹çš„å†…æ ¸æ ˆå¤§å°</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">asmlinkage <span class="type">long</span> <span class="title function_">sys_foo</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> THREAD_SIZE;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>ç¼–è¯‘å¹¶å¯åŠ¨æ–°å†…æ ¸åï¼Œç”¨æˆ·ç©ºé—´å³å¯é€šè¿‡ç³»ç»Ÿè°ƒç”¨å·è°ƒç”¨ foo()ã€‚</li>
</ul>
<h3 id="ç”¨æˆ·ç©ºé—´è®¿é—®ç³»ç»Ÿè°ƒç”¨">ç”¨æˆ·ç©ºé—´è®¿é—®ç³»ç»Ÿè°ƒç”¨</h3>
<p>é€šå¸¸ï¼ŒC æ ‡å‡†åº“ï¼ˆå¦‚
glibcï¼‰ä¼šä¸ºç³»ç»Ÿè°ƒç”¨æä¾›æ”¯æŒã€‚ç”¨æˆ·ç¨‹åºåªéœ€åŒ…å«æ ‡å‡†å¤´æ–‡ä»¶å¹¶é“¾æ¥ C
åº“ï¼Œå°±å¯ä»¥ç›´æ¥è°ƒç”¨ç³»ç»Ÿè°ƒç”¨ï¼ˆæˆ–è°ƒç”¨åº“å‡½æ•°é—´æ¥ä½¿ç”¨ç³»ç»Ÿè°ƒç”¨ï¼‰ã€‚ä½†å¦‚æœä½ åˆšåˆšå®ç°äº†ä¸€ä¸ªæ–°çš„ç³»ç»Ÿè°ƒç”¨ï¼Œglibc
å¾ˆå¯èƒ½è¿˜æ²¡æœ‰ä¸ºå®ƒæä¾›æ”¯æŒï¼</p>
<p>å¹¸è¿çš„æ˜¯ï¼ŒLinux
æä¾›äº†ä¸€ç»„å®æ¥å¸®åŠ©ç”¨æˆ·ç©ºé—´è®¿é—®ç³»ç»Ÿè°ƒç”¨ã€‚è¿™äº›å®ä¼šè®¾ç½®å¥½å¯„å­˜å™¨å†…å®¹å¹¶å‘å‡ºé™·é˜±æŒ‡ä»¤ã€‚å®çš„åå­—ä¸º
<code>_syscalln()</code>ï¼Œå…¶ä¸­ n å– 0 åˆ°
6ï¼Œè¡¨ç¤ºç³»ç»Ÿè°ƒç”¨å‚æ•°çš„ä¸ªæ•°ã€‚å®éœ€è¦çŸ¥é“å‚æ•°ä¸ªæ•°ï¼Œä»¥ä¾¿æ­£ç¡®åœ°å°†å‚æ•°å‹å…¥å¯„å­˜å™¨ã€‚</p>
<p>ä¾‹å¦‚ï¼Œopen() ç³»ç»Ÿè°ƒç”¨çš„åŸå‹ä¸ºï¼š <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">long</span> <span class="title function_">open</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *filename, <span class="type">int</span> flags, <span class="type">int</span> mode)</span></span><br></pre></td></tr></table></figure>
å¦‚æœæ²¡æœ‰åº“æ”¯æŒï¼Œå¯ä»¥è¿™æ ·ä½¿ç”¨å®ï¼š <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> __NR_open 5</span></span><br><span class="line">_syscall3(<span class="type">long</span>, open, <span class="type">const</span> <span class="type">char</span> *, filename, <span class="type">int</span>, flags, <span class="type">int</span>, mode)</span><br></pre></td></tr></table></figure>
è¿™æ ·ï¼Œåº”ç”¨ç¨‹åºå°±å¯ä»¥ç›´æ¥è°ƒç”¨ open() äº†ã€‚</p>
<p>æ¯ä¸ªå®çš„å‚æ•°ä¸º 2 + 2 Ã—
nï¼šç¬¬ä¸€ä¸ªå‚æ•°æ˜¯è¿”å›ç±»å‹ï¼Œç¬¬äºŒä¸ªæ˜¯ç³»ç»Ÿè°ƒç”¨åï¼Œåé¢ä¾æ¬¡æ˜¯æ¯ä¸ªå‚æ•°çš„ç±»å‹å’Œåå­—ã€‚<code>__NR_open</code>
å®šä¹‰åœ¨
<code>&lt;asm/unistd.h&gt;</code>ï¼Œè¡¨ç¤ºç³»ç»Ÿè°ƒç”¨å·ã€‚<code>_syscall3</code>
å®ä¼šå±•å¼€ä¸ºå¸¦æœ‰å†…è”æ±‡ç¼–çš„ C
å‡½æ•°ï¼Œè‡ªåŠ¨å®Œæˆç³»ç»Ÿè°ƒç”¨å·å’Œå‚æ•°çš„ä¼ é€’ï¼Œå¹¶å‘å‡ºè½¯ä¸­æ–­è¿›å…¥å†…æ ¸ã€‚åªéœ€åœ¨åº”ç”¨ä¸­å†™è¿™ä¸ªå®ï¼Œå°±èƒ½ç›´æ¥ä½¿ç”¨
open() ç³»ç»Ÿè°ƒç”¨ã€‚</p>
<p><strong>ç¤ºä¾‹ï¼šç”¨æˆ·ç©ºé—´è°ƒç”¨è‡ªå®šä¹‰ foo() ç³»ç»Ÿè°ƒç”¨</strong>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> __NR_foo 283</span></span><br><span class="line">_syscall0(<span class="type">long</span>, foo)</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">long</span> stack_size;</span><br><span class="line">    stack_size = foo();</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;The kernel stack size is %ld\n&quot;</span>, stack_size);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3
id="ä¸ºä»€ä¹ˆä¸å»ºè®®éšæ„å®ç°æ–°ç³»ç»Ÿè°ƒç”¨">ä¸ºä»€ä¹ˆä¸å»ºè®®éšæ„å®ç°æ–°ç³»ç»Ÿè°ƒç”¨</h3>
<p>è™½ç„¶å®ç°æ–°ç³»ç»Ÿè°ƒç”¨å¾ˆå®¹æ˜“ï¼Œä½†è¿™å¹¶ä¸æ„å‘³ç€ä½ åº”è¯¥éšæ„æ·»åŠ ã€‚å®é™…ä¸Šï¼Œæ·»åŠ æ–°ç³»ç»Ÿè°ƒç”¨è¦éå¸¸è°¨æ…ã€‚å¾ˆå¤šæƒ…å†µä¸‹ï¼Œæœ‰æ›´åˆé€‚çš„æ›¿ä»£æ–¹æ¡ˆã€‚</p>
<p><strong>å®ç°æ–°ç³»ç»Ÿè°ƒç”¨çš„ä¼˜ç‚¹ï¼š</strong> - å®ç°ç®€å•ï¼Œä½¿ç”¨æ–¹ä¾¿ã€‚ - åœ¨
Linux ä¸Šç³»ç»Ÿè°ƒç”¨æ€§èƒ½å¾ˆé«˜ã€‚</p>
<p><strong>ç¼ºç‚¹ï¼š</strong> - éœ€è¦åˆ†é…ä¸€ä¸ªç³»ç»Ÿè°ƒç”¨å·ï¼Œå¿…é¡»å®˜æ–¹åˆ†é…ã€‚ -
ä¸€æ—¦è¿›å…¥ç¨³å®šå†…æ ¸ç‰ˆæœ¬ï¼Œæ¥å£å°±ä¸èƒ½éšæ„æ›´æ”¹ï¼Œå¦åˆ™ä¼šç ´åç”¨æˆ·ç©ºé—´åº”ç”¨çš„å…¼å®¹æ€§ã€‚
- æ¯ä¸ªæ¶æ„éƒ½è¦å•ç‹¬æ³¨å†Œå’Œæ”¯æŒè¯¥ç³»ç»Ÿè°ƒç”¨ã€‚ -
ç³»ç»Ÿè°ƒç”¨ä¸èƒ½ç›´æ¥è¢«è„šæœ¬è°ƒç”¨ï¼Œä¹Ÿä¸èƒ½ç›´æ¥é€šè¿‡æ–‡ä»¶ç³»ç»Ÿè®¿é—®ã€‚ -
éœ€è¦åˆ†é…ç³»ç»Ÿè°ƒç”¨å·ï¼Œéš¾ä»¥åœ¨ä¸»çº¿å†…æ ¸æ ‘ä¹‹å¤–ç»´æŠ¤å’Œä½¿ç”¨ã€‚ -
å¯¹äºç®€å•ä¿¡æ¯äº¤æ¢ï¼Œç³»ç»Ÿè°ƒç”¨æ˜¾å¾—è¿‡äºç¹é‡ã€‚</p>
<p><strong>å¸¸è§æ›¿ä»£æ–¹æ¡ˆï¼š</strong> - å®ç°ä¸€ä¸ªè®¾å¤‡èŠ‚ç‚¹ï¼Œé€šè¿‡
read()/write() è¿›è¡Œæ•°æ®äº¤æ¢ï¼Œä½¿ç”¨ ioctl() æ“ä½œç‰¹å®šè®¾ç½®æˆ–è·å–ä¿¡æ¯ã€‚ -
æŸäº›æ¥å£ï¼ˆå¦‚ä¿¡å·é‡ï¼‰å¯ä»¥ç”¨æ–‡ä»¶æè¿°ç¬¦è¡¨ç¤ºå¹¶è¿›è¡Œæ“ä½œã€‚ -
å°†ä¿¡æ¯ä½œä¸ºæ–‡ä»¶æ·»åŠ åˆ° sysfs çš„åˆé€‚ä½ç½®ã€‚</p>
<p>å¯¹äºè®¸å¤šæ¥å£ï¼Œç³»ç»Ÿè°ƒç”¨ç¡®å®æ˜¯æ­£ç¡®çš„é€‰æ‹©ã€‚ä½† Linux
ä¸€ç›´é¿å…ä¸ºæ¯ä¸ªæ–°æŠ½è±¡éƒ½æ·»åŠ ç³»ç»Ÿè°ƒç”¨ï¼Œè¿™ä½¿å¾—ç³»ç»Ÿè°ƒç”¨å±‚éå¸¸ç®€æ´ã€ç¨³å®šï¼Œå¾ˆå°‘æœ‰åºŸå¼ƒæ¥å£ã€‚æ–°ç³»ç»Ÿè°ƒç”¨å¢åŠ é€Ÿåº¦æ…¢ï¼Œè¯´æ˜
Linux å·²ç»ç›¸å¯¹ç¨³å®šä¸”åŠŸèƒ½å®Œå–„ã€‚</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://mackz-maxw.github.io/2025/06/27/oper_sys10/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Mackz-Maxw">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Maxwçš„å°ç«™">
      <meta itemprop="description" content="ä¹˜ä¸Šç‡ƒçŠ€èˆ¹ï¼Œè¿˜æœªæ›¾å»è¿‡å€’æ‚¬å±±ã€‚">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Maxwçš„å°ç«™">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/06/27/oper_sys10/" class="post-title-link" itemprop="url">æ“ä½œç³»ç»ŸåŸºç¡€ | 3. ç³»ç»Ÿè°ƒç”¨</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>
      

      <time title="åˆ›å»ºæ—¶é—´ï¼š2025-06-28 02:34:45 / ä¿®æ”¹æ—¶é—´ï¼š05:15:15" itemprop="dateCreated datePublished" datetime="2025-06-28T02:34:45+08:00">2025-06-28</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/os-basic/" itemprop="url" rel="index"><span itemprop="name">os basic</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="ä¸å†…æ ¸é€šä¿¡">ä¸å†…æ ¸é€šä¿¡</h2>
<p>ç³»ç»Ÿè°ƒç”¨ï¼ˆsystem
callï¼‰åœ¨ç¡¬ä»¶å’Œç”¨æˆ·ç©ºé—´è¿›ç¨‹ä¹‹é—´æä¾›äº†ä¸€å±‚æŠ½è±¡ï¼Œè¿™ä¸€å±‚æœ‰ä¸‰ä¸ªä¸»è¦ä½œç”¨ï¼š</p>
<ol type="1">
<li><p><strong>ç¡¬ä»¶æŠ½è±¡</strong><br />
ç³»ç»Ÿè°ƒç”¨ä¸ºç”¨æˆ·ç©ºé—´æä¾›äº†ç»Ÿä¸€çš„ç¡¬ä»¶æ¥å£ã€‚ä¾‹å¦‚ï¼Œåº”ç”¨ç¨‹åºåœ¨è¯»å†™æ–‡ä»¶æ—¶ï¼Œæ— éœ€å…³å¿ƒåº•å±‚çš„ç£ç›˜ç±»å‹ã€ä»‹è´¨ç±»å‹ï¼Œç”šè‡³æ–‡ä»¶æ‰€åœ¨çš„æ–‡ä»¶ç³»ç»Ÿç±»å‹ã€‚</p></li>
<li><p><strong>ç³»ç»Ÿå®‰å…¨ä¸ç¨³å®š</strong><br />
æœ‰äº†å†…æ ¸ä½œä¸ºä¸­ä»‹ï¼Œå†…æ ¸å¯ä»¥æ ¹æ®æƒé™ã€ç”¨æˆ·ç­‰æ ‡å‡†ä»²è£èµ„æºè®¿é—®ã€‚è¿™é˜²æ­¢äº†åº”ç”¨ç¨‹åºè¯¯ç”¨ç¡¬ä»¶ã€çªƒå–å…¶ä»–è¿›ç¨‹èµ„æºæˆ–å¯¹ç³»ç»Ÿé€ æˆç ´åã€‚</p></li>
<li><p><strong>è™šæ‹ŸåŒ–ä¸å¤šä»»åŠ¡æ”¯æŒ</strong><br />
ç”¨æˆ·ç©ºé—´ä¸ç³»ç»Ÿå…¶ä»–éƒ¨åˆ†ä¹‹é—´æœ‰ç»Ÿä¸€çš„æ¥å£ï¼Œä¾¿äºå®ç°è¿›ç¨‹è™šæ‹ŸåŒ–å’Œå¤šä»»åŠ¡ã€‚å¦‚æœåº”ç”¨èƒ½ç›´æ¥è®¿é—®ç³»ç»Ÿèµ„æºï¼Œå°†éš¾ä»¥å®ç°å¤šä»»åŠ¡å’Œè™šæ‹Ÿå†…å­˜ï¼Œæ›´æ— æ³•ä¿è¯ç³»ç»Ÿçš„ç¨³å®šå’Œå®‰å…¨ã€‚</p></li>
</ol>
<p>åœ¨ Linux
ä¸­ï¼Œç³»ç»Ÿè°ƒç”¨æ˜¯ç”¨æˆ·ç©ºé—´ä¸å†…æ ¸äº¤äº’çš„å”¯ä¸€åˆæ³•å…¥å£ï¼ˆé™¤äº†å¼‚å¸¸å’Œé™·é˜±ï¼‰ã€‚å³ä½¿æ˜¯è®¾å¤‡æ–‡ä»¶æˆ–
<code>/proc</code>
è¿™æ ·çš„æ¥å£ï¼Œæœ€ç»ˆä¹Ÿè¦é€šè¿‡ç³»ç»Ÿè°ƒç”¨è®¿é—®ã€‚å€¼å¾—ä¸€æçš„æ˜¯ï¼ŒLinux
çš„ç³»ç»Ÿè°ƒç”¨æ•°é‡æ¯”å¤§å¤šæ•°ç³»ç»Ÿè¦å°‘ã€‚</p>
<h3 id="apiposix-ä¸-c-åº“">APIã€POSIX ä¸ C åº“</h3>
<p>é€šå¸¸ï¼Œåº”ç”¨ç¨‹åºæ˜¯åŸºäºç”¨æˆ·ç©ºé—´çš„
APIï¼ˆåº”ç”¨ç¨‹åºç¼–ç¨‹æ¥å£ï¼‰å¼€å‘çš„ï¼Œè€Œä¸æ˜¯ç›´æ¥è°ƒç”¨ç³»ç»Ÿè°ƒç”¨ã€‚è¿™å¾ˆé‡è¦ï¼Œå› ä¸º
API ä¸å†…æ ¸å®é™…æä¾›çš„æ¥å£ä¹‹é—´ä¸éœ€è¦ä¸€ä¸€å¯¹åº”ã€‚API
å®šä¹‰äº†ä¸€ç»„ä¾›åº”ç”¨ç¨‹åºä½¿ç”¨çš„ç¼–ç¨‹æ¥å£ï¼Œè¿™äº›æ¥å£å¯ä»¥é€šè¿‡ä¸€ä¸ªç³»ç»Ÿè°ƒç”¨å®ç°ï¼Œä¹Ÿå¯ä»¥é€šè¿‡å¤šä¸ªç³»ç»Ÿè°ƒç”¨ï¼Œç”šè‡³å®Œå…¨ä¸ä¾èµ–ç³»ç»Ÿè°ƒç”¨ã€‚è¿™æ ·ï¼ŒåŒæ ·çš„
API å¯ä»¥åœ¨ä¸åŒç³»ç»Ÿä¸Šå®ç°ï¼Œåº”ç”¨ç¨‹åºæ— éœ€å…³å¿ƒåº•å±‚å®ç°ç»†èŠ‚ã€‚</p>
<p>åœ¨ Unix ä¸–ç•Œä¸­ï¼Œæœ€å¸¸è§çš„ API ä¹‹ä¸€æ˜¯åŸºäº POSIX æ ‡å‡†çš„ã€‚POSIX æ˜¯ IEEE
åˆ¶å®šçš„ä¸€ç³»åˆ—æ ‡å‡†ï¼Œæ—¨åœ¨æä¾›åŸºäº Unix çš„å¯ç§»æ¤æ“ä½œç³»ç»Ÿæ ‡å‡†ã€‚Linux
åœ¨é€‚ç”¨çš„åœ°æ–¹åŠªåŠ›å…¼å®¹ POSIX å’Œ SUSv3ã€‚</p>
<p>POSIX å¾ˆå¥½åœ°ä½“ç°äº† API ä¸ç³»ç»Ÿè°ƒç”¨çš„å…³ç³»ã€‚åœ¨å¤§å¤šæ•° Unix ç³»ç»Ÿä¸­ï¼ŒPOSIX
API ä¸ç³»ç»Ÿè°ƒç”¨é«˜åº¦ç›¸å…³ï¼ŒPOSIX æ ‡å‡†æœ¬èº«å°±æ˜¯å‚è€ƒæ—©æœŸ Unix
ç³»ç»Ÿæ¥å£åˆ¶å®šçš„ã€‚ä½†æœ‰äº›é Unix ç³»ç»Ÿï¼ˆå¦‚ Windowsï¼‰ä¹Ÿæä¾›äº† POSIX
å…¼å®¹åº“ã€‚</p>
<h4 id="c-åº“çš„ä½œç”¨">C åº“çš„ä½œç”¨</h4>
<p>åœ¨ Linux å’Œå¤§å¤šæ•° Unix ç³»ç»Ÿä¸­ï¼ŒC åº“ï¼ˆå¦‚
glibcï¼‰éƒ¨åˆ†å®ç°äº†ç³»ç»Ÿè°ƒç”¨æ¥å£ã€‚C åº“ä¸ä»…å®ç°äº†æ ‡å‡† C
åº“ï¼Œè¿˜å®ç°äº†ç³»ç»Ÿè°ƒç”¨æ¥å£ï¼Œæ˜¯æ‰€æœ‰ C ç¨‹åºçš„åŸºç¡€ã€‚ç”±äº C
è¯­è¨€çš„ç‰¹æ€§ï¼Œå…¶ä»–ç¼–ç¨‹è¯­è¨€ä¹Ÿå¯ä»¥å¾ˆæ–¹ä¾¿åœ°è°ƒç”¨ C åº“ã€‚C åº“è¿˜å®ç°äº†å¤§éƒ¨åˆ†
POSIX APIã€‚</p>
<p>å¯¹åº”ç”¨å¼€å‘è€…æ¥è¯´ï¼Œç³»ç»Ÿè°ƒç”¨çš„ç»†èŠ‚å¹¶ä¸é‡è¦ï¼Œä»–ä»¬åªå…³å¿ƒ
APIï¼›è€Œå†…æ ¸åªå…³å¿ƒç³»ç»Ÿè°ƒç”¨ï¼Œè‡³äºå“ªäº›åº“å‡½æ•°æˆ–åº”ç”¨ç¨‹åºä¼šç”¨åˆ°è¿™äº›ç³»ç»Ÿè°ƒç”¨ï¼Œå†…æ ¸å¹¶ä¸å…³å¿ƒã€‚ä¸è¿‡ï¼Œå†…æ ¸éœ€è¦ä¿è¯ç³»ç»Ÿè°ƒç”¨çš„é€šç”¨æ€§å’Œçµæ´»æ€§ï¼Œä»¥é€‚åº”å„ç§ç”¨é€”ã€‚</p>
<h3 id="ç³»ç»Ÿè°ƒç”¨syscalls">ç³»ç»Ÿè°ƒç”¨ï¼ˆSyscallsï¼‰</h3>
<p>åœ¨ Linux ä¸­ï¼Œç³»ç»Ÿè°ƒç”¨ï¼ˆsyscallï¼‰é€šå¸¸é€šè¿‡ C
åº“ä¸­å®šä¹‰çš„å‡½æ•°è¿›è¡Œè®¿é—®ã€‚ç³»ç»Ÿè°ƒç”¨å¯ä»¥æœ‰é›¶ä¸ªã€ä¸€ä¸ªæˆ–å¤šä¸ªå‚æ•°ï¼ˆè¾“å…¥ï¼‰ï¼Œå¹¶å¯èƒ½äº§ç”Ÿä¸€ä¸ªæˆ–å¤šä¸ªå‰¯ä½œç”¨ï¼Œä¾‹å¦‚å†™æ–‡ä»¶æˆ–å°†æ•°æ®å¤åˆ¶åˆ°æŒ‡å®šæŒ‡é’ˆã€‚ç³»ç»Ÿè°ƒç”¨è¿˜ä¼šè¿”å›ä¸€ä¸ª
long
ç±»å‹çš„å€¼ï¼Œç”¨äºè¡¨ç¤ºæˆåŠŸæˆ–é”™è¯¯â€”â€”é€šå¸¸ï¼ˆä½†å¹¶éæ€»æ˜¯ï¼‰è´Ÿå€¼è¡¨ç¤ºé”™è¯¯ï¼Œè¿”å›å€¼ä¸º 0
é€šå¸¸ï¼ˆä½†ä¹Ÿä¸æ˜¯æ€»æ˜¯ï¼‰è¡¨ç¤ºæˆåŠŸã€‚</p>
<p>å½“ç³»ç»Ÿè°ƒç”¨å‡ºé”™æ—¶ï¼ŒC åº“ä¼šå°†ä¸€ä¸ªç‰¹æ®Šçš„é”™è¯¯ç å†™å…¥å…¨å±€å˜é‡
<code>errno</code>ã€‚å¯ä»¥é€šè¿‡å¦‚ <code>perror()</code> è¿™æ ·çš„åº“å‡½æ•°å°†
<code>errno</code> è½¬æ¢ä¸ºå¯è¯»çš„é”™è¯¯ä¿¡æ¯ã€‚</p>
<p>ç³»ç»Ÿè°ƒç”¨æœ‰æ˜ç¡®çš„è¡Œä¸ºå®šä¹‰ã€‚ä¾‹å¦‚ï¼Œ<code>getpid()</code>
ç³»ç»Ÿè°ƒç”¨è¢«å®šä¹‰ä¸ºè¿”å›å½“å‰è¿›ç¨‹çš„ PIDã€‚å…¶å†…æ ¸å®ç°å¤§è‡´å¦‚ä¸‹ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">SYSCALL_DEFINE0(getpid) </span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">return</span> task_tgid_vnr(current); <span class="comment">// è¿”å› current-&gt;tgid</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>æ³¨ï¼šä½ å¯èƒ½ä¼šå¥½å¥‡ä¸ºä»€ä¹ˆ <code>getpid()</code> è¿”å›çš„æ˜¯
tgidï¼ˆçº¿ç¨‹ç»„IDï¼‰ï¼Ÿåœ¨æ™®é€šè¿›ç¨‹ä¸­ï¼ŒTGID ç­‰äº
PIDï¼›è€Œåœ¨çº¿ç¨‹ä¸­ï¼ŒåŒä¸€çº¿ç¨‹ç»„çš„æ‰€æœ‰çº¿ç¨‹ TGID ç›¸åŒï¼Œè¿™æ ·æ‰€æœ‰çº¿ç¨‹è°ƒç”¨
<code>getpid()</code> æ—¶è¿”å›ç›¸åŒçš„ PIDã€‚</p>
</blockquote>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå®šä¹‰åªè§„å®šäº†è¡Œä¸ºï¼Œå…·ä½“å®ç°æ–¹å¼ç”±å†…æ ¸å†³å®šï¼Œåªè¦ç»“æœæ­£ç¡®å³å¯ã€‚<code>SYSCALL_DEFINE0</code>
æ˜¯ä¸€ä¸ªå®ï¼Œç”¨äºå®šä¹‰æ— å‚æ•°çš„ç³»ç»Ÿè°ƒç”¨ï¼ˆ0 è¡¨ç¤ºå‚æ•°ä¸ªæ•°ï¼‰ã€‚å±•å¼€åç±»ä¼¼äºï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">asmlinkage <span class="type">long</span> <span class="title function_">sys_getpid</span><span class="params">(<span class="type">void</span>)</span></span><br></pre></td></tr></table></figure>
<ul>
<li><code>asmlinkage</code>
ä¿®é¥°ç¬¦å‘Šè¯‰ç¼–è¯‘å™¨åªä»æ ˆä¸Šè·å–å‚æ•°ï¼Œè¿™æ˜¯æ‰€æœ‰ç³»ç»Ÿè°ƒç”¨éƒ½éœ€è¦çš„ä¿®é¥°ç¬¦ã€‚</li>
<li>è¿”å›ç±»å‹ä¸º longï¼Œæ˜¯ä¸ºäº†å…¼å®¹ 32 ä½å’Œ 64 ä½ç³»ç»Ÿã€‚å³ä½¿ç”¨æˆ·ç©ºé—´å®šä¹‰ä¸º
intï¼Œå†…æ ¸ä¸­ä¹Ÿè¿”å› longã€‚</li>
<li>å‘½åçº¦å®šï¼šå†…æ ¸ä¸­ç³»ç»Ÿè°ƒç”¨çš„å®ç°å‡½æ•°åä¸º <code>sys_xxx()</code>ï¼Œå¦‚
<code>getpid()</code> å¯¹åº” <code>sys_getpid()</code>ã€‚</li>
</ul>
<h4 id="ç³»ç»Ÿè°ƒç”¨å·system-call-numbers">ç³»ç»Ÿè°ƒç”¨å·ï¼ˆSystem Call
Numbersï¼‰</h4>
<p>åœ¨ Linux ä¸­ï¼Œæ¯ä¸ªç³»ç»Ÿè°ƒç”¨éƒ½æœ‰å”¯ä¸€çš„ç³»ç»Ÿè°ƒç”¨å·ï¼ˆsyscall
numberï¼‰ï¼Œç”¨äºæ ‡è¯†å…·ä½“çš„ç³»ç»Ÿè°ƒç”¨ã€‚ç”¨æˆ·ç©ºé—´è¿›ç¨‹æ‰§è¡Œç³»ç»Ÿè°ƒç”¨æ—¶ï¼Œå®é™…ä¸Šæ˜¯é€šè¿‡ç³»ç»Ÿè°ƒç”¨å·æ¥æŒ‡å®šè°ƒç”¨å“ªä¸ªç³»ç»Ÿè°ƒç”¨ï¼Œè€Œä¸æ˜¯ç”¨åå­—ã€‚</p>
<p>ç³»ç»Ÿè°ƒç”¨å·éå¸¸é‡è¦ï¼Œä¸€æ—¦åˆ†é…å°±ä¸èƒ½æ›´æ”¹ï¼Œå¦åˆ™å·²ç¼–è¯‘çš„åº”ç”¨ç¨‹åºä¼šå‡ºé”™ã€‚åŒæ ·ï¼Œå¦‚æœæŸä¸ªç³»ç»Ÿè°ƒç”¨è¢«ç§»é™¤ï¼Œå…¶ç¼–å·ä¹Ÿä¸èƒ½è¢«å›æ”¶ï¼Œå¦åˆ™æ—§ç¨‹åºä¼šè°ƒç”¨åˆ°é”™è¯¯çš„ç³»ç»Ÿè°ƒç”¨ã€‚Linux
æä¾›äº†ä¸€ä¸ªâ€œæœªå®ç°â€ç³»ç»Ÿè°ƒç”¨ <code>sys_ni_syscall()</code>ï¼Œå®ƒåªè¿”å›
-ENOSYSï¼ˆè¡¨ç¤ºæ— æ•ˆç³»ç»Ÿè°ƒç”¨ï¼‰ï¼Œç”¨äºå¡«è¡¥è¢«ç§»é™¤æˆ–ä¸å¯ç”¨çš„ç³»ç»Ÿè°ƒç”¨å·ã€‚</p>
<p>å†…æ ¸é€šè¿‡ç³»ç»Ÿè°ƒç”¨è¡¨ï¼ˆ<code>sys_call_table</code>ï¼‰ç»´æŠ¤æ‰€æœ‰å·²æ³¨å†Œçš„ç³»ç»Ÿè°ƒç”¨ã€‚åœ¨
x86-64 æ¶æ„ä¸‹ï¼Œè¿™ä¸ªè¡¨å®šä¹‰åœ¨ <code>arch/i386/kernel/syscall_64.c</code>
æ–‡ä»¶ä¸­ï¼Œæ¯ä¸ªæœ‰æ•ˆçš„ç³»ç»Ÿè°ƒç”¨éƒ½åˆ†é…æœ‰å”¯ä¸€çš„ç¼–å·ã€‚</p>
<h4 id="ç³»ç»Ÿè°ƒç”¨æ€§èƒ½">ç³»ç»Ÿè°ƒç”¨æ€§èƒ½</h4>
<p>Linux çš„ç³»ç»Ÿè°ƒç”¨æ¯”è®¸å¤šå…¶ä»–æ“ä½œç³»ç»Ÿæ›´å¿«ï¼Œè¿™éƒ¨åˆ†å½’åŠŸäº Linux
çš„ä¸Šä¸‹æ–‡åˆ‡æ¢é€Ÿåº¦å¿«ï¼Œè¿›å…¥å’Œé€€å‡ºå†…æ ¸çš„è¿‡ç¨‹éå¸¸ç®€æ´é«˜æ•ˆï¼Œç³»ç»Ÿè°ƒç”¨å¤„ç†å™¨å’Œå„ä¸ªç³»ç»Ÿè°ƒç”¨æœ¬èº«ä¹Ÿå¾ˆç®€å•ã€‚</p>
<h3 id="ç³»ç»Ÿè°ƒç”¨å¤„ç†å™¨system-call-handler">ç³»ç»Ÿè°ƒç”¨å¤„ç†å™¨ï¼ˆSystem Call
Handlerï¼‰</h3>
<p>ç”¨æˆ·ç©ºé—´çš„åº”ç”¨ç¨‹åº<strong>æ— æ³•ç›´æ¥æ‰§è¡Œå†…æ ¸ä»£ç </strong>ï¼Œä¹Ÿä¸èƒ½ç›´æ¥è°ƒç”¨å†…æ ¸ç©ºé—´çš„æ–¹æ³•ï¼Œå› ä¸ºå†…æ ¸å¤„äºå—ä¿æŠ¤çš„å†…å­˜ç©ºé—´ã€‚å¦‚æœåº”ç”¨å¯ä»¥ç›´æ¥è¯»å†™å†…æ ¸åœ°å€ç©ºé—´ï¼Œç³»ç»Ÿçš„å®‰å…¨æ€§å’Œç¨³å®šæ€§å°†æ— æ³•ä¿è¯ã€‚</p>
<p>å› æ­¤ï¼Œç”¨æˆ·ç©ºé—´çš„åº”ç”¨ç¨‹åºå¿…é¡»é€šè¿‡æŸç§æ–¹å¼<strong>é€šçŸ¥å†…æ ¸</strong>ï¼Œè®©ç³»ç»Ÿåˆ‡æ¢åˆ°å†…æ ¸æ€ï¼Œç”±å†…æ ¸ä»£è¡¨åº”ç”¨ç¨‹åºåœ¨å†…æ ¸ç©ºé—´æ‰§è¡Œç³»ç»Ÿè°ƒç”¨ã€‚</p>
<h4 id="è¿›å…¥å†…æ ¸çš„æœºåˆ¶">è¿›å…¥å†…æ ¸çš„æœºåˆ¶</h4>
<p>è¿™ç§é€šçŸ¥å†…æ ¸çš„æœºåˆ¶æ˜¯ä¸€ç§<strong>è½¯ä»¶ä¸­æ–­</strong>ï¼šå³è§¦å‘ä¸€ä¸ªå¼‚å¸¸ï¼Œç³»ç»Ÿä¼šåˆ‡æ¢åˆ°å†…æ ¸æ€å¹¶æ‰§è¡Œå¼‚å¸¸å¤„ç†ç¨‹åºã€‚åœ¨ç³»ç»Ÿè°ƒç”¨çš„åœºæ™¯ä¸‹ï¼Œè¿™ä¸ªå¼‚å¸¸å¤„ç†ç¨‹åºå°±æ˜¯<strong>ç³»ç»Ÿè°ƒç”¨å¤„ç†å™¨</strong>ï¼ˆsystem
call handlerï¼‰ã€‚</p>
<ul>
<li>åœ¨ x86 æ¶æ„ä¸Šï¼Œå®šä¹‰çš„è½¯ä»¶ä¸­æ–­å·ä¸º 128ï¼Œé€šè¿‡ <code>int $0x80</code>
æŒ‡ä»¤è§¦å‘ã€‚è¿™ä¼šå¯¼è‡´ç³»ç»Ÿåˆ‡æ¢åˆ°å†…æ ¸æ€ï¼Œå¹¶æ‰§è¡Œå¼‚å¸¸å‘é‡
128ï¼ˆå³ç³»ç»Ÿè°ƒç”¨å¤„ç†å™¨ï¼‰ã€‚</li>
<li>ç³»ç»Ÿè°ƒç”¨å¤„ç†å™¨çš„å‡½æ•°åé€šå¸¸ä¸º
<code>system_call()</code>ï¼Œå®ƒæ˜¯ä¸æ¶æ„ç›¸å…³çš„ä»£ç ï¼ˆå¦‚ x86-64 ä¸‹åœ¨
<code>entry_64.S</code> æ±‡ç¼–æ–‡ä»¶ä¸­å®ç°ï¼‰ã€‚</li>
<li>è¿‘å¹´æ¥ï¼Œx86 å¤„ç†å™¨å¢åŠ äº† <code>sysenter</code> æŒ‡ä»¤ï¼Œè¿™æ˜¯ä¸€ç§æ¯”
<code>int $0x80</code>
æ›´å¿«ã€æ›´ä¸“ç”¨çš„è¿›å…¥å†…æ ¸æ‰§è¡Œç³»ç»Ÿè°ƒç”¨çš„æ–¹æ³•ã€‚å†…æ ¸å¾ˆå¿«å°±æ”¯æŒäº†è¿™ç§æ–¹å¼ã€‚</li>
<li>æ— è®ºé‡‡ç”¨å“ªç§æ–¹å¼ï¼Œæ ¸å¿ƒæ€æƒ³éƒ½æ˜¯ï¼šç”¨æˆ·ç©ºé—´é€šè¿‡å¼‚å¸¸æˆ–é™·é˜±ï¼ˆtrapï¼‰è¿›å…¥å†…æ ¸ã€‚</li>
</ul>
<h4 id="æŒ‡å®šæ­£ç¡®çš„ç³»ç»Ÿè°ƒç”¨">æŒ‡å®šæ­£ç¡®çš„ç³»ç»Ÿè°ƒç”¨</h4>
<p>ä»…ä»…è¿›å…¥å†…æ ¸ç©ºé—´è¿˜ä¸å¤Ÿï¼Œå› ä¸ºæœ‰å¾ˆå¤šä¸åŒçš„ç³»ç»Ÿè°ƒç”¨ï¼Œå®ƒä»¬éƒ½æ˜¯é€šè¿‡ç›¸åŒçš„æ–¹å¼è¿›å…¥å†…æ ¸çš„ã€‚å› æ­¤ï¼Œ<strong>å¿…é¡»å°†ç³»ç»Ÿè°ƒç”¨å·ä¼ é€’ç»™å†…æ ¸</strong>ã€‚</p>
<ul>
<li><p>åœ¨ x86 æ¶æ„ä¸Šï¼Œç³»ç»Ÿè°ƒç”¨å·é€šè¿‡ <code>eax</code>
32ä½å¯„å­˜å™¨ä¼ é€’ã€‚åœ¨è§¦å‘é™·é˜±è¿›å…¥å†…æ ¸å‰ï¼Œç”¨æˆ·ç©ºé—´ä¼šæŠŠæ‰€éœ€ç³»ç»Ÿè°ƒç”¨çš„ç¼–å·å†™å…¥
<code>eax</code>ã€‚</p></li>
<li><p>ç³»ç»Ÿè°ƒç”¨å¤„ç†å™¨è¯»å– <code>eax</code> çš„å€¼ï¼Œåˆ¤æ–­å…¶æœ‰æ•ˆæ€§ï¼ˆä¸
<code>NR_syscalls</code> æ¯”è¾ƒï¼‰ã€‚å¦‚æœç¼–å·æ— æ•ˆï¼Œè¿”å› <code>-ENOSYS</code>
é”™è¯¯ï¼›å¦åˆ™ï¼Œé€šè¿‡ç³»ç»Ÿè°ƒç”¨è¡¨è°ƒç”¨å¯¹åº”çš„ç³»ç»Ÿè°ƒç”¨å‡½æ•°ï¼š <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">call *sys_call_table(,%rax,8)</span><br></pre></td></tr></table></figure> &gt;
raxå’Œeaxå‡ä¸ºç´¯åŠ å™¨ï¼ŒåŒºåˆ«æ˜¯raxæ˜¯64ä½ï¼Œ eax32ä½</p>
<p>è¿™é‡Œæ¯ä¸ªè¡¨é¡¹ 8 å­—èŠ‚ï¼ˆ64 ä½ï¼‰ï¼Œæ‰€ä»¥ç”¨ 8 ä¹˜ä»¥ç³»ç»Ÿè°ƒç”¨å·å®šä½è¡¨é¡¹ï¼ˆx86-32
ä¸‹ç”¨ 4 ä¹˜ä»¥ç³»ç»Ÿè°ƒç”¨å·ï¼‰ã€‚</p></li>
</ul>
<h4 id="å‚æ•°ä¼ é€’">å‚æ•°ä¼ é€’</h4>
<p>é™¤äº†ç³»ç»Ÿè°ƒç”¨å·ï¼Œå¤§å¤šæ•°ç³»ç»Ÿè°ƒç”¨è¿˜éœ€è¦ä¼ é€’ä¸€ä¸ªæˆ–å¤šä¸ªå‚æ•°ã€‚ç”¨æˆ·ç©ºé—´å¿…é¡»åœ¨é™·é˜±æ•è·è¿‡ç¨‹ä¸­æ—¶å°†å‚æ•°ä¼ é€’ç»™å†…æ ¸ã€‚</p>
<ul>
<li>æœ€ç®€å•çš„æ–¹å¼æ˜¯<strong>é€šè¿‡å¯„å­˜å™¨ä¼ é€’å‚æ•°</strong>ã€‚åœ¨ x86-32
æ¶æ„ä¸‹ï¼Œ<code>ebx</code>ã€<code>ecx</code>ã€<code>edx</code>ã€<code>esi</code>ã€<code>edi</code>
ä¾æ¬¡å­˜æ”¾å‰äº”ä¸ªå‚æ•°ã€‚</li>
<li>å¦‚æœå‚æ•°è¶…è¿‡äº”ä¸ªï¼Œåˆ™ç”¨ä¸€ä¸ªå¯„å­˜å™¨ä¼ é€’æŒ‡å‘ç”¨æˆ·ç©ºé—´å‚æ•°æ•°ç»„çš„æŒ‡é’ˆã€‚</li>
<li>è¿”å›å€¼ä¹Ÿé€šè¿‡å¯„å­˜å™¨ä¼ é€’ï¼Œx86 ä¸‹å†™å…¥ <code>eax</code>ã€‚</li>
</ul>
<p><strong>è°ƒç”¨ç³»ç»Ÿè°ƒç”¨å¤„ç†å™¨å¹¶æ‰§è¡Œç³»ç»Ÿè°ƒç”¨çš„æµç¨‹</strong>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">+-------------------+         +-------------------+</span><br><span class="line">|    User Space     |         |   Kernel Space    |</span><br><span class="line">|-------------------|         |-------------------|</span><br><span class="line">| Application       |         | Syscall Handler   |</span><br><span class="line">|   call read()     |         |   system_call()   |</span><br><span class="line">|-------------------|         |-------------------|</span><br><span class="line">| C library         |         | sys_read()        |</span><br><span class="line">| read() wrapper    |         |                   |</span><br><span class="line">+-------------------+         +-------------------+</span><br></pre></td></tr></table></figure></p>
<ul>
<li>åº”ç”¨ç¨‹åºè°ƒç”¨ <code>read()</code>ï¼Œå®é™…ä¸Šå…ˆè°ƒç”¨ C åº“çš„
<code>read()</code> å°è£…å‡½æ•°ã€‚</li>
<li>C åº“çš„ <code>read()</code> å°è£…å‡½æ•°é€šè¿‡è½¯ä¸­æ–­ï¼ˆå¦‚
<code>int $0x80</code> æˆ– <code>sysenter</code>ï¼‰è¿›å…¥å†…æ ¸ï¼Œè°ƒç”¨
<code>system_call()</code>ã€‚</li>
<li><code>system_call()</code> è¯»å–ç³»ç»Ÿè°ƒç”¨å·å’Œå‚æ•°ï¼ŒæŸ¥æ‰¾å¹¶è°ƒç”¨å†…æ ¸ä¸­çš„
<code>sys_read()</code> å®ç°ã€‚</li>
<li>æ‰§è¡Œå®Œæ¯•åï¼Œè¿”å›å€¼é€šè¿‡å¯„å­˜å™¨ä¼ å›ç”¨æˆ·ç©ºé—´ï¼Œæµç¨‹åå‘è¿”å›åˆ°åº”ç”¨ç¨‹åºã€‚</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://mackz-maxw.github.io/2025/06/25/oper_sysn2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Mackz-Maxw">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Maxwçš„å°ç«™">
      <meta itemprop="description" content="ä¹˜ä¸Šç‡ƒçŠ€èˆ¹ï¼Œè¿˜æœªæ›¾å»è¿‡å€’æ‚¬å±±ã€‚">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Maxwçš„å°ç«™">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/06/25/oper_sysn2/" class="post-title-link" itemprop="url">æ“ä½œç³»ç»ŸåŸºç¡€ | ç³»ç»Ÿç¼–ç¨‹å¸¸ç”¨è®¾ç½®2</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>
      

      <time title="åˆ›å»ºæ—¶é—´ï¼š2025-06-26 05:46:20 / ä¿®æ”¹æ—¶é—´ï¼š07:49:32" itemprop="dateCreated datePublished" datetime="2025-06-26T05:46:20+08:00">2025-06-26</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/os-basic/" itemprop="url" rel="index"><span itemprop="name">os basic</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="å¯ç§»æ¤æ€§é—®é¢˜portability-issues">å¯ç§»æ¤æ€§é—®é¢˜ï¼ˆPortability
Issuesï¼‰</h2>
<h3 id="ç‰¹æ€§æµ‹è¯•å®feature-test-macros">ç‰¹æ€§æµ‹è¯•å®ï¼ˆFeature Test
Macrosï¼‰</h3>
<ul>
<li>ç³»ç»Ÿè°ƒç”¨å’Œåº“å‡½æ•° API çš„è¡Œä¸ºå—å¤šç§æ ‡å‡†è§„èŒƒï¼ˆå¦‚ The Open Group çš„
Single UNIX Specificationã€BSDã€System V Release 4
åŠå…¶æ¥å£å®šä¹‰ï¼‰çº¦æŸã€‚</li>
<li>ä¸ºäº†è®©å¤´æ–‡ä»¶åªæš´éœ²ç¬¦åˆæŸä¸€æ ‡å‡†çš„å®šä¹‰ï¼ˆå¦‚å¸¸é‡ã€å‡½æ•°åŸå‹ç­‰ï¼‰ï¼Œå¯ä»¥åœ¨ç¼–è¯‘æ—¶å®šä¹‰ä¸€ä¸ªæˆ–å¤šä¸ªç‰¹æ€§æµ‹è¯•å®ã€‚å®šä¹‰æ–¹å¼æœ‰ä¸¤ç§ï¼š
<ol type="1">
<li>åœ¨æºä»£ç ä¸­åŒ…å«å¤´æ–‡ä»¶å‰å®šä¹‰å®ï¼š <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> _BSD_SOURCE 1</span></span><br></pre></td></tr></table></figure></li>
<li>ç”¨ç¼–è¯‘å™¨çš„ <code>-D</code> é€‰é¡¹å®šä¹‰ï¼š <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ cc -D_BSD_SOURCE prog.c</span><br></pre></td></tr></table></figure></li>
</ol></li>
<li>â€œç‰¹æ€§æµ‹è¯•å®â€è¿™ä¸ªåå­—çš„ç”±æ¥æ˜¯ï¼šå®ç°ä¼šé€šè¿‡ <code>#if</code>
åˆ¤æ–­è¿™äº›å®çš„å€¼ï¼Œå†³å®šå¤´æ–‡ä»¶ä¸­å“ªäº›ç‰¹æ€§å¯¹åº”ç”¨å¯è§ã€‚</li>
</ul>
<h4 id="å¸¸ç”¨ç‰¹æ€§æµ‹è¯•å®">å¸¸ç”¨ç‰¹æ€§æµ‹è¯•å®</h4>
<p>è¿™äº›å®ç”±ç›¸å…³æ ‡å‡†è§„å®šï¼Œé€‚ç”¨äºæ‰€æœ‰æ”¯æŒè¿™äº›æ ‡å‡†çš„ç³»ç»Ÿï¼š</p>
<ul>
<li><code>_POSIX_SOURCE</code><br />
å®šä¹‰åæš´éœ²ç¬¦åˆ POSIX.1-1990 å’Œ ISO C (1990) çš„å®šä¹‰ã€‚å·²è¢«
<code>_POSIX_C_SOURCE</code> å–ä»£ã€‚</li>
<li><code>_POSIX_C_SOURCE</code>
<ul>
<li>å€¼ä¸º 1 æ—¶ï¼Œæ•ˆæœåŒ <code>_POSIX_SOURCE</code>ã€‚</li>
<li>å€¼ â‰¥ 199309 æ—¶ï¼Œæš´éœ² POSIX.1bï¼ˆå®æ—¶ï¼‰å®šä¹‰ã€‚</li>
<li>å€¼ â‰¥ 199506 æ—¶ï¼Œæš´éœ² POSIX.1cï¼ˆçº¿ç¨‹ï¼‰å®šä¹‰ã€‚</li>
<li>å€¼ä¸º 200112 æ—¶ï¼Œæš´éœ² POSIX.1-2001 åŸºç¡€è§„èŒƒï¼ˆä¸å« XSI æ‰©å±•ï¼‰ã€‚</li>
<li>å€¼ä¸º 200809 æ—¶ï¼Œæš´éœ² POSIX.1-2008 åŸºç¡€è§„èŒƒã€‚</li>
</ul></li>
<li><code>_XOPEN_SOURCE</code>
<ul>
<li>å®šä¹‰åæš´éœ² POSIX.1ã€POSIX.2 å’Œ X/Open (XPG4) å®šä¹‰ã€‚</li>
<li>å€¼ â‰¥ 500 æ—¶ï¼Œæš´éœ² SUSv2ï¼ˆUNIX 98 å’Œ XPG5ï¼‰æ‰©å±•ã€‚</li>
<li>å€¼ â‰¥ 600 æ—¶ï¼Œæš´éœ² SUSv3 XSIï¼ˆUNIX 03ï¼‰å’Œ C99 æ‰©å±•ã€‚</li>
<li>å€¼ â‰¥ 700 æ—¶ï¼Œæš´éœ² SUSv4 XSI æ‰©å±•ã€‚</li>
</ul></li>
</ul>
<h4 id="glibc-ç‰¹æœ‰çš„ç‰¹æ€§æµ‹è¯•å®">glibc ç‰¹æœ‰çš„ç‰¹æ€§æµ‹è¯•å®</h4>
<ul>
<li><code>_BSD_SOURCE</code><br />
å®šä¹‰åæš´éœ² BSD å®šä¹‰ï¼ŒåŒæ—¶å®šä¹‰
<code>_POSIX_C_SOURCE=199506</code>ã€‚å¦‚åªå®šä¹‰æ­¤å®ï¼Œéƒ¨åˆ†æ ‡å‡†å†²çªæ—¶ä¼˜å…ˆ
BSD å®šä¹‰ã€‚</li>
<li><code>_SVID_SOURCE</code><br />
å®šä¹‰åæš´éœ² System V æ¥å£å®šä¹‰ï¼ˆSVIDï¼‰ã€‚</li>
<li><code>_GNU_SOURCE</code><br />
å®šä¹‰åæš´éœ²æ‰€æœ‰ä¸Šè¿°å®çš„å®šä¹‰åŠ GNU æ‰©å±•ã€‚</li>
</ul>
<h4 id="é»˜è®¤è¡Œä¸ºä¸å®ç»„åˆ">é»˜è®¤è¡Œä¸ºä¸å®ç»„åˆ</h4>
<ul>
<li>é»˜è®¤æƒ…å†µä¸‹ï¼ŒGNU C ç¼–è¯‘å™¨ä¼šå®šä¹‰
<code>_POSIX_SOURCE</code>ã€<code>_POSIX_C_SOURCE=200809</code>ï¼ˆæˆ–æ›´æ—©ç‰ˆæœ¬çš„
200112/199506ï¼‰ã€<code>_BSD_SOURCE</code> å’Œ
<code>_SVID_SOURCE</code>ã€‚</li>
<li>å¦‚æœå•ç‹¬å®šä¹‰äº†æŸäº›å®ï¼Œæˆ–ç”¨æ ‡å‡†æ¨¡å¼ï¼ˆå¦‚ <code>cc -ansi</code> æˆ–
<code>cc -std=c99</code>ï¼‰ç¼–è¯‘ï¼Œåˆ™åªæš´éœ²è¯·æ±‚çš„å®šä¹‰ã€‚</li>
<li>å¤šä¸ªå®å¯ä»¥å åŠ å®šä¹‰ã€‚ä¾‹å¦‚ï¼š <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ cc -D_POSIX_SOURCE -D_POSIX_C_SOURCE=199506 -D_BSD_SOURCE -D_SVID_SOURCE prog.c</span><br></pre></td></tr></table></figure></li>
<li><code>&lt;features.h&gt;</code> å¤´æ–‡ä»¶å’Œ
<code>feature_test_macros(7)</code> æ‰‹å†Œé¡µæœ‰è¯¦ç»†è¯´æ˜ã€‚</li>
</ul>
<h4 id="posix.1sus-ç›¸å…³å®">POSIX.1/SUS ç›¸å…³å®</h4>
<ul>
<li>POSIX.1-2001/SUSv3 åªè§„å®šäº† <code>_POSIX_C_SOURCE</code> å’Œ
<code>_XOPEN_SOURCE</code> ä¸¤ä¸ªå®ï¼Œè¦æ±‚å€¼åˆ†åˆ«ä¸º 200112 å’Œ 600ã€‚</li>
<li>POSIX.1-2008/SUSv4 è¦æ±‚å€¼åˆ†åˆ«ä¸º 200809 å’Œ 700ã€‚</li>
<li>è®¾ç½® <code>_XOPEN_SOURCE=600</code> åº”åŒ…å«
<code>_POSIX_C_SOURCE=200112</code> çš„æ‰€æœ‰ç‰¹æ€§ï¼ŒSUSv4
ä¹Ÿæœ‰ç±»ä¼¼è¦æ±‚ã€‚</li>
</ul>
<h4
id="ç¤ºä¾‹ä»£ç ä¸å‡½æ•°åŸå‹ä¸­çš„ç‰¹æ€§æµ‹è¯•å®">ç¤ºä¾‹ä»£ç ä¸å‡½æ•°åŸå‹ä¸­çš„ç‰¹æ€§æµ‹è¯•å®</h4>
<ul>
<li>æ‰‹å†Œé¡µä¼šè¯´æ˜ä½¿ç”¨æŸä¸ªå¸¸é‡æˆ–å‡½æ•°å£°æ˜æ—¶éœ€è¦å®šä¹‰å“ªäº›ç‰¹æ€§æµ‹è¯•å®ã€‚</li>
<li>æœ¬ä¹¦ç¤ºä¾‹ä»£ç å¯ç”¨é»˜è®¤ GNU C ç¼–è¯‘å™¨é€‰é¡¹æˆ–å¦‚ä¸‹æ–¹å¼ç¼–è¯‘ï¼š
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ cc -std=c99 -D_XOPEN_SOURCE=600</span><br></pre></td></tr></table></figure></li>
<li>ä¹¦ä¸­æ¯ä¸ªå‡½æ•°åŸå‹éƒ½ä¼šæ³¨æ˜éœ€è¦å®šä¹‰å“ªäº›ç‰¹æ€§æµ‹è¯•å®ã€‚</li>
<li>æ‰‹å†Œé¡µæœ‰æ›´è¯¦ç»†çš„å®éœ€æ±‚è¯´æ˜ã€‚</li>
</ul>
<h3 id="ç³»ç»Ÿæ•°æ®ç±»å‹system-data-types">ç³»ç»Ÿæ•°æ®ç±»å‹ï¼ˆSystem Data
Typesï¼‰</h3>
<p>åœ¨ UNIX
ç³»ç»Ÿä¸­ï¼Œè®¸å¤šå®ç°ç›¸å…³çš„æ•°æ®ç±»å‹ï¼ˆå¦‚è¿›ç¨‹IDã€ç”¨æˆ·IDã€æ–‡ä»¶åç§»é‡ç­‰ï¼‰éƒ½ç”¨æ ‡å‡†
C ç±»å‹æ¥è¡¨ç¤ºã€‚è™½ç„¶å¯ä»¥ç›´æ¥ç”¨ intã€long
ç­‰åŸºæœ¬ç±»å‹å£°æ˜è¿™äº›å˜é‡ï¼Œä½†è¿™æ ·ä¼šé™ä½ç¨‹åºçš„å¯ç§»æ¤æ€§ï¼ŒåŸå› åŒ…æ‹¬ï¼š</p>
<ul>
<li>ä¸åŒ UNIX å®ç°ä¸­åŸºæœ¬ç±»å‹çš„å¤§å°å¯èƒ½ä¸åŒï¼ˆå¦‚ long
åœ¨æŸäº›ç³»ç»Ÿä¸Šæ˜¯4å­—èŠ‚ï¼Œåœ¨å¦ä¸€äº›ç³»ç»Ÿä¸Šæ˜¯8å­—èŠ‚ï¼‰ï¼Œç”šè‡³åŒä¸€ç³»ç»Ÿçš„ä¸åŒç¼–è¯‘ç¯å¢ƒä¹Ÿå¯èƒ½ä¸åŒã€‚</li>
<li>ä¸åŒå®ç°å¯èƒ½ç”¨ä¸åŒç±»å‹è¡¨ç¤ºç›¸åŒçš„ä¿¡æ¯ã€‚ä¾‹å¦‚ï¼Œè¿›ç¨‹IDåœ¨æŸäº›ç³»ç»Ÿä¸Šæ˜¯
intï¼Œåœ¨å¦ä¸€äº›ç³»ç»Ÿä¸Šæ˜¯ longã€‚</li>
<li>åŒä¸€å®ç°çš„ä¸åŒç‰ˆæœ¬ä¹Ÿå¯èƒ½æ”¹å˜ç±»å‹å®šä¹‰ã€‚ä¾‹å¦‚ï¼ŒLinux 2.2
åŠä»¥å‰ç”¨æˆ·å’Œç»„IDæ˜¯16ä½ï¼Œ2.4åŠä»¥åæ˜¯32ä½ã€‚</li>
</ul>
<p>ä¸ºé¿å…è¿™äº›ç§»æ¤æ€§é—®é¢˜ï¼ŒSUSv3ï¼ˆSingle UNIX Specification, Version
3ï¼‰è§„å®šäº†ä¸€ç³»åˆ—æ ‡å‡†ç³»ç»Ÿæ•°æ®ç±»å‹ï¼Œå¹¶è¦æ±‚å®ç°æ—¶æ­£ç¡®ä½¿ç”¨è¿™äº›ç±»å‹ã€‚è¿™äº›ç±»å‹é€šå¸¸ç”¨
C çš„ typedef å®šä¹‰ã€‚ä¾‹å¦‚ï¼Œpid_t ç”¨äºè¡¨ç¤ºè¿›ç¨‹IDï¼Œåœ¨ Linux/x86-32
ä¸Šå®šä¹‰ä¸ºï¼š <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="type">int</span> <span class="type">pid_t</span>;</span><br></pre></td></tr></table></figure> å¤§å¤šæ•°æ ‡å‡†ç³»ç»Ÿæ•°æ®ç±»å‹ä»¥ <code>_t</code>
ç»“å°¾ï¼Œé€šå¸¸å£°æ˜åœ¨ <code>&lt;sys/types.h&gt;</code>
å¤´æ–‡ä»¶ä¸­ï¼Œéƒ¨åˆ†ç±»å‹åœ¨å…¶ä»–å¤´æ–‡ä»¶ä¸­å®šä¹‰ã€‚</p>
<p><strong>å»ºè®®ï¼š</strong>
åº”ç”¨ç¨‹åºåº”ä½¿ç”¨è¿™äº›ç±»å‹æ¥å£°æ˜å˜é‡ï¼Œä»¥ä¿è¯åœ¨æ‰€æœ‰ç¬¦åˆ SUSv3
çš„ç³»ç»Ÿä¸Šéƒ½èƒ½æ­£ç¡®è¿è¡Œã€‚ä¾‹å¦‚ï¼š <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">pid_t</span> mypid;</span><br></pre></td></tr></table></figure></p>
<h4 id="å¸¸ç”¨ç³»ç»Ÿæ•°æ®ç±»å‹ä¸¾ä¾‹">å¸¸ç”¨ç³»ç»Ÿæ•°æ®ç±»å‹ä¸¾ä¾‹</h4>
<table>
<thead>
<tr>
<th>æ•°æ®ç±»å‹</th>
<th>ç±»å‹è¦æ±‚</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td>pid_t</td>
<td>æœ‰ç¬¦å·æ•´æ•°</td>
<td>è¿›ç¨‹IDã€è¿›ç¨‹ç»„IDã€ä¼šè¯ID</td>
</tr>
<tr>
<td>uid_t</td>
<td>æ•´æ•°</td>
<td>ç”¨æˆ·ID</td>
</tr>
<tr>
<td>gid_t</td>
<td>æ•´æ•°</td>
<td>ç»„ID</td>
</tr>
<tr>
<td>size_t</td>
<td>æ— ç¬¦å·æ•´æ•°</td>
<td>å¯¹è±¡å­—èŠ‚å¤§å°</td>
</tr>
<tr>
<td>ssize_t</td>
<td>æœ‰ç¬¦å·æ•´æ•°</td>
<td>å­—èŠ‚è®¡æ•°æˆ–é”™è¯¯æŒ‡ç¤º</td>
</tr>
<tr>
<td>off_t</td>
<td>æœ‰ç¬¦å·æ•´æ•°</td>
<td>æ–‡ä»¶åç§»é‡æˆ–æ–‡ä»¶å¤§å°</td>
</tr>
<tr>
<td>time_t</td>
<td>æ•´æ•°æˆ–å®æ•°</td>
<td>è‡ª Epoch èµ·çš„ç§’æ•°</td>
</tr>
<tr>
<td>mode_t</td>
<td>æ•´æ•°</td>
<td>æ–‡ä»¶æƒé™å’Œç±»å‹</td>
</tr>
<tr>
<td>dev_t</td>
<td>ç®—æœ¯ç±»å‹</td>
<td>è®¾å¤‡å·ï¼ˆä¸»æ¬¡è®¾å¤‡å·ï¼‰</td>
</tr>
<tr>
<td>ino_t</td>
<td>æ— ç¬¦å·æ•´æ•°</td>
<td>æ–‡ä»¶ i-node å·</td>
</tr>
<tr>
<td>socklen_t</td>
<td>è‡³å°‘32ä½æ•´æ•°</td>
<td>å¥—æ¥å­—åœ°å€ç»“æ„ä½“å¤§å°</td>
</tr>
</tbody>
</table>
<h3 id="æ‰“å°ç³»ç»Ÿæ•°æ®ç±»å‹çš„æ•°å€¼">æ‰“å°ç³»ç»Ÿæ•°æ®ç±»å‹çš„æ•°å€¼</h3>
<ul>
<li><p>åœ¨ç”¨ <code>printf()</code> æ‰“å°è¡¨3-1ä¸­è¿™äº›æ•°å€¼å‹ç³»ç»Ÿæ•°æ®ç±»å‹ï¼ˆå¦‚
<code>pid_t</code>ã€<code>uid_t</code>ï¼‰æ—¶ï¼Œè¦é¿å…å®ç°ç›¸å…³çš„ä¾èµ–é—®é¢˜ã€‚</p></li>
<li><p>ç”±äº C çš„å‚æ•°æå‡è§„åˆ™ï¼Œ<code>short</code> ç±»å‹ä¼šè¢«æå‡ä¸º
<code>int</code>ï¼Œä½† <code>int</code> å’Œ <code>long</code>
ç±»å‹ä¿æŒä¸å˜ã€‚å› æ­¤ï¼Œç³»ç»Ÿæ•°æ®ç±»å‹çš„åº•å±‚å®ç°ä¸åŒï¼Œä¼ é€’ç»™
<code>printf()</code> çš„å‚æ•°ç±»å‹å¯èƒ½æ˜¯ <code>int</code> æˆ–
<code>long</code>ã€‚</p></li>
<li><p>ç”±äº <code>printf()</code>
åœ¨è¿è¡Œæ—¶æ— æ³•åˆ¤æ–­å‚æ•°ç±»å‹ï¼Œè°ƒç”¨è€…å¿…é¡»ç”¨åˆé€‚çš„æ ¼å¼è¯´æ˜ç¬¦ï¼ˆå¦‚
<code>%d</code> æˆ–
<code>%ld</code>ï¼‰æ˜ç¡®æŒ‡å®šç±»å‹ã€‚ä½†ç›´æ¥å†™æ­»æŸä¸ªè¯´æ˜ç¬¦ä¼šå¯¼è‡´å®ç°ä¾èµ–ã€‚</p></li>
<li><p>é€šå¸¸çš„è§£å†³åŠæ³•æ˜¯ç»Ÿä¸€ç”¨ <code>%ld</code>ï¼Œå¹¶å°†å¯¹åº”çš„å€¼å¼ºåˆ¶è½¬æ¢ä¸º
<code>long</code>ï¼Œä¾‹å¦‚ï¼š <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">pid_t</span> mypid;</span><br><span class="line">mypid = getpid();  <span class="comment">/* è·å–å½“å‰è¿›ç¨‹ID */</span></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;My PID is %ld\n&quot;</span>, (<span class="type">long</span>) mypid);</span><br></pre></td></tr></table></figure></p></li>
<li><p>æœ‰ä¸€ä¸ªä¾‹å¤–ï¼š<code>off_t</code> ç±»å‹åœ¨æŸäº›ç¯å¢ƒä¸‹æ˜¯
<code>long long</code>ï¼Œå› æ­¤åº”å¼ºåˆ¶è½¬æ¢ä¸º <code>long long</code> å¹¶ç”¨
<code>%lld</code> æ‰“å°ï¼ˆè¯¦è§5.10èŠ‚ï¼‰ã€‚</p></li>
<li><p>C99 æ ‡å‡†å®šä¹‰äº† <code>z</code> é•¿åº¦ä¿®é¥°ç¬¦ï¼Œç”¨äº
<code>size_t</code> æˆ– <code>ssize_t</code> ç±»å‹ï¼Œå¯ä»¥ç”¨
<code>%zd</code> æ›¿ä»£ <code>%ld</code>+å¼ºè½¬ã€‚ä½†è¯¥è¯´æ˜ç¬¦å¹¶éæ‰€æœ‰ UNIX
å®ç°éƒ½æ”¯æŒï¼Œæ‰€ä»¥æœ¬ä¹¦é¿å…ä½¿ç”¨ã€‚</p></li>
<li><p>C99 è¿˜å®šä¹‰äº† <code>j</code> é•¿åº¦ä¿®é¥°ç¬¦ï¼ŒæŒ‡å®šå‚æ•°ä¸º
<code>intmax_t</code>ï¼ˆæˆ–
<code>uintmax_t</code>ï¼‰ï¼Œè¿™ç§ç±»å‹è¶³å¤Ÿå¤§ï¼Œå¯ä»¥è¡¨ç¤ºä»»ä½•æ•´æ•°ç±»å‹ã€‚ç†è®ºä¸Šï¼Œä½¿ç”¨
<code>(intmax_t)</code> å¼ºè½¬åŠ  <code>%jd</code> æ˜¯æœ€é€šç”¨çš„åšæ³•ï¼Œèƒ½å¤„ç†
<code>long long</code> åŠæ‰©å±•æ•´æ•°ç±»å‹ï¼ˆå¦‚
<code>int128_t</code>ï¼‰ã€‚ä½†ç”±äºå¹¶éæ‰€æœ‰ UNIX
å®ç°éƒ½æ”¯æŒï¼Œæœ¬ä¹¦ä¹Ÿé¿å…ä½¿ç”¨è¿™ç§æ–¹å¼ã€‚</p></li>
</ul>
<h3
id="å…¶ä»–å¯ç§»æ¤æ€§é—®é¢˜miscellaneous-portability-issues">å…¶ä»–å¯ç§»æ¤æ€§é—®é¢˜ï¼ˆMiscellaneous
Portability Issuesï¼‰</h3>
<h4 id="ç»“æ„ä½“çš„åˆå§‹åŒ–ä¸ä½¿ç”¨">ç»“æ„ä½“çš„åˆå§‹åŒ–ä¸ä½¿ç”¨</h4>
<ul>
<li>å„ UNIX
å®ç°è§„å®šäº†ä¸€ç³»åˆ—æ ‡å‡†ç»“æ„ä½“ï¼Œç”¨äºç³»ç»Ÿè°ƒç”¨å’Œåº“å‡½æ•°ã€‚ä¾‹å¦‚ï¼Œ<code>sembuf</code>
ç»“æ„ä½“ç”¨äºä¿¡å·é‡æ“ä½œï¼ˆsemopï¼‰ï¼š <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">sembuf</span> &#123;</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">short</span> sem_num;  <span class="comment">/* ä¿¡å·é‡ç¼–å· */</span></span><br><span class="line">  <span class="type">short</span>          sem_op;   <span class="comment">/* è¦æ‰§è¡Œçš„æ“ä½œ */</span></span><br><span class="line">  <span class="type">short</span>          sem_flg;  <span class="comment">/* æ“ä½œæ ‡å¿— */</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></li>
<li>è™½ç„¶ SUSv3 è§„å®šäº†è¿™äº›ç»“æ„ä½“ï¼Œä½†éœ€è¦æ³¨æ„ï¼š
<ul>
<li>ä¸€èˆ¬æ¥è¯´ï¼Œç»“æ„ä½“æˆå‘˜çš„é¡ºåºæœªå¿…æœ‰æ ‡å‡†è§„å®šã€‚</li>
<li>æŸäº›å®ç°å¯èƒ½ä¼šåœ¨ç»“æ„ä½“ä¸­æ·»åŠ é¢å¤–çš„å­—æ®µã€‚</li>
</ul></li>
<li>å› æ­¤ï¼Œ<strong>ä¸å»ºè®®</strong>ç”¨å¦‚ä¸‹æ–¹å¼åˆå§‹åŒ–ç»“æ„ä½“ï¼ˆå› ä¸ºä¸åŒå®ç°æˆå‘˜é¡ºåºå¯èƒ½ä¸åŒï¼‰ï¼š
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">sembuf</span> <span class="title">s</span> =</span> &#123; <span class="number">3</span>, <span class="number">-1</span>, SEM_UNDO &#125;;</span><br></pre></td></tr></table></figure> è¿™ç§å†™æ³•åœ¨ Linux
ä¸‹å¯ç”¨ï¼Œä½†åœ¨å…¶ä»–å®ç°ä¸­å¯èƒ½å‡ºé”™ã€‚<strong>å¯ç§»æ¤çš„åšæ³•</strong>æ˜¯ç”¨æ˜¾å¼èµ‹å€¼ï¼š
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">sembuf</span> <span class="title">s</span>;</span></span><br><span class="line">s.sem_num = <span class="number">3</span>;</span><br><span class="line">s.sem_op  = <span class="number">-1</span>;</span><br><span class="line">s.sem_flg = SEM_UNDO;</span><br></pre></td></tr></table></figure> å¦‚æœä½¿ç”¨ C99ï¼Œå¯ä»¥ç”¨æ–°çš„ç»“æ„ä½“åˆå§‹åŒ–è¯­æ³•ï¼š
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">sembuf</span> <span class="title">s</span> =</span> &#123; .sem_num = <span class="number">3</span>, .sem_op = <span class="number">-1</span>, .sem_flg = SEM_UNDO &#125;;</span><br></pre></td></tr></table></figure></li>
<li>å¦‚æœè¦å°†ç»“æ„ä½“å†…å®¹å†™å…¥æ–‡ä»¶ï¼Œä¹Ÿè¦æ³¨æ„æˆå‘˜é¡ºåºã€‚ä¸èƒ½ç›´æ¥äºŒè¿›åˆ¶å†™å…¥ç»“æ„ä½“ï¼Œè€Œåº”æŒ‰æŒ‡å®šé¡ºåºé€ä¸ªå­—æ®µå†™å…¥ï¼ˆæœ€å¥½ç”¨æ–‡æœ¬å½¢å¼ï¼‰ã€‚</li>
</ul>
<h4 id="æŸäº›å®å¯èƒ½å¹¶éæ‰€æœ‰å®ç°éƒ½æ”¯æŒ">æŸäº›å®å¯èƒ½å¹¶éæ‰€æœ‰å®ç°éƒ½æ”¯æŒ</h4>
<ul>
<li>æœ‰äº›å®åœ¨æ‰€æœ‰ UNIX å®ç°ä¸­å¹¶ä¸ä¸€å®šå­˜åœ¨ã€‚ä¾‹å¦‚ï¼Œ<code>WCOREDUMP()</code>
å®ï¼ˆç”¨äºæ£€æµ‹å­è¿›ç¨‹æ˜¯å¦äº§ç”Ÿ core dump æ–‡ä»¶ï¼‰è™½ç„¶å¸¸è§ï¼Œä½† SUSv3
å¹¶æœªè§„å®šï¼Œå› æ­¤æŸäº›ç³»ç»Ÿå¯èƒ½æ²¡æœ‰ã€‚</li>
<li>å¯ç§»æ¤çš„åšæ³•æ˜¯ç”¨ <code>#ifdef</code> åˆ¤æ–­å®æ˜¯å¦å­˜åœ¨ï¼š
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifdef</span> WCOREDUMP</span></span><br><span class="line">  <span class="comment">/* ä½¿ç”¨ WCOREDUMP() å® */</span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="ä¸åŒå®ç°å¯¹å¤´æ–‡ä»¶çš„è¦æ±‚ä¸åŒ">ä¸åŒå®ç°å¯¹å¤´æ–‡ä»¶çš„è¦æ±‚ä¸åŒ</h4>
<ul>
<li>æŸäº›ç³»ç»Ÿè°ƒç”¨å’Œåº“å‡½æ•°æ‰€éœ€çš„å¤´æ–‡ä»¶åœ¨ä¸åŒ UNIX å®ç°ä¸­å¯èƒ½ä¸åŒã€‚æœ¬ä¹¦ä»¥
Linux ä¸ºä¸»ï¼Œå¹¶æ³¨æ˜ä¸ SUSv3 çš„å·®å¼‚ã€‚</li>
<li>ä¹¦ä¸­éƒ¨åˆ†å‡½æ•°åŸå‹ä¼šæ³¨æ˜æŸä¸ªå¤´æ–‡ä»¶ååŠ æ³¨é‡Š
<code>/* For portability */</code>ï¼Œè¡¨ç¤ºè¯¥å¤´æ–‡ä»¶åœ¨ Linux æˆ– SUSv3
ä¸‹ä¸æ˜¯å¿…éœ€çš„ï¼Œä½†ä¸ºäº†å…¼å®¹å…¶ä»–ï¼ˆå°¤å…¶æ˜¯è€æ—§ï¼‰å®ç°ï¼Œå»ºè®®åœ¨å¯ç§»æ¤ç¨‹åºä¸­åŒ…å«ã€‚</li>
<li>POSIX.1-1990 è¦æ±‚åœ¨åŒ…å«ä¸æŸäº›å‡½æ•°ç›¸å…³çš„å¤´æ–‡ä»¶å‰ï¼Œå…ˆåŒ…å«
<code>&lt;sys/types.h&gt;</code>ï¼Œä½†è¿™ä¸€è¦æ±‚åæ¥è¢« SUSv1
ç§»é™¤ã€‚å°½ç®¡å¦‚æ­¤ï¼Œä¸ºäº†å¯ç§»æ¤æ€§ï¼Œå»ºè®®å°† <code>&lt;sys/types.h&gt;</code>
ä½œä¸ºé¦–ä¸ªå¤´æ–‡ä»¶åŒ…å«ï¼ˆæœ¬ä¹¦ç¤ºä¾‹ä¸ºç®€æ´èµ·è§çœç•¥äº†å®ƒï¼‰ã€‚</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://mackz-maxw.github.io/2025/06/25/oper_sysn/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Mackz-Maxw">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Maxwçš„å°ç«™">
      <meta itemprop="description" content="ä¹˜ä¸Šç‡ƒçŠ€èˆ¹ï¼Œè¿˜æœªæ›¾å»è¿‡å€’æ‚¬å±±ã€‚">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Maxwçš„å°ç«™">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/06/25/oper_sysn/" class="post-title-link" itemprop="url">æ“ä½œç³»ç»ŸåŸºç¡€ | ç³»ç»Ÿç¼–ç¨‹å¸¸ç”¨è®¾ç½®</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>
      

      <time title="åˆ›å»ºæ—¶é—´ï¼š2025-06-26 05:27:30 / ä¿®æ”¹æ—¶é—´ï¼š05:42:04" itemprop="dateCreated datePublished" datetime="2025-06-26T05:27:30+08:00">2025-06-26</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/os-basic/" itemprop="url" rel="index"><span itemprop="name">os basic</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="lpiç¤ºä¾‹ç¨‹åºè¯´æ˜">LPIç¤ºä¾‹ç¨‹åºè¯´æ˜</h2>
<h3 id="å‘½ä»¤è¡Œé€‰é¡¹ä¸å‚æ•°">å‘½ä»¤è¡Œé€‰é¡¹ä¸å‚æ•°</h3>
<ul>
<li>æœ¬ä¹¦ä¸­çš„è®¸å¤šç¤ºä¾‹ç¨‹åºä¾èµ–å‘½ä»¤è¡Œé€‰é¡¹å’Œå‚æ•°æ¥å†³å®šå…¶è¡Œä¸ºã€‚</li>
<li>ä¼ ç»Ÿ UNIX
å‘½ä»¤è¡Œé€‰é¡¹æ ¼å¼ä¸ºï¼šä¸€ä¸ªè¿å­—ç¬¦ï¼ˆ-ï¼‰åŠ ä¸€ä¸ªå­—æ¯ï¼Œåé¢å¯è·Ÿå‚æ•°ã€‚GNU
å·¥å…·æ”¯æŒæ‰©å±•æ ¼å¼ï¼šä¸¤ä¸ªè¿å­—ç¬¦ï¼ˆ--ï¼‰åŠ é€‰é¡¹åå’Œå¯é€‰å‚æ•°ã€‚</li>
<li>ç¤ºä¾‹ç¨‹åºé€šå¸¸ä½¿ç”¨æ ‡å‡†åº“å‡½æ•° <code>getopt()</code>
è§£æå‘½ä»¤è¡Œé€‰é¡¹ï¼ˆè¯¦è§é™„å½•Bï¼‰ã€‚</li>
<li>åªè¦ç¨‹åºçš„å‘½ä»¤è¡Œè¯­æ³•ä¸ç®€å•ï¼Œéƒ½ä¼šå®ç°ä¸€ä¸ªå¸®åŠ©åŠŸèƒ½ï¼šå¦‚æœç”¨
<code>--help</code>
é€‰é¡¹è¿è¡Œï¼Œç¨‹åºä¼šæ˜¾ç¤ºç”¨æ³•è¯´æ˜ï¼ŒæŒ‡æ˜å‘½ä»¤è¡Œé€‰é¡¹å’Œå‚æ•°çš„è¯­æ³•ã€‚</li>
</ul>
<h3 id="å…¬å…±å‡½æ•°ä¸å¤´æ–‡ä»¶">å…¬å…±å‡½æ•°ä¸å¤´æ–‡ä»¶</h3>
<ul>
<li>å¤§å¤šæ•°ç¤ºä¾‹ç¨‹åºéƒ½åŒ…å«ä¸€ä¸ªå…¬å…±å¤´æ–‡ä»¶ï¼Œå®šä¹‰å¸¸ç”¨ç±»å‹å’Œå®ï¼Œå¹¶å¼•ç”¨å¸¸ç”¨çš„åº“å‡½æ•°å’Œç³»ç»Ÿè°ƒç”¨å£°æ˜ï¼Œä½¿ä»£ç æ›´ç®€æ´ã€‚</li>
</ul>
<h4 id="å…¬å…±å¤´æ–‡ä»¶libtlpi_hdr.h">å…¬å…±å¤´æ–‡ä»¶ï¼ˆlib/tlpi_hdr.hï¼‰</h4>
<ul>
<li><p>è¯¥å¤´æ–‡ä»¶åŒ…å«äº†è®¸å¤šå¸¸ç”¨å¤´æ–‡ä»¶ï¼Œå®šä¹‰äº†å¸ƒå°”ç±»å‹å’Œæ±‚æœ€å°/æœ€å¤§å€¼çš„å®ã€‚ä¾‹å¦‚ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifndef</span> TLPI_HDR_H</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> TLPI_HDR_H  <span class="comment">/* é˜²æ­¢é‡å¤åŒ…å« */</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/types.h&gt;</span>  <span class="comment">/* å¸¸ç”¨ç±»å‹å®šä¹‰ */</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span>      <span class="comment">/* æ ‡å‡†I/Oå‡½æ•° */</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;errno.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;get_num.h&quot;</span>    <span class="comment">/* å¸¸ç”¨æ•°å€¼å¤„ç†å‡½æ•°å£°æ˜ */</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;error_functions.h&quot;</span>  <span class="comment">/* é”™è¯¯å¤„ç†å‡½æ•°å£°æ˜ */</span></span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">enum</span> &#123;</span> FALSE, TRUE &#125; Boolean;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> min(m,n) ((m) &lt; (n) ? (m) : (n))</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> max(m,n) ((m) &gt; (n) ? (m) : (n))</span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br></pre></td></tr></table></figure></li>
</ul>
<h4
id="é”™è¯¯è¯Šæ–­å‡½æ•°liberror_functions.h">é”™è¯¯è¯Šæ–­å‡½æ•°ï¼ˆlib/error_functions.hï¼‰</h4>
<ul>
<li><p>ä¸ºç®€åŒ–é”™è¯¯å¤„ç†ï¼Œç¤ºä¾‹ç¨‹åºä½¿ç”¨ä¸€ç»„é€šç”¨çš„é”™è¯¯è¯Šæ–­å‡½æ•°ï¼Œå…¶å£°æ˜å¦‚ä¸‹ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifndef</span> ERROR_FUNCTIONS_H</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ERROR_FUNCTIONS_H</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">errMsg</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *format, ...)</span>;</span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> __GNUC__</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> NORETURN __attribute__ ((__noreturn__))</span></span><br><span class="line"><span class="meta">#<span class="keyword">else</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> NORETURN</span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"><span class="type">void</span> <span class="title function_">errExit</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *format, ...)</span> NORETURN ;</span><br><span class="line"><span class="type">void</span> <span class="title function_">err_exit</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *format, ...)</span> NORETURN ;</span><br><span class="line"><span class="type">void</span> <span class="title function_">errExitEN</span><span class="params">(<span class="type">int</span> errnum, <span class="type">const</span> <span class="type">char</span> *format, ...)</span> NORETURN ;</span><br><span class="line"><span class="type">void</span> <span class="title function_">fatal</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *format, ...)</span> NORETURN ;</span><br><span class="line"><span class="type">void</span> <span class="title function_">usageErr</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *format, ...)</span> NORETURN ;</span><br><span class="line"><span class="type">void</span> <span class="title function_">cmdLineErr</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *format, ...)</span> NORETURN ;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br></pre></td></tr></table></figure></li>
</ul>
<h4
id="ä½¿ç”¨-errmsgerrexiterr_exit-å’Œ-errexiten-è¯Šæ–­ç³»ç»Ÿè°ƒç”¨å’Œåº“å‡½æ•°é”™è¯¯">ä½¿ç”¨
errMsg()ã€errExit()ã€err_exit() å’Œ errExitEN()
è¯Šæ–­ç³»ç»Ÿè°ƒç”¨å’Œåº“å‡½æ•°é”™è¯¯</h4>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;tlpi_hdr.h&quot;</span></span></span><br><span class="line"><span class="type">void</span> <span class="title function_">errMsg</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *format, ...)</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">errExit</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *format, ...)</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">err_exit</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *format, ...)</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">errExitEN</span><span class="params">(<span class="type">int</span> errnum, <span class="type">const</span> <span class="type">char</span> *format, ...)</span>;</span><br></pre></td></tr></table></figure>
<ul>
<li><p><strong>errMsg()</strong><br />
åœ¨æ ‡å‡†é”™è¯¯è¾“å‡ºé”™è¯¯ä¿¡æ¯ã€‚å‚æ•°åˆ—è¡¨ä¸ printf()
ç›¸åŒï¼Œè¾“å‡ºæœ«å°¾è‡ªåŠ¨åŠ æ¢è¡Œã€‚ä¼šè¾“å‡ºå½“å‰ errno å¯¹åº”çš„é”™è¯¯æ–‡æœ¬ï¼ˆå¦‚é”™è¯¯å
EPERM å’Œ strerror() è¿”å›çš„æè¿°ï¼‰ï¼Œå†åŠ ä¸Šæ ¼å¼åŒ–è¾“å‡ºå†…å®¹ã€‚</p></li>
<li><p><strong>errExit()</strong><br />
åŠŸèƒ½ç±»ä¼¼ errMsg()ï¼Œä½†ä¼šç»ˆæ­¢ç¨‹åºã€‚ç»ˆæ­¢æ–¹å¼ä¸ºè°ƒç”¨ exit()ï¼Œå¦‚æœç¯å¢ƒå˜é‡
EF_DUMPCORE è¢«è®¾ç½®ä¸ºéç©ºå­—ç¬¦ä¸²ï¼Œåˆ™è°ƒç”¨ abort() ç”Ÿæˆ core dump
æ–‡ä»¶ï¼ˆç”¨äºè°ƒè¯•ï¼‰ã€‚</p></li>
<li><p><strong>err_exit()</strong><br />
ä¸ errExit() ç±»ä¼¼ï¼Œä½†æœ‰ä¸¤ç‚¹ä¸åŒï¼š</p>
<ol type="1">
<li>æ‰“å°é”™è¯¯ä¿¡æ¯å‰ä¸ä¼šåˆ·æ–°æ ‡å‡†è¾“å‡ºã€‚</li>
<li>é€šè¿‡ _exit() ç»ˆæ­¢è¿›ç¨‹ï¼Œè€Œä¸æ˜¯ exit()ï¼Œè¿™æ ·ä¸ä¼šåˆ·æ–° stdio
ç¼“å†²åŒºï¼Œä¹Ÿä¸ä¼šè°ƒç”¨ exit å¤„ç†å‡½æ•°ã€‚
è¿™ç§æ–¹å¼é€‚åˆåœ¨åº“å‡½æ•°ä¸­åˆ›å»ºå­è¿›ç¨‹åï¼Œå› é”™è¯¯éœ€è¦ç«‹å³ç»ˆæ­¢å­è¿›ç¨‹æ—¶ä½¿ç”¨ï¼Œé¿å…å½±å“çˆ¶è¿›ç¨‹çš„ç¼“å†²åŒºå’Œé€€å‡ºå¤„ç†ã€‚</li>
</ol></li>
<li><p><strong>errExitEN()</strong><br />
ä¸ errExit() ç±»ä¼¼ï¼Œä½†è¾“å‡ºçš„æ˜¯å‚æ•° errnum æŒ‡å®šçš„é”™è¯¯å·å¯¹åº”çš„é”™è¯¯æ–‡æœ¬ï¼ˆEN
ä»£è¡¨ Error Numberï¼‰ï¼Œè€Œä¸æ˜¯å½“å‰ errno çš„å†…å®¹ã€‚ä¸»è¦ç”¨äº POSIX çº¿ç¨‹
APIï¼ˆpthreadï¼‰ç›¸å…³çš„ç¨‹åºã€‚</p>
<ul>
<li>ä¼ ç»Ÿ UNIX ç³»ç»Ÿè°ƒç”¨å‡ºé”™è¿”å› â€“1ï¼ŒPOSIX
çº¿ç¨‹å‡½æ•°å‡ºé”™åˆ™ç›´æ¥è¿”å›é”™è¯¯å·ï¼ˆæ­£æ•´æ•°ï¼‰ï¼ŒæˆåŠŸè¿”å› 0ã€‚</li>
<li>ç¤ºä¾‹ï¼š <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> s;</span><br><span class="line">s = pthread_create(&amp;thread, <span class="literal">NULL</span>, func, &amp;arg);</span><br><span class="line"><span class="keyword">if</span> (s != <span class="number">0</span>)</span><br><span class="line">  errExitEN(s, <span class="string">&quot;pthread_create&quot;</span>);</span><br></pre></td></tr></table></figure></li>
<li>è¿™æ ·æ¯”ç›´æ¥ç”¨ errno æ›´é«˜æ•ˆï¼Œå› ä¸ºåœ¨å¤šçº¿ç¨‹ç¨‹åºä¸­ errno
æ˜¯ä¸€ä¸ªå®ï¼Œä¼šå±•å¼€ä¸ºå‡½æ•°è°ƒç”¨ï¼Œè¿”å›çº¿ç¨‹ç§æœ‰çš„å­˜å‚¨åŒºåŸŸæŒ‡é’ˆã€‚</li>
</ul></li>
<li><p><strong>lvalueï¼ˆå·¦å€¼ï¼‰ è¯´æ˜</strong><br />
lvalue æ˜¯æŒ‡å‘å­˜å‚¨åŒºåŸŸçš„è¡¨è¾¾å¼ï¼Œæœ€å¸¸è§çš„æ˜¯å˜é‡åã€‚æŸäº›æ“ä½œç¬¦ä¹Ÿèƒ½äº§ç”Ÿ
lvalueï¼Œæ¯”å¦‚æŒ‡é’ˆè§£å¼•ç”¨ *pã€‚åœ¨ POSIX çº¿ç¨‹ API ä¸‹ï¼Œerrno
è¢«é‡å®šä¹‰ä¸ºè¿”å›çº¿ç¨‹ç§æœ‰å­˜å‚¨åŒºæŒ‡é’ˆçš„å‡½æ•°ã€‚</p></li>
</ul>
<h4 id="è¯Šæ–­å…¶ä»–ç±»å‹é”™è¯¯çš„å‡½æ•°">è¯Šæ–­å…¶ä»–ç±»å‹é”™è¯¯çš„å‡½æ•°</h4>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;tlpi_hdr.h&quot;</span></span></span><br><span class="line"><span class="type">void</span> <span class="title function_">fatal</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *format, ...)</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">usageErr</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *format, ...)</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">cmdLineErr</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *format, ...)</span>;</span><br></pre></td></tr></table></figure>
<ul>
<li><p><strong>fatal()</strong><br />
ç”¨äºè¯Šæ–­ä¸€èˆ¬æ€§é”™è¯¯ï¼ŒåŒ…æ‹¬é‚£äº›ä¸ä¼šè®¾ç½® errno çš„åº“å‡½æ•°é”™è¯¯ã€‚å‚æ•°åˆ—è¡¨ä¸
printf() ç›¸åŒï¼Œè¾“å‡ºè‡ªåŠ¨æ¢è¡Œã€‚è¯¥å‡½æ•°ä¼šå°†æ ¼å¼åŒ–ä¿¡æ¯è¾“å‡ºåˆ°æ ‡å‡†é”™è¯¯ï¼Œå¹¶åƒ
errExit() ä¸€æ ·ç»ˆæ­¢ç¨‹åºã€‚</p></li>
<li><p><strong>usageErr()</strong><br />
ç”¨äºè¯Šæ–­å‘½ä»¤è¡Œå‚æ•°ç”¨æ³•é”™è¯¯ã€‚å‚æ•°åŒ printf()ï¼Œè¾“å‡ºä»¥ "Usage:"
å¼€å¤´ï¼Œåè·Ÿæ ¼å¼åŒ–å†…å®¹ï¼Œè¾“å‡ºåˆ°æ ‡å‡†é”™è¯¯ï¼Œç„¶åè°ƒç”¨ exit()
ç»ˆæ­¢ç¨‹åºã€‚ï¼ˆæœ‰äº›ç¤ºä¾‹ç¨‹åºä¼šç”¨æ‰©å±•ç‰ˆ usageError()ã€‚ï¼‰</p></li>
<li><p><strong>cmdLineErr()</strong><br />
ç±»ä¼¼äº usageErr()ï¼Œä½†ç”¨äºè¯Šæ–­å‘½ä»¤è¡Œå‚æ•°æœ¬èº«çš„é”™è¯¯ã€‚è¾“å‡ºä»¥ "Command-line
usage error:" å¼€å¤´ï¼Œåè·Ÿæ ¼å¼åŒ–å†…å®¹ï¼Œè¾“å‡ºåˆ°æ ‡å‡†é”™è¯¯å¹¶ç»ˆæ­¢ç¨‹åºã€‚</p></li>
</ul>
<h4 id="é”™è¯¯å¤„ç†å‡½æ•°å®ç°è¯´æ˜">é”™è¯¯å¤„ç†å‡½æ•°å®ç°è¯´æ˜</h4>
<ul>
<li>é”™è¯¯å¤„ç†å‡½æ•°çš„å®ç°ä¼šç”¨åˆ° <code>ename.c.inc</code>
æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶å®šä¹‰äº†ä¸€ä¸ªå­—ç¬¦ä¸²æ•°ç»„ <code>ename</code>ï¼Œç”¨äºå°† errno
é”™è¯¯å·æ˜ å°„ä¸ºç¬¦å·åï¼ˆå¦‚ EPERMã€EAGAIN/EWOULDBLOCK ç­‰ï¼‰ã€‚</li>
<li>è¿™æ ·åšçš„å¥½å¤„æ˜¯ï¼šstrerror()
åªè¿”å›é”™è¯¯æè¿°ï¼Œä¸åŒ…å«ç¬¦å·åï¼Œè€Œæ‰‹å†Œé¡µç”¨ç¬¦å·åæè¿°é”™è¯¯ã€‚è¾“å‡ºç¬¦å·åä¾¿äºæŸ¥é˜…æ‰‹å†Œå®šä½é”™è¯¯åŸå› ã€‚</li>
<li><code>ename.c.inc</code> æ–‡ä»¶å†…å®¹ä¸ç¡¬ä»¶æ¶æ„ç›¸å…³ï¼Œä¸åŒå¹³å° errno
å€¼å¯èƒ½ä¸åŒã€‚å¯ä»¥ç”¨ä¹¦ä¸­æä¾›çš„è„šæœ¬ï¼ˆlib/Build_ename.shï¼‰ä¸ºç‰¹å®šå¹³å°ç”Ÿæˆåˆé€‚çš„ç‰ˆæœ¬ã€‚</li>
<li><code>ename</code>
æ•°ç»„ä¸­æœ‰äº›å­—ç¬¦ä¸²ä¸ºç©ºï¼Œå¯¹åº”æœªä½¿ç”¨çš„é”™è¯¯å·ï¼›æœ‰äº›å­—ç¬¦ä¸²åŒ…å«ä¸¤ä¸ªé”™è¯¯åï¼ˆå¦‚
"EAGAIN/EWOULDBLOCK"ï¼‰ï¼Œè¡¨ç¤ºè¿™ä¸¤ä¸ªç¬¦å·å¯¹åº”åŒä¸€ä¸ªé”™è¯¯å·ã€‚</li>
<li>ä¾‹å¦‚ï¼ŒEAGAIN å’Œ EWOULDBLOCK åœ¨å¤§å¤šæ•° UNIX ç³»ç»Ÿä¸Šå€¼ç›¸åŒï¼Œåˆ†åˆ«ç”¨äº
System V å’Œ BSD çš„ä¸åŒåœºæ™¯ã€‚SUSv3
è§„èŒƒå…è®¸éé˜»å¡è°ƒç”¨è¿”å›è¿™ä¸¤ä¸ªé”™è¯¯ä¹‹ä¸€ã€‚</li>
</ul>
<h4 id="è§£ææ•°å­—å‹å‘½ä»¤è¡Œå‚æ•°çš„å‡½æ•°">è§£ææ•°å­—å‹å‘½ä»¤è¡Œå‚æ•°çš„å‡½æ•°</h4>
<ul>
<li>å¤´æ–‡ä»¶ï¼ˆå¦‚æ¸…å•3-5ï¼‰å£°æ˜äº†ä¸¤ä¸ªå¸¸ç”¨æ¥è§£ææ•´å‹å‘½ä»¤è¡Œå‚æ•°çš„å‡½æ•°ï¼š<code>getInt()</code>
å’Œ <code>getLong()</code>ã€‚</li>
<li>ä¸ <code>atoi()</code>ã€<code>atol()</code>ã€<code>strtol()</code>
ç­‰æ ‡å‡†å‡½æ•°ç›¸æ¯”ï¼Œè¿™ä¸¤ä¸ªå‡½æ•°çš„ä¸»è¦ä¼˜ç‚¹æ˜¯èƒ½å¯¹æ•°å­—å‚æ•°è¿›è¡ŒåŸºæœ¬æœ‰æ•ˆæ€§æ£€æŸ¥ã€‚</li>
<li><code>getInt()</code> å’Œ <code>getLong()</code> åˆ†åˆ«å°†å‚æ•°
<code>arg</code> æŒ‡å‘çš„å­—ç¬¦ä¸²è½¬æ¢ä¸º int æˆ– long ç±»å‹ã€‚å¦‚æœ
<code>arg</code> ä¸æ˜¯æœ‰æ•ˆçš„æ•´æ•°å­—ç¬¦ä¸²ï¼ˆå³åªåŒ…å«æ•°å­—å’Œ +ã€-
å·ï¼‰ï¼Œå‡½æ•°ä¼šè¾“å‡ºé”™è¯¯ä¿¡æ¯å¹¶ç»ˆæ­¢ç¨‹åºã€‚</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;tlpi_hdr.h&quot;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">getInt</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *arg, <span class="type">int</span> flags, <span class="type">const</span> <span class="type">char</span> *name)</span>;</span><br><span class="line"><span class="type">long</span> <span class="title function_">getLong</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *arg, <span class="type">int</span> flags, <span class="type">const</span> <span class="type">char</span> *name)</span>;</span><br><span class="line"><span class="comment">// è¿”å› arg è½¬æ¢åçš„æ•°å€¼</span></span><br></pre></td></tr></table></figure>
<ul>
<li><p>å¦‚æœ <code>name</code> å‚æ•°é NULLï¼Œåº”ä¼ å…¥ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œç”¨äºæ ‡è¯†
arg å‚æ•°ã€‚è¯¥å­—ç¬¦ä¸²ä¼šåŒ…å«åœ¨é”™è¯¯ä¿¡æ¯ä¸­ï¼Œä¾¿äºå®šä½é—®é¢˜ã€‚</p></li>
<li><p><code>flags</code> å‚æ•°ç”¨äºæ§åˆ¶ <code>getInt()</code> å’Œ
<code>getLong()</code>
çš„è¡Œä¸ºã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œè¿™ä¸¤ä¸ªå‡½æ•°æœŸæœ›å‚æ•°ä¸ºæœ‰ç¬¦å·åè¿›åˆ¶æ•´æ•°ã€‚é€šè¿‡å°†ä¸€ä¸ªæˆ–å¤šä¸ª
GN_* å¸¸é‡ï¼ˆè§æ¸…å•3-5ï¼‰æŒ‰ä½æˆ–ï¼ˆ|ï¼‰èµ‹ç»™
flagsï¼Œå¯ä»¥é€‰æ‹©ä¸åŒçš„è¿›åˆ¶æˆ–é™åˆ¶æ•°å€¼èŒƒå›´ï¼ˆå¦‚åªå…è®¸éè´Ÿæ•°æˆ–å¤§äº0ï¼‰ã€‚</p></li>
<li><p>è¿™ä¸¤ä¸ªå‡½æ•°çš„å®ç°è§æ¸…å•3-6ã€‚</p></li>
<li><p>è™½ç„¶ flags
å‚æ•°å¯ä»¥å¼ºåˆ¶èŒƒå›´æ£€æŸ¥ï¼Œä½†åœ¨æŸäº›ç¤ºä¾‹ç¨‹åºä¸­æˆ‘ä»¬å¹¶æœªå¯ç”¨è¿™äº›æ£€æŸ¥ã€‚ä¾‹å¦‚ï¼Œåœ¨æ¸…å•47-1ä¸­ï¼Œæœªæ£€æŸ¥ä¿¡å·é‡åˆå§‹å€¼å‚æ•°ï¼Œç”¨æˆ·å¯ä»¥è¾“å…¥è´Ÿæ•°ï¼Œå¯¼è‡´åç»­
semctl()
ç³»ç»Ÿè°ƒç”¨å‡ºé”™ï¼ˆERANGEï¼‰ï¼Œå› ä¸ºä¿¡å·é‡ä¸èƒ½ä¸ºè´Ÿã€‚çœç•¥èŒƒå›´æ£€æŸ¥æœ‰åŠ©äºå®éªŒç³»ç»Ÿè°ƒç”¨å’Œåº“å‡½æ•°çš„æ­£ç¡®ä¸é”™è¯¯ç”¨æ³•ï¼Œä¾¿äºå­¦ä¹ ã€‚å®é™…åº”ç”¨ä¸­é€šå¸¸ä¼šå¯¹å‘½ä»¤è¡Œå‚æ•°åšæ›´ä¸¥æ ¼çš„æ£€æŸ¥ã€‚</p></li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" title="ä¸Šä¸€é¡µ" aria-label="ä¸Šä¸€é¡µ" href="/zh-CN/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/zh-CN/">1</a><span class="page-number current">2</span><a class="page-number" href="/zh-CN/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/zh-CN/page/9/">9</a><a class="extend next" rel="next" title="ä¸‹ä¸€é¡µ" aria-label="ä¸‹ä¸€é¡µ" href="/zh-CN/page/3/"><i class="fa fa-angle-right"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">
  <div class="languages">
    <label class="lang-select-label">
      <i class="fa fa-language"></i>
      <span>ç®€ä½“ä¸­æ–‡</span>
      <i class="fa fa-angle-up" aria-hidden="true"></i>
    </label>
    <select class="lang-select" data-canonical="" aria-label="é€‰æ‹©è¯­è¨€">
      
        <option value="zh-CN" data-href="/page/2/index.html" selected="">
          ç®€ä½“ä¸­æ–‡
        </option>
      
        <option value="en" data-href="/en/page/2/index.html" selected="">
          English
        </option>
      
    </select>
  </div>

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">Mackz-Maxw</span>
  </div>
  <div class="powered-by">ç”± <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="noopener" target="_blank">NexT.Muse</a> å¼ºåŠ›é©±åŠ¨
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="è¿”å›é¡¶éƒ¨">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/sidebar.js"></script><script src="/js/next-boot.js"></script>

  






  




  

  <script class="next-config" data-name="enableMath" type="application/json">false</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>



</body>
</html>
